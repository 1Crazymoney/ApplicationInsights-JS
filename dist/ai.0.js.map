{"version":3,"sources":["../JavaScript/JavaScriptSDK.Interfaces/IConfig.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/Base.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/Envelope.ts","../JavaScript/JavaScriptSDK.Interfaces/Context/IApplication.ts","../JavaScript/JavaScriptSDK.Interfaces/Context/IDevice.ts","../JavaScript/JavaScriptSDK.Interfaces/Context/IInternal.ts","../JavaScript/JavaScriptSDK.Interfaces/Context/ILocation.ts","../JavaScript/JavaScriptSDK.Interfaces/Context/IOperation.ts","../JavaScript/JavaScriptSDK.Interfaces/Context/ISample.ts","../JavaScript/JavaScriptSDK.Interfaces/Context/IUser.ts","../JavaScript/JavaScriptSDK.Interfaces/Context/ISession.ts","../JavaScript/JavaScriptSDK.Interfaces/Telemetry/ISerializable.ts","../JavaScript/JavaScriptSDK.Interfaces/Telemetry/IEnvelope.ts","../JavaScript/JavaScriptSDK.Interfaces/ITelemetryContext.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/SeverityLevel.ts","../JavaScript/JavaScriptSDK.Interfaces/IAppInsights.ts","../JavaScript/JavaScriptSDK/Logging.ts","../JavaScript/JavaScriptSDK/Util.ts","../JavaScript/JavaScriptSDK/Serializer.ts","../JavaScript/JavaScriptSDK/Telemetry/Common/Envelope.ts","../JavaScript/JavaScriptSDK/Telemetry/Common/Base.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/ContextTagKeys.ts","../JavaScript/JavaScriptSDK/Context/Application.ts","../JavaScript/JavaScriptSDK/Context/Device.ts","../JavaScript/JavaScriptSDK/Context/Internal.ts","../JavaScript/JavaScriptSDK/Context/Location.ts","../JavaScript/JavaScriptSDK/Context/Operation.ts","../JavaScript/JavaScriptSDK/HashCodeScoreGenerator.ts","../JavaScript/JavaScriptSDK/SamplingScoreGenerator.ts","../JavaScript/JavaScriptSDK/Context/Sample.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/SessionState.ts","../JavaScript/JavaScriptSDK/Context/Session.ts","../JavaScript/JavaScriptSDK/Context/User.ts","../JavaScript/JavaScriptSDK/ajax/ajaxUtils.ts","../JavaScript/JavaScriptSDK/ajax/ajaxRecord.ts","../JavaScript/JavaScriptSDK/ajax/ajax.ts","../JavaScript/JavaScriptSDK/SendBuffer.ts","../JavaScript/JavaScriptSDK/Sender.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/Domain.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/MessageData.ts","../JavaScript/JavaScriptSDK/Telemetry/Common/DataSanitizer.ts","../JavaScript/JavaScriptSDK/Telemetry/Trace.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/EventData.ts","../JavaScript/JavaScriptSDK/Telemetry/Event.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/ExceptionDetails.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/ExceptionData.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/StackFrame.ts","../JavaScript/JavaScriptSDK/Telemetry/Exception.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/MetricData.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/DataPointType.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/DataPoint.ts","../JavaScript/JavaScriptSDK/Telemetry/Common/DataPoint.ts","../JavaScript/JavaScriptSDK/Telemetry/Metric.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/PageViewData.ts","../JavaScript/JavaScriptSDK/Telemetry/PageView.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/PageViewPerfData.ts","../JavaScript/JavaScriptSDK/Telemetry/PageViewPerformance.ts","../JavaScript/JavaScriptSDK/TelemetryContext.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/Data.ts","../JavaScript/JavaScriptSDK/Telemetry/Common/Data.ts","../JavaScript/JavaScriptSDK/Telemetry/PageViewManager.ts","../JavaScript/JavaScriptSDK/Telemetry/PageVisitTimeManager.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/DependencyKind.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/DependencySourceType.ts","../JavaScript/JavaScriptSDK.Interfaces/Contracts/Generated/RemoteDependencyData.ts","../JavaScript/JavaScriptSDK/Telemetry/RemoteDependencyData.ts","../JavaScript/JavaScriptSDK/SplitTest.ts","../JavaScript/JavaScriptSDK/AppInsights.ts","../JavaScript/JavaScriptSDK/DataLossAnalyzer.ts","../JavaScript/JavaScriptSDK/Initialization.ts","../JavaScript/JavaScriptSDK/Init.ts"],"names":["Microsoft","ApplicationInsights","Telemetry","Base","Envelope","this","ver","sampleRate","tags","Context","AI","SeverityLevel","LoggingSeverity","_InternalMessageId","_InternalLogMessage","msgId","msg","isUserAct","properties","messageId","message","AiUserActionablePrefix","AiNonUserActionablePrefix","toString","diagnosticText","sanitizeDiagnosticText","JSON","stringify","text","replace","_InternalLogging","throwInternal","severity","enableDebugExceptions","messageKey","_messageLogged","verboseLogging","warnToConsole","logInternalMessage","console","warn","log","resetInternalMessageCount","_messageCount","clearInternalMessageLoggedTypes","Util","canUseSessionStorage","sessionStorageKeys","getSessionStorageKeys","i","length","indexOf","AIInternalMessagePrefix","removeSessionStorage","setMaxInternalMessageLimit","limit","Error","MAX_INTERNAL_MESSAGE_LIMIT","_areInternalMessagesThrottled","logMessage","getSessionStorage","setSessionStorage","CRITICAL","queue","push","throttleLimitMessage","throttleMessage","MessageLimitPerPVExceeded","StorageType","disableStorage","_canUseLocalStorage","_canUseSessionStorage","_getLocalStorageObject","canUseLocalStorage","_getVerifiedStorageObject","LocalStorage","storageType","fail","uid","storage","Date","window","localStorage","sessionStorage","setItem","getItem","removeItem","exception","undefined","getStorage","name","e","WARNING","BrowserCannotReadLocalStorage","getExceptionName","dump","setStorage","data","BrowserCannotWriteLocalStorage","removeStorage","BrowserFailedRemovalFromLocalStorage","_getSessionStorageObject","SessionStorage","keys","key","BrowserCannotReadSessionStorage","BrowserCannotWriteSessionStorage","BrowserFailedRemovalFromSessionStorage","disableCookies","_canUseCookies","canUseCookies","document","cookie","CannotAccessCookie","setCookie","value","domain","domainAttrib","secureAttrib","location","protocol","stringToBoolOrDefault","str","defaultValue","toLowerCase","getCookie","cookieName","cookies","split","trim","substring","deleteCookie","newId","base64chars","result","random","Math","charAt","floor","isArray","obj","Object","prototype","call","isError","isDate","toISOStringForIE8","date","toISOString","pad","number","r","String","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","toFixed","slice","getIEVersion","userAgentStr","myNav","navigator","userAgent","parseInt","msToTimeSpan","totalms","isNaN","round","ms","sec","min","hour","days","isCrossOriginError","url","lineNumber","columnNumber","error","object","objectTypeDump","propertyValueDump","stack","addEventHandler","eventName","callback","verbEventName","addEventListener","IsBeaconApiSupported","sendBeacon","NotSpecified","UrlHelper","parseUrl","htmlAnchorElement","createElement","href","getAbsoluteUrl","a","getPathName","pathname","getCompleteUrl","method","absoluteUrl","toUpperCase","FieldType","Serializer","serialize","input","output","_serializeObject","source","CannotSerializeObject","CircularReferenceDetected","aiDataContract","_serializeStringMap","_serializeArray","CannotSerializeObjectNonSerializable","field","contract","isRequired","Required","isHidden","Hidden","Array","isPresent","isObject","MissingRequiredFieldSpecification","sources","item","ItemNotInArray","map","expectedType","num","parseFloat","Common","_super","_this","DataSanitizer","sanitizeString","time","iKey","__extends","apply","arguments","ContextTagKeys","applicationVersion","applicationBuild","applicationTypeId","applicationId","deviceId","deviceIp","deviceLanguage","deviceLocale","deviceModel","deviceNetwork","deviceNetworkName","deviceOEMName","deviceOS","deviceOSVersion","deviceRoleInstance","deviceRoleName","deviceScreenResolution","deviceType","deviceMachineName","deviceVMName","locationIp","operationId","operationName","operationParentId","operationRootId","operationSyntheticSource","operationIsSynthetic","operationCorrelationVector","sessionId","sessionIsFirst","sessionIsNew","userAccountAcquisitionDate","userAccountId","userId","userStoreRegion","userAuthUserId","userAnonymousUserAcquisitionDate","userAuthenticatedUserAcquisitionDate","cloudName","cloudRoleVer","cloudEnvironment","cloudLocation","cloudDeploymentUnit","serverDeviceOS","serverDeviceOSVer","internalSdkVersion","internalAgentVersion","internalDataCollectorReceivedTime","internalProfileId","internalProfileClassId","internalAccountId","internalApplicationName","internalInstrumentationKey","internalTelemetryItemId","internalApplicationType","internalRequestSource","internalFlowType","internalIsAudit","internalTrackingSourceId","internalTrackingType","internalIsDiagnosticExample","Application","Device","id","type","Internal","config","sdkVersion","sdkExtension","Version","Location","Operation","HashCodeScoreGenerator","getHashCodeScore","getHashCode","INT_MAX_VALUE","MIN_INPUT_LENGTH","concat","hash","charCodeAt","abs","SamplingScoreGenerator","hashCodeGeneragor","getSamplingScore","envelope","tagKeys","Sample","SampleRateOutOfRange","samplingRate","samplingScoreGenerator","isSampledIn","SessionState","Session","_SessionManager","sessionExpirationMs","acquisitionSpan","sessionRenewalMs","renewalSpan","automaticSession","update","initializeAutomaticSession","now","dateTime","Now","acquisitionExpired","acquisitionDate","renewalExpired","renewalDate","isFirst","renew","cookieUpdatedTimestamp","cookieUpdateInterval","backup","initializeAutomaticSessionWithData","sessionData","params","acq","renewal","ErrorParsingAISessionCookie","SessionRenewalDateIsZero","BrowserDoesNotSupportLocalStorage","guid","acquisitionExpiry","renewalExpiry","cookieExpiry","setTime","cookieDomnain","cookieDomain","join","toUTCString","User","userCookieName","cookieSeparator","acqStr","accountAcquisitionDate","getTime","newCookie","accountId","authCookie","authUserCookieName","decodeURI","authCookieString","authenticatedId","setAuthenticatedUserContext","authenticatedUserId","validateUserInput","SetAuthContextFailedAccountName","encodeURI","clearAuthenticatedUserContext","match","extensions","IsNullOrUndefined","stringUtils","GetLength","strObject","res","stringified","ex","performance","timing","navigationStart","GetDuration","start","end","EventHelper","AttachEvent","eventNameWithoutOn","handlerRef","attachEvent","DetachEvent","detachEvent","removeEventListener","XHRMonitoringState","openDone","setRequestHeaderDone","sendDone","abortDone","onreadystatechangeCallbackAttached","ajaxRecord","completed","requestHeadersSize","ttfb","responseReceivingDuration","callbackDuration","ajaxTotalDuration","aborted","pageUrl","requestUrl","requestSize","status","requestSentTime","responseStartedTime","responseFinishedTime","callbackFinishedTime","endTime","originalOnreadystatechage","xhrMonitoringState","clientFailure","CalculateMetrics","self","sanitizeUrl","AjaxMonitor","appInsights","currentWindowHost","host","initialized","Init","supportsMonitoring","instrumentOpen","instrumentSend","instrumentAbort","isMonitoredInstance","xhr","excludeAjaxDataValidation","ajaxData","DisabledPropertyName","XMLHttpRequest","originalOpen","open","ajaxMonitorInstance","async","openHandler","FailedMonitorAjaxOpen","ajaxDiagnosticsMessage","getFailedAjaxDiagnosticsMessage","attachToOnReadyStateChange","originalSend","send","content","sendHandler","FailedMonitorAjaxSend","disableCorrelationHeaders","rootId","context","operation","setRequestHeader","originalAbort","abort","FailedMonitorAjaxAbort","readyState","onAjaxComplete","exceptionText","FailedMonitorAjaxRSC","FailedMonitorAjaxDur","trackDependency","instrumentedByAppInsightsName","ArraySendBuffer","_config","_buffer","enqueue","payload","count","clear","getItems","batchPayloads","emitLineDelimitedJson","markAsSent","clearSent","SessionStorageSendBuffer","_bufferFullMessageSent","bufferItems","getBuffer","BUFFER_KEY","notDeliveredItems","SENT_BUFFER_KEY","MAX_BUFFER_SIZE","setBuffer","SessionStorageBufferFull","removePayloadsFromBuffer","sentElements","payloads","buffer","remaining","contains","j","bufferJson","parse","FailedToRestoreStorageBuffer","FailedToSetStorageBuffer","Sender","_XMLHttpRequestSupported","_consecutiveErrors","_retryAt","_lastSend","_sender","enableSessionStorageBuffer","isBeaconApiDisabled","_beaconSender","testXhr","_xhrSender","XDomainRequest","_xdrSender","disableTelemetry","CannotSendEmptyTelemetry","SenderNotInitialized","bufferPayload","batch","maxBatchSizeInBytes","triggerSend","_setupTimer","FailedAddingTelemetryToBuffer","_timeoutHandle","retryInterval","max","timerValue","maxBatchInterval","setTimeout","_getSizeInBytes","list","size","clearTimeout","TransmissionFailed","_setRetryTime","delayInSeconds","backOffSlot","pow","backOffDelay","retryAfterTimeSpan","_parseResponse","response","itemsReceived","itemsAccepted","errors","InvalidBackendResponse","_isRetriable","statusCode","_resendPayload","_i","payload_1","_formatErrorMessageXhr","responseText","_formatErrorMessageXdr","xdr","isAsync","endpointUrl","onreadystatechange","_xhrReadyStateChange","onerror","event","_onError","onload","_xdrOnLoad","hostingProtocol","lastIndexOf","countOfItemsInPayload","isRetryDisabled","_onPartialSuccess","_onSuccess","results","failed","retry","reverse","errors_1","extracted","splice","index","OnError","MaxBeaconPayloadSize","Domain","MessageData","sanitizeKeyAndAddUniqueness","origLength","sanitizeKey","uniqueField","MAX_NAME_LENGTH","padNumber","NameTooLong","MAX_STRING_LENGTH","StringValueTooLong","MAX_URL_LENGTH","UrlTooLong","sanitizeMessage","MAX_MESSAGE_LENGTH","MessageTruncated","sanitizeException","MAX_EXCEPTION_LENGTH","ExceptionTruncated","sanitizeProperties","tempProps","prop","sanitizeMeasurements","measurements","tempMeasurements","measure","s","substr","Trace","severityLevel","Default","envelopeType","dataType","EventData","Event","ExceptionDetails","hasFullStack","parsedStack","ExceptionData","exceptions","StackFrame","Exception","handledAt","_ExceptionDetails","CreateSimpleException","typeName","assembly","fileName","details","line","outerId","parseStack","frames","level","totalSizeInBytes","frame","_StackFrame","regex","test","parsedFrame","sizeInBytes","left","right","acceptedLeft","acceptedRight","lSize","rSize","howMany","matches","baseSize","MetricData","metrics","DataPointType","DataPoint","kind","Measurement","stdDev","Metric","dataPoint","PageViewData","PageView","durationMs","duration","PageViewPerfData","PageViewPerformance","unused","perfTotal","networkConnect","sentRequest","receivedResponse","domProcessing","isValid","getPerformanceTiming","total","getDuration","loadEventEnd","network","connectEnd","request","requestStart","responseStart","responseEnd","dom","ErrorPVCalc","shouldCollectDuration","ClientPerformanceMathError","InvalidDurationValue","getIsValid","getDurationMs","isPerformanceTimingSupported","isPerformanceTimingDataReady","domainLookupStart","domLoading","durations","MAX_DURATION_ALLOWED","TelemetryContext","telemetryInitializers","_sessionManager","application","device","internal","user","session","sample","_addDefaultTelemetryInitializers","addTelemetryInitializer","telemetryInitializer","track","_track","TrackArgumentsNotSpecified","isBrowserLinkTrackingEnabled","browserLinkPaths_1","dropBrowserLinkRequests","RemoteDependencyData","remoteData","baseData","_applySessionContext","_applyApplicationContext","_applyDeviceContext","_applyInternalContext","_applyLocationContext","_applySampleContext","_applyUserContext","_applyOperationContext","instrumentationKey","doNotSendItem","telemetryInitializersCount","TelemetryInitializerFailed","_fixDepricatedValues","iKeyNoDashes","TelemetrySampledAndNotSent","SampleRate","appContext","build","deviceContext","ip","language","locale","model","oemName","os","osversion","resolution","internalContext","agentVersion","locationContext","operationContext","parentId","syntheticSource","sampleContext","sessionContext","userContext","agent","storeRegion","baseType","rddData","_fixRDDDepricatedValues","FailedToFixDepricatedValues","commandName","dependencyTypeName","dependencySource","dependencyKind","Data","PageViewManager","overridePageViewDuration","pageViewPerformanceSent","trackPageView","title","pageViewSent","customDuration","sendPageViewInternal","flush","NavigationTimingNotSupported","handle","setInterval","clearInterval","pageViewPerformance","sendPageViewPerformanceInternal","TrackPVFailedCalc","PageVisitTimeManager","pageVisitTimeTrackingHandler","prevPageVisitDataKeyName","trackPreviousPageVisit","currentPageName","currentPageUrl","prevPageVisitTimeData","restartPageVisitTimer","pageName","pageVisitTime","prevPageVisitData","stopPageVisitTimer","startPageVisitTimer","currPageVisitData","PageVisitData","currPageVisitDataStr","pageVisitEndTime","pageVisitDataJsonStr","pageVisitStartTime","DependencyKind","DependencySourceType","Aggregation","Other","success","Apmc","resultCode","target","Http","parsedUrl","pathName","SplitTest","isEnabled","percentEnabled","AppInsights","_trackAjaxAttempts","defaults","defaultConfig","enableDebug","configGetters","samplingPercentage","isCookieUseDisabled","isStorageUseDisabled","_pageViewManager","_eventTracking","Timing","action","_pageTracking","_pageVisitTimeManager","trackPageVisitTime","disableAjaxTracking","_ajaxMonitor","pageView","pageViewPerformanceData","pageViewPerformanceEnvelope","startTrackPage","StartTrackFailed","stopTrackPage","stop","autoTrackPageVisitTime","StopTrackFailed","TrackPVFailed","startTrackEvent","StartTrackEventFailed","stopTrackEvent","StopTrackEventFailed","trackEvent","eventTelemetry","TrackEventFailed","totalTime","maxAjaxCallsPerView","dependency","dependencyData","MaxAjaxPerPVExceeded","trackAjax","trackException","exceptionTelemetry","TrackExceptionFailed","trackMetric","average","sampleCount","telemetry","TrackMetricFailed","trackTrace","TrackTraceFailed","PageName","PageUrl","FlushFailed","SetAuthContextFailed","SendCORSException","exceptionData","_onerror","URL","errorString","exceptionDump","ExceptionWhileLoggingError","_name","_events","StartCalledMoreThanOnce","StopCalledWithoutStart","DataLossAnalyzer","reset","ITEMS_QUEUED_KEY","ISSUES_REPORTED_KEY","itemsRestoredFromSessionBuffer","enabled","getIssuesReported","incrementItemsQueued","itemsQueued","getNumberOfLostItems","decrementItemsQueued","countOfItemsSentSuccessfully","reportLostItems","LIMIT_PER_SESSION","lostItems","issuesReported","FailedToReportDataLoss","Initialization","snippet","getDefaultConfig","loadAppInsights","originalTrackPageView","pagePath","emptyQueue","FailedToSendQueuedTelemetry","pollInteralLogs","appInsightsInstance","diagnosticLogInterval","addHousekeepingBeforeUnload","disableFlushOnBeforeUnload","performHousekeeping","FailedToAddHandlerForOnBeforeUnload","disableExceptionTracking","init","appInsightsLocal"],"mappings":"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","file":"ai.0.js","sourcesContent":["module Microsoft.ApplicationInsights {\r\n\r\n    \"use strict\";\r\n\r\n    export interface IConfig {\r\n        instrumentationKey?: string;\r\n        endpointUrl?: string;\r\n        emitLineDelimitedJson?: boolean;\r\n        accountId?: string;\r\n        sessionRenewalMs?: number;\r\n        sessionExpirationMs?: number;\r\n        maxBatchSizeInBytes?: number;\r\n        maxBatchInterval?: number;\r\n        enableDebug?: boolean;\r\n        disableExceptionTracking?: boolean;\r\n        disableTelemetry?: boolean;\r\n        verboseLogging?: boolean;\r\n        diagnosticLogInterval?: number;\r\n        samplingPercentage?: number;\r\n        autoTrackPageVisitTime?: boolean;\r\n        disableAjaxTracking?: boolean;\r\n        overridePageViewDuration?: boolean;\r\n        maxAjaxCallsPerView?: number;\r\n        disableDataLossAnalysis?: boolean;\r\n        disableCorrelationHeaders?: boolean;\r\n        disableFlushOnBeforeUnload?: boolean;\r\n        enableSessionStorageBuffer?: boolean;\r\n        isCookieUseDisabled?: boolean;\r\n        cookieDomain?: string;\r\n        isRetryDisabled?: boolean;\r\n        url?: string;\r\n        isStorageUseDisabled?: boolean;\r\n        isBeaconApiDisabled?: boolean;\r\n        sdkExtension?: string;\r\n        isBrowserLinkTrackingEnabled?: boolean;\r\n    }\r\n}","// THIS TYPE WAS AUTOGENERATED\r\nmodule Microsoft.Telemetry\r\n{\r\n\"use strict\";\r\n    export class Base\r\n    {\r\n        public baseType: string;\r\n        \r\n        constructor()\r\n        {\r\n        }\r\n    }\r\n}\r\n","// THIS TYPE WAS AUTOGENERATED\r\n/// <reference path=\"Base.ts\" />\r\nmodule Microsoft.Telemetry\r\n{\r\n\"use strict\";\r\n    export class Envelope\r\n    {\r\n        public ver: number;\r\n        public name: string;\r\n        public time: string;\r\n        public sampleRate: number;\r\n        public seq: string;\r\n        public iKey: string;\r\n        public flags: number;\r\n        public deviceId: string;\r\n        public os: string;\r\n        public osVer: string;\r\n        public appId: string;\r\n        public appVer: string;\r\n        public userId: string;\r\n        public tags: any;\r\n        public data: Base;\r\n        \r\n        constructor()\r\n        {\r\n            this.ver = 1;\r\n            this.sampleRate = 100.0;\r\n            this.tags = {};\r\n        }\r\n    }\r\n}\r\n","module Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface IApplication {\r\n        /**\r\n         * The application version.\r\n         */\r\n        ver: string;\r\n\r\n        /**\r\n         * The application build version.\r\n         */\r\n        build: string;\r\n    }\r\n}","module Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface IDevice {\r\n        /**\r\n         * The type for the current device.\r\n         */\r\n        type: string;\r\n\r\n        /**\r\n         * A device unique ID.\r\n         */\r\n        id: string;\r\n\r\n        /**\r\n         * The device OEM for the current device.\r\n         */\r\n        oemName: string;\r\n\r\n        /**\r\n         * The device model for the current device.\r\n         */\r\n        model: string;\r\n\r\n        /**\r\n         * The IANA interface type for the internet connected network adapter.\r\n         */\r\n        network: number;\r\n\r\n        /**\r\n         * The application screen resolution.\r\n         */\r\n        resolution: string;\r\n\r\n        /**\r\n         * The current display language of the operating system.\r\n         */\r\n        locale: string;\r\n\r\n        /**\r\n         * The IP address.\r\n         */\r\n        ip: string;\r\n\r\n        /**\r\n         * The device language.\r\n         */\r\n        language: string;\r\n\r\n        /**\r\n         * The OS name.\r\n         */\r\n        os: string;\r\n\r\n        /**\r\n         * The OS version.\r\n         */\r\n        osversion: string;\r\n    }\r\n}","module Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface IInternal {\r\n        /**\r\n        * The SDK version used to create this telemetry item.\r\n        */\r\n        sdkVersion: string;\r\n\r\n        /**\r\n         * The SDK agent version.\r\n         */\r\n        agentVersion: string;\r\n    }\r\n}","module Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface ILocation {\r\n        /**\r\n         * Client IP address for reverse lookup\r\n         */\r\n        ip: string;\r\n    }\r\n}","module Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface IOperation {\r\n        /**\r\n         * Operation id\r\n         */\r\n        id: string;\r\n\r\n        /**\r\n         * Operation name\r\n         */\r\n        name: string;\r\n\r\n        /**\r\n         * Parent operation id\r\n         */\r\n        parentId: string;\r\n\r\n        /**\r\n         * Root operation id\r\n         */\r\n        rootId: string;\r\n\r\n        /**\r\n         * Synthetic source of the operation\r\n         */\r\n        syntheticSource: string;\r\n    }\r\n}","module Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface ISample {\r\n        /**\r\n        * Sample rate\r\n        */\r\n        sampleRate: number;\r\n    }\r\n}","module Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface IUser {\r\n        /**\r\n        * The telemetry configuration.\r\n        */\r\n        config: any;\r\n\r\n        /**\r\n         * The user ID.\r\n         */\r\n        id: string;\r\n\r\n        /**\r\n         * Authenticated user id\r\n         */\r\n        authenticatedId: string;\r\n\r\n        /**\r\n         * The account ID.\r\n         */\r\n        accountId: string;\r\n\r\n        /**\r\n         * The account acquisition date.\r\n         */\r\n        accountAcquisitionDate: string;\r\n\r\n        /**\r\n         * The user agent string.\r\n         */\r\n        agent: string;\r\n\r\n        /**\r\n         * The store region.\r\n         */\r\n        storeRegion: string;\r\n    }\r\n}","module Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface ISession {\r\n        /**\r\n        * The session ID.\r\n        */\r\n        id: string;\r\n\r\n        /**  \r\n         * The true if this is the first session  \r\n         */\r\n        isFirst: boolean;\r\n\r\n        /**\r\n         * The date at which this guid was genereated.\r\n         * Per the spec the ID will be regenerated if more than acquisitionSpan milliseconds ellapse from this time.\r\n         */\r\n        acquisitionDate: number;\r\n\r\n        /**\r\n         * The date at which this session ID was last reported.\r\n         * This value should be updated whenever telemetry is sent using this ID.\r\n         * Per the spec the ID will be regenerated if more than renewalSpan milliseconds elapse from this time with no activity.\r\n         */\r\n        renewalDate: number;\r\n    }\r\n}","module Microsoft.ApplicationInsights {\r\n\r\n    \"use strict\";\r\n\r\n    export interface ISerializable {\r\n        /**\r\n         * The set of fields for a serializable object. \r\n         * This defines the serialization order and a value of true/false\r\n         * for each field defines whether the field is required or not.\r\n         */\r\n        aiDataContract: any;\r\n    }\r\n}\r\n","/// <reference path=\"./ISerializable.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n\r\n    \"use strict\";\r\n\r\n    export interface IEnvelope extends ISerializable {\r\n        ver: number;\r\n        name: string;\r\n        time: string;\r\n        sampleRate: number;\r\n        seq: string;\r\n        iKey: string;\r\n        flags: number;\r\n        deviceId: string;\r\n        os: string;\r\n        osVer: string;\r\n        appId: string;\r\n        appVer: string;\r\n        userId: string;\r\n        tags: { [name: string]: any };\r\n        data: any;\r\n    }\r\n}\r\n","/// <reference path=\"./Contracts/Generated/Envelope.ts\" />\r\n/// <reference path=\"./Context/IApplication.ts\"/>\r\n/// <reference path=\"./Context/IDevice.ts\"/>\r\n/// <reference path=\"./Context/IInternal.ts\"/>\r\n/// <reference path=\"./Context/ILocation.ts\"/>\r\n/// <reference path=\"./Context/IOperation.ts\"/>\r\n/// <reference path=\"./Context/ISample.ts\"/>\r\n/// <reference path=\"./Context/IUser.ts\"/>\r\n/// <reference path=\"./Context/ISession.ts\"/>\r\n/// <reference path=\"./Telemetry/IEnvelope.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n\r\n    \"use strict\";\r\n\r\n    export interface ITelemetryContext {\r\n         /**\r\n         * The object describing a component tracked by this object.\r\n         */\r\n        application: Context.IApplication;\r\n\r\n        /**\r\n         * The object describing a device tracked by this object.\r\n         */\r\n        device: Context.IDevice;\r\n\r\n        /**\r\n        * The object describing internal settings.\r\n        */\r\n        internal: Context.IInternal;\r\n\r\n        /**\r\n         * The object describing a location tracked by this object.\r\n         */\r\n        location: Context.ILocation;\r\n\r\n        /**\r\n         * The object describing a operation tracked by this object.\r\n         */\r\n        operation: Context.IOperation;\r\n\r\n        /**\r\n        * The object describing sampling settings.\r\n        */\r\n        sample: Context.ISample;\r\n\r\n        /**\r\n         * The object describing a user tracked by this object.\r\n         */\r\n        user: Context.IUser;\r\n\r\n        /**\r\n         * The object describing a session tracked by this object.\r\n         */\r\n        session: Context.ISession;\r\n\r\n        /**\r\n        * Adds a telemetry initializer to the collection. Telemetry initializers will be called one by one, \r\n        * in the order they were added, before the telemetry item is pushed for sending. \r\n        * If one of the telemetry initializers returns false or throws an error then the telemetry item will not be sent. \r\n        * If it returns true or doesn't return any value the event will be passed to the next telemetry initializer and\r\n        * send to the cloud (if not rejected by other initializers). \r\n        */\r\n        addTelemetryInitializer(telemetryInitializer: (envelope: Microsoft.ApplicationInsights.IEnvelope) => boolean | void);\r\n\r\n         /**\r\n         * Tracks telemetry object.\r\n         */\r\n        track(envelope: Microsoft.ApplicationInsights.IEnvelope);\r\n    }\r\n}","// THIS TYPE WAS AUTOGENERATED\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export enum SeverityLevel\r\n    {\r\n        Verbose = 0,\r\n        Information = 1,\r\n        Warning = 2,\r\n        Error = 3,\r\n        Critical = 4,\r\n    }\r\n}\r\n","/// <reference path=\"./IConfig.ts\" />\r\n/// <reference path=\"./ITelemetryContext.ts\" />\r\n/// <reference path=\"./Contracts/Generated/SeverityLevel.ts\" />\r\n\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n\r\n    \"use strict\";\r\n\r\n    export interface IAppInsights {\r\n\r\n        /*\r\n        * Config object used to initialize AppInsights\r\n        */\r\n        config: IConfig;\r\n\r\n        context: ITelemetryContext;\r\n\r\n        /*\r\n        * Initialization queue. Contains functions to run when appInsights initializes\r\n        */\r\n        queue: Array<() => void>;\r\n\r\n        /**\r\n        * Starts timing how long the user views a page or other item. Call this when the page opens. \r\n        * This method doesn't send any telemetry. Call {@link stopTrackTelemetry} to log the page when it closes.\r\n        * @param   name  A string that idenfities this item, unique within this HTML document. Defaults to the document title.\r\n        */\r\n        startTrackPage(name?: string);\r\n\r\n        /**\r\n        * Logs how long a page or other item was visible, after {@link startTrackPage}. Call this when the page closes. \r\n        * @param   name  The string you used as the name in startTrackPage. Defaults to the document title.\r\n        * @param   url   String - a relative or absolute URL that identifies the page or other item. Defaults to the window location.\r\n        * @param   properties  map[string, string] - additional data used to filter pages and metrics in the portal. Defaults to empty.\r\n        * @param   measurements    map[string, number] - metrics associated with this page, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n        */\r\n        stopTrackPage(name?: string, url?: string, properties?: { [name: string]: string; }, measurements?: { [name: string]: number; });\r\n\r\n        /**\r\n         * Logs that a page or other item was viewed. \r\n         * @param   name  The string you used as the name in startTrackPage. Defaults to the document title.\r\n         * @param   url   String - a relative or absolute URL that identifies the page or other item. Defaults to the window location.\r\n         * @param   properties  map[string, string] - additional data used to filter pages and metrics in the portal. Defaults to empty.\r\n         * @param   measurements    map[string, number] - metrics associated with this page, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         * @param   duration    number - the number of milliseconds it took to load the page. Defaults to undefined. If set to default value, page load time is calculated internally.\r\n         */\r\n        trackPageView(name?: string, url?: string, properties?: { [name: string]: string; }, measurements?: { [name: string]: number; }, duration?: number);\r\n\r\n        /**\r\n         * Start timing an extended event. Call {@link stopTrackEvent} to log the event when it ends.\r\n         * @param   name    A string that identifies this event uniquely within the document.\r\n         */\r\n        startTrackEvent(name: string);\r\n\r\n\r\n        /** \r\n         * Log an extended event that you started timing with {@link startTrackEvent}.\r\n         * @param   name    The string you used to identify this event in startTrackEvent.\r\n         * @param   properties  map[string, string] - additional data used to filter events and metrics in the portal. Defaults to empty.\r\n         * @param   measurements    map[string, number] - metrics associated with this event, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         */\r\n        stopTrackEvent(name: string, properties?: { [name: string]: string; }, measurements?: { [name: string]: number; });\r\n\r\n        /** \r\n        * Log a user action or other occurrence.\r\n        * @param   name    A string to identify this event in the portal.\r\n        * @param   properties  map[string, string] - additional data used to filter events and metrics in the portal. Defaults to empty.\r\n        * @param   measurements    map[string, number] - metrics associated with this event, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n        */\r\n        trackEvent(name: string, properties?: { [name: string]: string; }, measurements?: { [name: string]: number; });\r\n\r\n        /**\r\n         * Log a dependency call\r\n         * @param id    unique id, this is used by the backend o correlate server requests. Use Util.newId() to generate a unique Id.\r\n         * @param method    represents request verb (GET, POST, etc.)\r\n         * @param absoluteUrl   absolute url used to make the dependency request\r\n         * @param pathName  the path part of the absolute url\r\n         * @param totalTime total request time\r\n         * @param success   indicates if the request was sessessful\r\n         * @param resultCode    response code returned by the dependency request\r\n         */\r\n        trackDependency(id: string, method: string, absoluteUrl: string, pathName: string, totalTime: number, success: boolean, resultCode: number);\r\n\r\n        /**\r\n         * Log an exception you have caught.\r\n         * @param   exception   An Error from a catch clause, or the string error message.\r\n         * @param   properties  map[string, string] - additional data used to filter events and metrics in the portal. Defaults to empty.\r\n         * @param   measurements    map[string, number] - metrics associated with this event, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         * @param   severityLevel   AI.SeverityLevel - severity level\r\n         */\r\n        trackException(exception: Error, handledAt?: string, properties?: { [name: string]: string; }, measurements?: { [name: string]: number; }, severityLevel?: AI.SeverityLevel);\r\n\r\n        /**\r\n         * Log a numeric value that is not associated with a specific event. Typically used to send regular reports of performance indicators.\r\n         * To send a single measurement, use just the first two parameters. If you take measurements very frequently, you can reduce the \r\n         * telemetry bandwidth by aggregating multiple measurements and sending the resulting average at intervals.\r\n         * @param   name    A string that identifies the metric.\r\n         * @param   average Number representing either a single measurement, or the average of several measurements.\r\n         * @param   sampleCount The number of measurements represented by the average. Defaults to 1.\r\n         * @param   min The smallest measurement in the sample. Defaults to the average.\r\n         * @param   max The largest measurement in the sample. Defaults to the average.\r\n         */\r\n        trackMetric(name: string, average: number, sampleCount?: number, min?: number, max?: number, properties?: { [name: string]: string; });\r\n\r\n        /**\r\n        * Log a diagnostic message. \r\n        * @param   message A message string \r\n        * @param   properties  map[string, string] - additional data used to filter traces in the portal. Defaults to empty.\r\n        * @param   severityLevel   AI.SeverityLevel - severity level\r\n        */\r\n        trackTrace(message: string, properties?: { [name: string]: string; }, severityLevel?: AI.SeverityLevel);\r\n\r\n\r\n        /**\r\n         * Immediately send all queued telemetry.\r\n         * @param {boolean} async - If flush should be call asynchronously\r\n         */\r\n        flush(async?: boolean);\r\n\r\n\r\n        /**\r\n        * Sets the autheticated user id and the account id in this session.\r\n        * User auth id and account id should be of type string. They should not contain commas, semi-colons, equal signs, spaces, or vertical-bars.\r\n        *   \r\n        * @param authenticatedUserId {string} - The authenticated user id. A unique and persistent string that represents each authenticated user in the service.\r\n        * @param accountId {string} - An optional string to represent the account associated with the authenticated user.\r\n        */\r\n        setAuthenticatedUserContext(authenticatedUserId: string, accountId?: string);\r\n\r\n\r\n        /**\r\n         * Clears the authenticated user id and the account id from the user context.\r\n         */\r\n        clearAuthenticatedUserContext();\r\n\r\n        /*\r\n        * Downloads and initializes AppInsights. You can override default script download location by specifying url property of `config`.\r\n        */\r\n        downloadAndSetup?(config: Microsoft.ApplicationInsights.IConfig): void;\r\n\r\n        /**\r\n         * The custom error handler for Application Insights\r\n         * @param {string} message - The error message\r\n         * @param {string} url - The url where the error was raised\r\n         * @param {number} lineNumber - The line number where the error was raised\r\n         * @param {number} columnNumber - The column number for the line where the error was raised\r\n         * @param {Error}  error - The Error object\r\n         */\r\n        _onerror(message: string, url: string, lineNumber: number, columnNumber: number, error: Error);\r\n    }\r\n}","module Microsoft.ApplicationInsights {\r\n\r\n    export enum LoggingSeverity {\r\n        /**\r\n         * Error will be sent as internal telemetry\r\n         */\r\n        CRITICAL = 0,\r\n\r\n        /**\r\n         * Error will NOT be sent as internal telemetry, and will only be shown in browser console\r\n         */\r\n        WARNING = 1\r\n    }\r\n\r\n    /**\r\n     * Internal message ID. Please create a new one for every conceptually different message. Please keep alphabetically ordered\r\n     */\r\n    export enum _InternalMessageId {\r\n        // Non user actionable\r\n        BrowserDoesNotSupportLocalStorage,\r\n        BrowserCannotReadLocalStorage,\r\n        BrowserCannotReadSessionStorage,\r\n        BrowserCannotWriteLocalStorage,\r\n        BrowserCannotWriteSessionStorage,\r\n        BrowserFailedRemovalFromLocalStorage,\r\n        BrowserFailedRemovalFromSessionStorage,\r\n        CannotSendEmptyTelemetry,\r\n        ClientPerformanceMathError,\r\n        ErrorParsingAISessionCookie,\r\n        ErrorPVCalc,\r\n        ExceptionWhileLoggingError,\r\n        FailedAddingTelemetryToBuffer,\r\n        FailedMonitorAjaxAbort,\r\n        FailedMonitorAjaxDur,\r\n        FailedMonitorAjaxOpen,\r\n        FailedMonitorAjaxRSC,\r\n        FailedMonitorAjaxSend,\r\n        FailedToAddHandlerForOnBeforeUnload,\r\n        FailedToSendQueuedTelemetry,\r\n        FailedToReportDataLoss,\r\n        FlushFailed,\r\n        MessageLimitPerPVExceeded,\r\n        MissingRequiredFieldSpecification,\r\n        NavigationTimingNotSupported,\r\n        OnError,\r\n        SessionRenewalDateIsZero,\r\n        SenderNotInitialized,\r\n        StartTrackEventFailed,\r\n        StopTrackEventFailed,\r\n        StartTrackFailed,\r\n        StopTrackFailed,\r\n        TelemetrySampledAndNotSent,\r\n        TrackEventFailed,\r\n        TrackExceptionFailed,\r\n        TrackMetricFailed,\r\n        TrackPVFailed,\r\n        TrackPVFailedCalc,\r\n        TrackTraceFailed,\r\n        TransmissionFailed,\r\n        FailedToSetStorageBuffer,\r\n        FailedToRestoreStorageBuffer,\r\n        InvalidBackendResponse,\r\n        FailedToFixDepricatedValues,\r\n        InvalidDurationValue,\r\n\r\n        // User actionable\r\n        CannotSerializeObject,\r\n        CannotSerializeObjectNonSerializable,\r\n        CircularReferenceDetected,\r\n        ClearAuthContextFailed,\r\n        ExceptionTruncated,\r\n        IllegalCharsInName,\r\n        ItemNotInArray,\r\n        MaxAjaxPerPVExceeded,\r\n        MessageTruncated,\r\n        NameTooLong,\r\n        SampleRateOutOfRange,\r\n        SetAuthContextFailed,\r\n        SetAuthContextFailedAccountName,\r\n        StringValueTooLong,\r\n        StartCalledMoreThanOnce,\r\n        StopCalledWithoutStart,\r\n        TelemetryInitializerFailed,\r\n        TrackArgumentsNotSpecified,\r\n        UrlTooLong,\r\n        SessionStorageBufferFull,\r\n        CannotAccessCookie,\r\n    }\r\n\r\n    export class _InternalLogMessage {\r\n        public message: string;\r\n        public messageId: _InternalMessageId;\r\n\r\n        /**\r\n         * For user non actionable traces use AI Internal prefix.\r\n         */\r\n        private static AiNonUserActionablePrefix = \"AI (Internal): \";\r\n\r\n        /**\r\n         * Prefix of the traces in portal.\r\n         */\r\n        private static AiUserActionablePrefix = \"AI: \";\r\n\r\n        constructor(msgId: _InternalMessageId, msg: string, isUserAct = false, properties?: Object) {\r\n\r\n            this.messageId = msgId;\r\n            this.message =\r\n                (isUserAct ? _InternalLogMessage.AiUserActionablePrefix : _InternalLogMessage.AiNonUserActionablePrefix) +\r\n                _InternalMessageId[msgId].toString();\r\n\r\n            var diagnosticText =\r\n                (msg ? \" message:\" + _InternalLogMessage.sanitizeDiagnosticText(msg) : \"\") +\r\n                (properties ? \" props:\" + _InternalLogMessage.sanitizeDiagnosticText(JSON.stringify(properties)) : \"\");\r\n\r\n            this.message += diagnosticText;\r\n        }\r\n\r\n        private static sanitizeDiagnosticText(text: string) {\r\n            return \"\\\"\" + text.replace(/\\\"/g, \"\") + \"\\\"\";\r\n        }\r\n    }\r\n\r\n    export class _InternalLogging {\r\n\r\n        /**\r\n        *  Session storage key for the prefix for the key indicating message type already logged\r\n        */\r\n        private static AIInternalMessagePrefix: string = \"AITR_\";\r\n\r\n        /**\r\n         * When this is true the SDK will throw exceptions to aid in debugging.\r\n         */\r\n        public static enableDebugExceptions = () => false;\r\n\r\n        /**\r\n         * When this is true the SDK will log more messages to aid in debugging.\r\n         */\r\n        public static verboseLogging = () => false;\r\n\r\n        /**\r\n         * The internal logging queue\r\n         */\r\n        public static queue: Array<_InternalLogMessage> = [];\r\n\r\n        /**\r\n         * The maximum number of internal messages allowed to be sent per page view\r\n         */\r\n        private static MAX_INTERNAL_MESSAGE_LIMIT = 25;\r\n\r\n        /**\r\n         * Count of internal messages sent\r\n         */\r\n        private static _messageCount = 0;\r\n\r\n        /**\r\n         * Holds information about what message types were already logged to console or sent to server.\r\n         */\r\n        private static _messageLogged: { [type: string]: boolean } = {};\r\n\r\n        /**\r\n         * This method will throw exceptions in debug mode or attempt to log the error as a console warning.\r\n         * @param severity {LoggingSeverity} - The severity of the log message\r\n         * @param message {_InternalLogMessage} - The log message.\r\n         */\r\n        public static throwInternal(severity: LoggingSeverity, msgId: _InternalMessageId, msg: string, properties?: Object, isUserAct = false) {\r\n            let message = new _InternalLogMessage(msgId, msg, isUserAct, properties);\r\n\r\n            if (this.enableDebugExceptions()) {\r\n                throw message;\r\n            } else {\r\n                if (typeof (message) !== \"undefined\" && !!message) {\r\n                    if (typeof (message.message) !== \"undefined\") {\r\n                        if (isUserAct) {\r\n                            // check if this message type was already logged to console for this page view and if so, don't log it again\r\n                            var messageKey = _InternalMessageId[message.messageId];\r\n\r\n                            if (!this._messageLogged[messageKey] || this.verboseLogging()) {\r\n                                this.warnToConsole(message.message);\r\n                                this._messageLogged[messageKey] = true;\r\n                            }\r\n                        } else {\r\n                            // don't log internal AI traces in the console, unless the verbose logging is enabled\r\n                            if (this.verboseLogging()) {\r\n                                this.warnToConsole(message.message);\r\n                            }\r\n                        }\r\n\r\n                        this.logInternalMessage(severity, message);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * This will write a warning to the console if possible\r\n         * @param message {string} - The warning message\r\n         */\r\n        public static warnToConsole(message: string) {\r\n            if (typeof console !== \"undefined\" && !!console) {\r\n                if (typeof console.warn === \"function\") {\r\n                    console.warn(message);\r\n                } else if (typeof console.log === \"function\") {\r\n                    console.log(message);\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Resets the internal message count\r\n         */\r\n        public static resetInternalMessageCount(): void {\r\n            this._messageCount = 0;\r\n            this._messageLogged = {};\r\n        }\r\n\r\n        /**\r\n         * Clears the list of records indicating that internal message type was already logged\r\n         */\r\n        public static clearInternalMessageLoggedTypes(): void {\r\n            if (Util.canUseSessionStorage()) {\r\n                var sessionStorageKeys = Util.getSessionStorageKeys();\r\n                for (var i = 0; i < sessionStorageKeys.length; i++) {\r\n                    if (sessionStorageKeys[i].indexOf(_InternalLogging.AIInternalMessagePrefix) === 0) {\r\n                        Util.removeSessionStorage(sessionStorageKeys[i]);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Sets the limit for the number of internal events before they are throttled\r\n         * @param limit {number} - The throttle limit to set for internal events\r\n         */\r\n        public static setMaxInternalMessageLimit(limit: number): void {\r\n            if (!limit) {\r\n                throw new Error('limit cannot be undefined.');\r\n            }\r\n\r\n            this.MAX_INTERNAL_MESSAGE_LIMIT = limit;\r\n        }\r\n\r\n        /**\r\n         * Logs a message to the internal queue.\r\n         * @param severity {LoggingSeverity} - The severity of the log message\r\n         * @param message {_InternalLogMessage} - The message to log.\r\n         */\r\n        private static logInternalMessage(severity: LoggingSeverity, message: _InternalLogMessage): void {\r\n            if (this._areInternalMessagesThrottled()) {\r\n                return;\r\n            }\r\n\r\n            // check if this message type was already logged for this session and if so, don't log it again\r\n            var logMessage = true;\r\n            var messageKey = _InternalLogging.AIInternalMessagePrefix + _InternalMessageId[message.messageId];\r\n\r\n            if (Util.canUseSessionStorage()) {\r\n                var internalMessageTypeLogRecord = Util.getSessionStorage(messageKey);\r\n                if (internalMessageTypeLogRecord) {\r\n                    logMessage = false;\r\n                } else {\r\n                    Util.setSessionStorage(messageKey, \"1\");\r\n                }\r\n            } else {\r\n                // if the session storage is not available, limit to only one message type per page view\r\n                if (this._messageLogged[messageKey]) {\r\n                    logMessage = false;\r\n                } else {\r\n                    this._messageLogged[messageKey] = true;\r\n                }\r\n            }\r\n\r\n            if (logMessage) {\r\n                // Push the event in the internal queue\r\n                if (this.verboseLogging() || severity === LoggingSeverity.CRITICAL) {\r\n                    this.queue.push(message);\r\n                    this._messageCount++;\r\n                }\r\n\r\n                // When throttle limit reached, send a special event\r\n                if (this._messageCount == this.MAX_INTERNAL_MESSAGE_LIMIT) {\r\n                    var throttleLimitMessage = \"Internal events throttle limit per PageView reached for this app.\";\r\n                    var throttleMessage = new _InternalLogMessage(_InternalMessageId.MessageLimitPerPVExceeded, throttleLimitMessage, false);\r\n\r\n                    this.queue.push(throttleMessage);\r\n                    this.warnToConsole(throttleLimitMessage);\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Indicates whether the internal events are throttled\r\n         */\r\n        private static _areInternalMessagesThrottled(): boolean {\r\n            return this._messageCount >= this.MAX_INTERNAL_MESSAGE_LIMIT;\r\n        }\r\n    }\r\n}","/// <reference path=\"./Logging.ts\" />\r\nmodule Microsoft.ApplicationInsights {\r\n\r\n    /**\r\n    * Type of storage to differentiate between local storage and session storage\r\n    */\r\n    enum StorageType {\r\n        LocalStorage,\r\n        SessionStorage\r\n    }\r\n\r\n    export class Util {\r\n        private static document: any = typeof document !== \"undefined\" ? document : {};\r\n        private static _canUseCookies: boolean = undefined;\r\n        private static _canUseLocalStorage: boolean = undefined;\r\n        private static _canUseSessionStorage: boolean = undefined;\r\n        public static NotSpecified = \"not_specified\";\r\n\r\n        /*\r\n         * Force the SDK not to use local and session storage\r\n        */\r\n        public static disableStorage() {\r\n            Util._canUseLocalStorage = false;\r\n            Util._canUseSessionStorage = false;\r\n        }\r\n\r\n        /**\r\n         * Gets the localStorage object if available\r\n         * @return {Storage} - Returns the storage object if available else returns null\r\n         */\r\n        private static _getLocalStorageObject(): Storage {\r\n            if (Util.canUseLocalStorage()) {\r\n                return Util._getVerifiedStorageObject(StorageType.LocalStorage);\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        /**\r\n         * Tests storage object (localStorage or sessionStorage) to verify that it is usable\r\n         * More details here: https://mathiasbynens.be/notes/localstorage-pattern\r\n         * @param storageType Type of storage\r\n         * @return {Storage} Returns storage object verified that it is usable\r\n         */\r\n        private static _getVerifiedStorageObject(storageType: StorageType): Storage {\r\n            var storage: Storage = null;\r\n            var fail: boolean;\r\n            var uid;\r\n            try {\r\n                uid = new Date;\r\n                storage = storageType === StorageType.LocalStorage ? window.localStorage : window.sessionStorage;\r\n                storage.setItem(uid, uid);\r\n                fail = storage.getItem(uid) != uid;\r\n                storage.removeItem(uid);\r\n                if (fail) {\r\n                    storage = null;\r\n                }\r\n            } catch (exception) {\r\n                storage = null;\r\n            }\r\n\r\n            return storage;\r\n        }\r\n\r\n        /**\r\n         *  Check if the browser supports local storage.\r\n         *\r\n         *  @returns {boolean} True if local storage is supported.\r\n         */\r\n        public static canUseLocalStorage(): boolean {\r\n            if (Util._canUseLocalStorage === undefined) {\r\n                Util._canUseLocalStorage = !!Util._getVerifiedStorageObject(StorageType.LocalStorage);\r\n            }\r\n\r\n            return Util._canUseLocalStorage;\r\n        }\r\n\r\n        /**\r\n         *  Get an object from the browser's local storage\r\n         *\r\n         *  @param {string} name - the name of the object to get from storage\r\n         *  @returns {string} The contents of the storage object with the given name. Null if storage is not supported.\r\n         */\r\n        public static getStorage(name: string): string {\r\n            var storage = Util._getLocalStorageObject();\r\n            if (storage !== null) {\r\n                try {\r\n                    return storage.getItem(name);\r\n                } catch (e) {\r\n                    Util._canUseLocalStorage = false;\r\n\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.BrowserCannotReadLocalStorage,\r\n                        \"Browser failed read of local storage. \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        /**\r\n         *  Set the contents of an object in the browser's local storage\r\n         *\r\n         *  @param {string} name - the name of the object to set in storage\r\n         *  @param {string} data - the contents of the object to set in storage\r\n         *  @returns {boolean} True if the storage object could be written.\r\n         */\r\n        public static setStorage(name: string, data: string): boolean {\r\n            var storage = Util._getLocalStorageObject();\r\n            if (storage !== null) {\r\n                try {\r\n                    storage.setItem(name, data);\r\n                    return true;\r\n                } catch (e) {\r\n                    Util._canUseLocalStorage = false;\r\n\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.BrowserCannotWriteLocalStorage,\r\n                        \"Browser failed write to local storage. \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n        /**\r\n         *  Remove an object from the browser's local storage\r\n         *\r\n         *  @param {string} name - the name of the object to remove from storage\r\n         *  @returns {boolean} True if the storage object could be removed.\r\n         */\r\n        public static removeStorage(name: string): boolean {\r\n            var storage = Util._getLocalStorageObject();\r\n            if (storage !== null) {\r\n                try {\r\n                    storage.removeItem(name);\r\n                    return true;\r\n                } catch (e) {\r\n                    Util._canUseLocalStorage = false;\r\n\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.BrowserFailedRemovalFromLocalStorage,\r\n                        \"Browser failed removal of local storage item. \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n        /**\r\n         * Gets the sessionStorage object if available\r\n         * @return {Storage} - Returns the storage object if available else returns null\r\n         */\r\n        private static _getSessionStorageObject(): Storage {\r\n            if (Util.canUseSessionStorage()) {\r\n                return Util._getVerifiedStorageObject(StorageType.SessionStorage);\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        /**\r\n         *  Check if the browser supports session storage.\r\n         *\r\n         *  @returns {boolean} True if session storage is supported.\r\n         */\r\n        public static canUseSessionStorage(): boolean {\r\n            if (Util._canUseSessionStorage === undefined) {\r\n                Util._canUseSessionStorage = !!Util._getVerifiedStorageObject(StorageType.SessionStorage);\r\n            }\r\n\r\n            return Util._canUseSessionStorage;\r\n        }\r\n\r\n        /**\r\n         *  Gets the list of session storage keys\r\n         *\r\n         *  @returns {string[]} List of session storage keys\r\n         */\r\n        public static getSessionStorageKeys(): string[] {\r\n            var keys = [];\r\n\r\n            if (Util.canUseSessionStorage()) {\r\n                for (var key in window.sessionStorage) {\r\n                    keys.push(key);\r\n                }\r\n            }\r\n            return keys;\r\n        }\r\n\r\n        /**\r\n         *  Get an object from the browser's session storage\r\n         *\r\n         *  @param {string} name - the name of the object to get from storage\r\n         *  @returns {string} The contents of the storage object with the given name. Null if storage is not supported.\r\n         */\r\n        public static getSessionStorage(name: string): string {\r\n            var storage = Util._getSessionStorageObject();\r\n            if (storage !== null) {\r\n                try {\r\n                    return storage.getItem(name);\r\n                } catch (e) {\r\n                    Util._canUseSessionStorage = false;\r\n\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.BrowserCannotReadSessionStorage,\r\n                        \"Browser failed read of session storage. \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        /**\r\n         *  Set the contents of an object in the browser's session storage\r\n         *\r\n         *  @param {string} name - the name of the object to set in storage\r\n         *  @param {string} data - the contents of the object to set in storage\r\n         *  @returns {boolean} True if the storage object could be written.\r\n         */\r\n        public static setSessionStorage(name: string, data: string): boolean {\r\n            var storage = Util._getSessionStorageObject();\r\n            if (storage !== null) {\r\n                try {\r\n                    storage.setItem(name, data);\r\n                    return true;\r\n                } catch (e) {\r\n                    Util._canUseSessionStorage = false;\r\n\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.BrowserCannotWriteSessionStorage,\r\n                        \"Browser failed write to session storage. \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n        /**\r\n         *  Remove an object from the browser's session storage\r\n         *\r\n         *  @param {string} name - the name of the object to remove from storage\r\n         *  @returns {boolean} True if the storage object could be removed.\r\n         */\r\n        public static removeSessionStorage(name: string): boolean {\r\n            var storage = Util._getSessionStorageObject();\r\n            if (storage !== null) {\r\n                try {\r\n                    storage.removeItem(name);\r\n                    return true;\r\n                } catch (e) {\r\n                    Util._canUseSessionStorage = false;\r\n\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.BrowserFailedRemovalFromSessionStorage,\r\n                        \"Browser failed removal of session storage item. \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n        /*\r\n         * Force the SDK not to store and read any data from cookies\r\n         */\r\n        public static disableCookies() {\r\n            Util._canUseCookies = false;\r\n        }\r\n\r\n        /*\r\n         * helper method to tell if document.cookie object is available\r\n         */\r\n        public static canUseCookies(): any {\r\n            if (Util._canUseCookies === undefined) {\r\n                Util._canUseCookies = false;\r\n\r\n                try {\r\n                    Util._canUseCookies = Util.document.cookie !== undefined;\r\n                } catch (e) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.CannotAccessCookie,\r\n                        \"Cannot access document.cookie - \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                };\r\n            }\r\n\r\n            return Util._canUseCookies;\r\n        }\r\n\r\n        /**\r\n         * helper method to set userId and sessionId cookie\r\n         */\r\n        public static setCookie(name, value, domain?) {\r\n            var domainAttrib = \"\";\r\n            var secureAttrib = \"\";\r\n\r\n            if (domain) {\r\n                domainAttrib = \";domain=\" + domain;\r\n            }\r\n\r\n            if (Util.document.location && Util.document.location.protocol === \"https:\") {\r\n                secureAttrib = \";secure\";\r\n            }\r\n\r\n            if (Util.canUseCookies()) {\r\n                Util.document.cookie = name + \"=\" + value + domainAttrib + \";path=/\" + secureAttrib;\r\n            }\r\n        }\r\n\r\n        public static stringToBoolOrDefault(str: any, defaultValue = false): boolean {\r\n            if (str === undefined || str === null) {\r\n                return defaultValue;\r\n            }\r\n\r\n            return str.toString().toLowerCase() === \"true\";\r\n        }\r\n\r\n        /**\r\n         * helper method to access userId and sessionId cookie\r\n         */\r\n        public static getCookie(name) {\r\n            if (!Util.canUseCookies()) {\r\n                return;\r\n            }\r\n\r\n            var value = \"\";\r\n            if (name && name.length) {\r\n                var cookieName = name + \"=\";\r\n                var cookies = Util.document.cookie.split(\";\");\r\n                for (var i = 0; i < cookies.length; i++) {\r\n                    var cookie = cookies[i];\r\n                    cookie = Util.trim(cookie);\r\n                    if (cookie && cookie.indexOf(cookieName) === 0) {\r\n                        value = cookie.substring(cookieName.length, cookies[i].length);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return value;\r\n        }\r\n\r\n        /**\r\n         * Deletes a cookie by setting it's expiration time in the past.\r\n         * @param name - The name of the cookie to delete.\r\n         */\r\n        public static deleteCookie(name: string) {\r\n            if (Util.canUseCookies()) {\r\n                // Setting the expiration date in the past immediately removes the cookie\r\n                Util.document.cookie = name + \"=;path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;\";\r\n            }\r\n        }\r\n\r\n        /**\r\n         * helper method to trim strings (IE8 does not implement String.prototype.trim)\r\n         */\r\n        public static trim(str: any): string {\r\n            if (typeof str !== \"string\") return str;\r\n            return str.replace(/^\\s+|\\s+$/g, \"\");\r\n        }\r\n\r\n        /**\r\n         * generate random id string\r\n         */\r\n        public static newId(): string {\r\n            var base64chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\r\n\r\n            var result = \"\";\r\n            var random = Math.random() * 1073741824; //5 symbols in base64, almost maxint\r\n\r\n            while (random > 0) {\r\n                var char = base64chars.charAt(random % 64);\r\n                result += char;\r\n                random = Math.floor(random / 64);\r\n            }\r\n            return result;\r\n        }\r\n\r\n        /**\r\n         * Check if an object is of type Array\r\n         */\r\n        public static isArray(obj: any): boolean {\r\n            return Object.prototype.toString.call(obj) === \"[object Array]\";\r\n        }\r\n\r\n        /**\r\n         * Check if an object is of type Error\r\n         */\r\n        public static isError(obj: any): boolean {\r\n            return Object.prototype.toString.call(obj) === \"[object Error]\";\r\n        }\r\n\r\n        /**\r\n         * Check if an object is of type Date\r\n         */\r\n        public static isDate(obj: any): boolean {\r\n            return Object.prototype.toString.call(obj) === \"[object Date]\";\r\n        }\r\n\r\n        /**\r\n         * Convert a date to I.S.O. format in IE8\r\n         */\r\n        public static toISOStringForIE8(date: Date) {\r\n            if (Util.isDate(date)) {\r\n                if (Date.prototype.toISOString) {\r\n                    return date.toISOString();\r\n                } else {\r\n                    const pad = function(number) {\r\n                        var r = String(number);\r\n                        if (r.length === 1) {\r\n                            r = \"0\" + r;\r\n                        }\r\n\r\n                        return r;\r\n                    }\r\n\r\n                    return date.getUTCFullYear()\r\n                        + \"-\" + pad(date.getUTCMonth() + 1)\r\n                        + \"-\" + pad(date.getUTCDate())\r\n                        + \"T\" + pad(date.getUTCHours())\r\n                        + \":\" + pad(date.getUTCMinutes())\r\n                        + \":\" + pad(date.getUTCSeconds())\r\n                        + \".\" + String((date.getUTCMilliseconds() / 1000).toFixed(3)).slice(2, 5)\r\n                        + \"Z\";\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Gets IE version if we are running on IE, or null otherwise\r\n         */\r\n        public static getIEVersion(userAgentStr: string = null): number {\r\n            var myNav = userAgentStr ? userAgentStr.toLowerCase() : navigator.userAgent.toLowerCase();\r\n            return (myNav.indexOf('msie') != -1) ? parseInt(myNav.split('msie')[1]) : null;\r\n        }\r\n\r\n        /**\r\n         * Convert ms to c# time span format\r\n         */\r\n        public static msToTimeSpan(totalms: number): string {\r\n            if (isNaN(totalms) || totalms < 0) {\r\n                totalms = 0;\r\n            }\r\n\r\n            totalms = Math.round(totalms);\r\n\r\n            var ms = \"\" + totalms % 1000;\r\n            var sec = \"\" + Math.floor(totalms / 1000) % 60;\r\n            var min = \"\" + Math.floor(totalms / (1000 * 60)) % 60;\r\n            var hour = \"\" + Math.floor(totalms / (1000 * 60 * 60)) % 24;\r\n            var days = Math.floor(totalms / (1000 * 60 * 60 * 24));\r\n\r\n            ms = ms.length === 1 ? \"00\" + ms : ms.length === 2 ? \"0\" + ms : ms;\r\n            sec = sec.length < 2 ? \"0\" + sec : sec;\r\n            min = min.length < 2 ? \"0\" + min : min;\r\n            hour = hour.length < 2 ? \"0\" + hour : hour;\r\n\r\n            return (days > 0 ? days + \".\" : \"\") + hour + \":\" + min + \":\" + sec + \".\" + ms;\r\n        }\r\n\r\n        /**\t\t\r\n        * Checks if error has no meaningful data inside. Ususally such errors are received by window.onerror when error\t\t\r\n        * happens in a script from other domain (cross origin, CORS).\t\t\r\n        */\r\n        public static isCrossOriginError(message: string, url: string, lineNumber: number, columnNumber: number, error: Error): boolean {\r\n            return (message === \"Script error.\" || message === \"Script error\") && !error;\r\n        }\r\n\r\n        /**\r\n        * Returns string representation of an object suitable for diagnostics logging.\r\n        */\r\n        public static dump(object: any): string {\r\n            var objectTypeDump: string = Object.prototype.toString.call(object);\r\n            var propertyValueDump: string = JSON.stringify(object);\r\n            if (objectTypeDump === \"[object Error]\") {\r\n                propertyValueDump = \"{ stack: '\" + object.stack + \"', message: '\" + object.message + \"', name: '\" + object.name + \"'\";\r\n            }\r\n\r\n            return objectTypeDump + propertyValueDump;\r\n        }\r\n\r\n        /**\r\n        * Returns the name of object if it's an Error. Otherwise, returns empty string.\r\n        */\r\n        public static getExceptionName(object: any): string {\r\n            var objectTypeDump: string = Object.prototype.toString.call(object);\r\n            if (objectTypeDump === \"[object Error]\") {\r\n                return object.name;\r\n            }\r\n            return \"\";\r\n        }\r\n\r\n        /**\r\n         * Adds an event handler for the specified event\r\n         * @param eventName {string} - The name of the event\r\n         * @param callback {any} - The callback function that needs to be executed for the given event \r\n         * @return {boolean} - true if the handler was successfully added\r\n         */\r\n        public static addEventHandler(eventName: string, callback: any): boolean {\r\n            if (!window || typeof eventName !== 'string' || typeof callback !== 'function') {\r\n                return false;\r\n            }\r\n\r\n            // Create verb for the event\r\n            var verbEventName = 'on' + eventName;\r\n\r\n            // check if addEventListener is available\r\n            if (window.addEventListener) {\r\n                window.addEventListener(eventName, callback, false);\r\n            } else if (window[\"attachEvent\"]) { // For older browsers\r\n                window[\"attachEvent\"].call(verbEventName, callback);\r\n            } else { // if all else fails\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        }\r\n\r\n        /**\r\n         * Tells if a browser supports a Beacon API\r\n         */\r\n        public static IsBeaconApiSupported(): boolean {\r\n            return ('sendBeacon' in navigator && (<any>navigator).sendBeacon);\r\n        }\r\n    }\r\n\r\n    export class UrlHelper {\r\n        private static document: any = typeof document !== \"undefined\" ? document : {};\r\n        private static htmlAnchorElement: HTMLAnchorElement;\r\n\r\n        public static parseUrl(url): HTMLAnchorElement {\r\n            if (!UrlHelper.htmlAnchorElement) {\r\n                UrlHelper.htmlAnchorElement = !!UrlHelper.document.createElement ? UrlHelper.document.createElement('a') : {};\r\n            }\r\n\r\n            UrlHelper.htmlAnchorElement.href = url;\r\n\r\n            return UrlHelper.htmlAnchorElement;\r\n        }\r\n\r\n        public static getAbsoluteUrl(url): string {\r\n            var result: string;\r\n            var a = UrlHelper.parseUrl(url);\r\n            if (a) {\r\n                result = a.href;\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        public static getPathName(url): string {\r\n            var result: string;\r\n            var a = UrlHelper.parseUrl(url);\r\n            if (a) {\r\n                result = a.pathname;\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        public static getCompleteUrl(method: string, absoluteUrl: string) {\r\n            if (method) {\r\n                return method.toUpperCase() + \" \" + absoluteUrl;\r\n            } else {\r\n                return absoluteUrl;\r\n            }\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../JavaScriptSDK.Interfaces/Telemetry/ISerializable.ts\" />\r\n/// <reference path=\"Logging.ts\" />\r\n/// <reference path=\"Util.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Enum is used in aiDataContract to describe how fields are serialized. \r\n     * For instance: (Fieldtype.Required | FieldType.Array) will mark the field as required and indicate it's an array\r\n     */\r\n    export enum FieldType { Default = 0, Required = 1, Array = 2, Hidden = 4 };\r\n\r\n    export class Serializer {\r\n\r\n        /**\r\n         * Serializes the current object to a JSON string.\r\n         */\r\n        public static serialize(input: ISerializable): string {\r\n            var output = Serializer._serializeObject(input, \"root\");\r\n            return JSON.stringify(output);\r\n        }\r\n\r\n        private static _serializeObject(source: ISerializable, name: string): any {\r\n            var circularReferenceCheck = \"__aiCircularRefCheck\";\r\n            var output = {};\r\n\r\n            if (!source) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL, _InternalMessageId.CannotSerializeObject, \"cannot serialize object because it is null or undefined\", { name: name }, true);\r\n                return output;\r\n            }\r\n\r\n            if (source[circularReferenceCheck]) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.WARNING, _InternalMessageId.CircularReferenceDetected, \"Circular reference detected while serializing object\", { name: name }, true);\r\n                return output;\r\n            }\r\n\r\n            if (!source.aiDataContract) {\r\n                // special case for measurements/properties/tags\r\n                if (name === \"measurements\") {\r\n                    output = Serializer._serializeStringMap(source, \"number\", name);\r\n                } else if (name === \"properties\") {\r\n                    output = Serializer._serializeStringMap(source, \"string\", name);\r\n                } else if (name === \"tags\") {\r\n                    output = Serializer._serializeStringMap(source, \"string\", name);\r\n                } else if (Util.isArray(source)) {\r\n                    output = Serializer._serializeArray(<any>source, name);\r\n                } else {\r\n                    _InternalLogging.throwInternal(LoggingSeverity.WARNING, _InternalMessageId.CannotSerializeObjectNonSerializable, \"Attempting to serialize an object which does not implement ISerializable\", { name: name }, true);\r\n\r\n                    try {\r\n                        // verify that the object can be stringified\r\n                        JSON.stringify(source);\r\n                        output = source;\r\n                    } catch (e) {\r\n                        // if serialization fails return an empty string\r\n                        _InternalLogging.throwInternal(LoggingSeverity.CRITICAL, _InternalMessageId.CannotSerializeObject, (e && typeof e.toString === 'function') ? e.toString() : \"Error serializing object\", null, true);\r\n                    }\r\n                }\r\n\r\n                return output;\r\n            }\r\n            \r\n            source[circularReferenceCheck] = true;\r\n            for (var field in source.aiDataContract) {\r\n\r\n                var contract = source.aiDataContract[field];\r\n                var isRequired = (typeof contract === \"function\") ? (contract() & FieldType.Required) : (contract & FieldType.Required);\r\n                var isHidden = (typeof contract === \"function\") ? (contract() & FieldType.Hidden) : (contract & FieldType.Hidden);\r\n                var isArray = contract & FieldType.Array;\r\n\r\n                var isPresent = source[field] !== undefined;\r\n                var isObject = typeof source[field] === \"object\" && source[field] !== null;\r\n\r\n                if (isRequired && !isPresent && !isArray) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.CRITICAL,\r\n                        _InternalMessageId.MissingRequiredFieldSpecification,\r\n                        \"Missing required field specification. The field is required but not present on source\",\r\n                        { field: field, name: name });\r\n\r\n                    // If not in debug mode, continue and hope the error is permissible\r\n                    continue;\r\n                }\r\n\r\n                if (isHidden) {\r\n                    // Don't serialize hidden fields\r\n                    continue;\r\n                }\r\n\r\n                var value;\r\n                if (isObject) {\r\n                    if (isArray) {\r\n                        // special case; resurse on each object in the source array\r\n                        value = Serializer._serializeArray(source[field], field);\r\n                    } else {\r\n                        // recurse on the source object in this field\r\n                        value = Serializer._serializeObject(source[field], field);\r\n                    }\r\n                } else {\r\n                    // assign the source field to the output even if undefined or required\r\n                    value = source[field];\r\n                }\r\n\r\n                // only emit this field if the value is defined\r\n                if (value !== undefined) {\r\n                    output[field] = value;\r\n                }\r\n            }\r\n\r\n            delete source[circularReferenceCheck];\r\n            return output;\r\n        }\r\n\r\n        private static _serializeArray(sources: Array<ISerializable>, name: string): Array<any> {\r\n            var output = undefined;\r\n\r\n            if (!!sources) {\r\n                if (!Util.isArray(sources)) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.CRITICAL,\r\n                        _InternalMessageId.ItemNotInArray,\r\n                        \"This field was specified as an array in the contract but the item is not an array.\\r\\n\",\r\n                        { name: name }, true);\r\n                } else {\r\n                    output = [];\r\n                    for (var i = 0; i < sources.length; i++) {\r\n                        var source = sources[i];\r\n                        var item = Serializer._serializeObject(source, name + \"[\" + i + \"]\");\r\n                        output.push(item);\r\n                    }\r\n                }\r\n            }\r\n\r\n            return output;\r\n        }\r\n\r\n        private static _serializeStringMap(map, expectedType, name) {\r\n            var output = undefined;\r\n            if (map) {\r\n                output = {};\r\n                for (var field in map) {\r\n                    var value = map[field];\r\n                    if (expectedType === \"string\") {\r\n                        if (value === undefined) {\r\n                            output[field] = \"undefined\";\r\n                        } else if (value === null) {\r\n                            output[field] = \"null\";\r\n                        } else if (!value.toString) {\r\n                            output[field] = \"invalid field: toString() is not defined.\";\r\n                        }\r\n                        else {\r\n                            output[field] = value.toString();\r\n                        }\r\n                    }\r\n                    else if (expectedType === \"number\") {\r\n                        if (value === undefined) {\r\n                            output[field] = \"undefined\";\r\n                        } else if (value === null) {\r\n                            output[field] = \"null\";\r\n                        } else {\r\n                            var num = parseFloat(value);\r\n                            if (isNaN(num)) {\r\n                                output[field] = \"NaN\";\r\n                            }\r\n                            else {\r\n                                output[field] = num;\r\n                            }\r\n                        }\r\n                    }\r\n                    else {\r\n                        output[field] = \"invalid field: \" + name + \" is of unknown type.\";\r\n                        _InternalLogging.throwInternal(LoggingSeverity.CRITICAL, output[field], null, true);\r\n                    }\r\n                }\r\n            }\r\n\r\n            return output;\r\n        }\r\n    }\r\n}","/// <reference path=\"../../../JavaScriptSDK.Interfaces/Contracts/Generated/Envelope.ts\" />\r\n/// <reference path=\"../../../JavaScriptSDK.Interfaces/Contracts/Generated/Base.ts\" />\r\n/// <reference path=\"../../Util.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry.Common {\r\n    \"use strict\";\r\n    export class Envelope extends Microsoft.Telemetry.Envelope implements IEnvelope {\r\n\r\n        /**\r\n         * The data contract for serializing this object.\r\n         */\r\n        public aiDataContract;\r\n\r\n        /**\r\n         * Constructs a new instance of telemetry data.\r\n         */\r\n        constructor(data: Microsoft.Telemetry.Base, name: string) {\r\n            super();\r\n\r\n            this.name = Common.DataSanitizer.sanitizeString(name) || Util.NotSpecified;\r\n            this.data = data;\r\n            this.time = Util.toISOStringForIE8(new Date());\r\n\r\n            this.aiDataContract = {\r\n                time: FieldType.Required,\r\n                iKey: FieldType.Required,\r\n                name: FieldType.Required,\r\n                sampleRate: () => {\r\n                    return (this.sampleRate == 100) ? FieldType.Hidden : FieldType.Required;\r\n                },\r\n                tags: FieldType.Required,\r\n                data: FieldType.Required\r\n            };\r\n        }\r\n    }\r\n}","/// <reference path=\"../../../JavaScriptSDK.Interfaces/Contracts/Generated/Base.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry.Common {\r\n    \"use strict\";\r\n\r\n    export class Base extends Microsoft.Telemetry.Base implements ISerializable {\r\n        \r\n        /**\r\n         * The data contract for serializing this object.\r\n         */\r\n        public aiDataContract = {};\r\n    }\r\n}","// THIS TYPE WAS AUTOGENERATED\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export class ContextTagKeys\r\n    {\r\n        public applicationVersion: string;\r\n        public applicationBuild: string;\r\n        public applicationTypeId: string;\r\n        public applicationId: string;\r\n        public deviceId: string;\r\n        public deviceIp: string;\r\n        public deviceLanguage: string;\r\n        public deviceLocale: string;\r\n        public deviceModel: string;\r\n        public deviceNetwork: string;\r\n        public deviceNetworkName: string;\r\n        public deviceOEMName: string;\r\n        public deviceOS: string;\r\n        public deviceOSVersion: string;\r\n        public deviceRoleInstance: string;\r\n        public deviceRoleName: string;\r\n        public deviceScreenResolution: string;\r\n        public deviceType: string;\r\n        public deviceMachineName: string;\r\n        public deviceVMName: string;\r\n        public locationIp: string;\r\n        public operationId: string;\r\n        public operationName: string;\r\n        public operationParentId: string;\r\n        public operationRootId: string;\r\n        public operationSyntheticSource: string;\r\n        public operationIsSynthetic: string;\r\n        public operationCorrelationVector: string;\r\n        public sessionId: string;\r\n        public sessionIsFirst: string;\r\n        public sessionIsNew: string;\r\n        public userAccountAcquisitionDate: string;\r\n        public userAccountId: string;\r\n        public userAgent: string;\r\n        public userId: string;\r\n        public userStoreRegion: string;\r\n        public userAuthUserId: string;\r\n        public userAnonymousUserAcquisitionDate: string;\r\n        public userAuthenticatedUserAcquisitionDate: string;\r\n        public sampleRate: string;\r\n        public cloudName: string;\r\n        public cloudRoleVer: string;\r\n        public cloudEnvironment: string;\r\n        public cloudLocation: string;\r\n        public cloudDeploymentUnit: string;\r\n        public serverDeviceOS: string;\r\n        public serverDeviceOSVer: string;\r\n        public internalSdkVersion: string;\r\n        public internalAgentVersion: string;\r\n        public internalDataCollectorReceivedTime: string;\r\n        public internalProfileId: string;\r\n        public internalProfileClassId: string;\r\n        public internalAccountId: string;\r\n        public internalApplicationName: string;\r\n        public internalInstrumentationKey: string;\r\n        public internalTelemetryItemId: string;\r\n        public internalApplicationType: string;\r\n        public internalRequestSource: string;\r\n        public internalFlowType: string;\r\n        public internalIsAudit: string;\r\n        public internalTrackingSourceId: string;\r\n        public internalTrackingType: string;\r\n        public internalIsDiagnosticExample: string;\r\n        \r\n        constructor()\r\n        {\r\n            this.applicationVersion = \"ai.application.ver\";\r\n            this.applicationBuild = \"ai.application.build\";\r\n            this.applicationTypeId = \"ai.application.typeId\";\r\n            this.applicationId = \"ai.application.applicationId\";\r\n            this.deviceId = \"ai.device.id\";\r\n            this.deviceIp = \"ai.device.ip\";\r\n            this.deviceLanguage = \"ai.device.language\";\r\n            this.deviceLocale = \"ai.device.locale\";\r\n            this.deviceModel = \"ai.device.model\";\r\n            this.deviceNetwork = \"ai.device.network\";\r\n            this.deviceNetworkName = \"ai.device.networkName\";\r\n            this.deviceOEMName = \"ai.device.oemName\";\r\n            this.deviceOS = \"ai.device.os\";\r\n            this.deviceOSVersion = \"ai.device.osVersion\";\r\n            this.deviceRoleInstance = \"ai.device.roleInstance\";\r\n            this.deviceRoleName = \"ai.device.roleName\";\r\n            this.deviceScreenResolution = \"ai.device.screenResolution\";\r\n            this.deviceType = \"ai.device.type\";\r\n            this.deviceMachineName = \"ai.device.machineName\";\r\n            this.deviceVMName = \"ai.device.vmName\";\r\n            this.locationIp = \"ai.location.ip\";\r\n            this.operationId = \"ai.operation.id\";\r\n            this.operationName = \"ai.operation.name\";\r\n            this.operationParentId = \"ai.operation.parentId\";\r\n            this.operationRootId = \"ai.operation.rootId\";\r\n            this.operationSyntheticSource = \"ai.operation.syntheticSource\";\r\n            this.operationIsSynthetic = \"ai.operation.isSynthetic\";\r\n            this.operationCorrelationVector = \"ai.operation.correlationVector\";\r\n            this.sessionId = \"ai.session.id\";\r\n            this.sessionIsFirst = \"ai.session.isFirst\";\r\n            this.sessionIsNew = \"ai.session.isNew\";\r\n            this.userAccountAcquisitionDate = \"ai.user.accountAcquisitionDate\";\r\n            this.userAccountId = \"ai.user.accountId\";\r\n            this.userAgent = \"ai.user.userAgent\";\r\n            this.userId = \"ai.user.id\";\r\n            this.userStoreRegion = \"ai.user.storeRegion\";\r\n            this.userAuthUserId = \"ai.user.authUserId\";\r\n            this.userAnonymousUserAcquisitionDate = \"ai.user.anonUserAcquisitionDate\";\r\n            this.userAuthenticatedUserAcquisitionDate = \"ai.user.authUserAcquisitionDate\";\r\n            this.sampleRate = \"ai.sample.sampleRate\";\r\n            this.cloudName = \"ai.cloud.name\";\r\n            this.cloudRoleVer = \"ai.cloud.roleVer\";\r\n            this.cloudEnvironment = \"ai.cloud.environment\";\r\n            this.cloudLocation = \"ai.cloud.location\";\r\n            this.cloudDeploymentUnit = \"ai.cloud.deploymentUnit\";\r\n            this.serverDeviceOS = \"ai.serverDevice.os\";\r\n            this.serverDeviceOSVer = \"ai.serverDevice.osVer\";\r\n            this.internalSdkVersion = \"ai.internal.sdkVersion\";\r\n            this.internalAgentVersion = \"ai.internal.agentVersion\";\r\n            this.internalDataCollectorReceivedTime = \"ai.internal.dataCollectorReceivedTime\";\r\n            this.internalProfileId = \"ai.internal.profileId\";\r\n            this.internalProfileClassId = \"ai.internal.profileClassId\";\r\n            this.internalAccountId = \"ai.internal.accountId\";\r\n            this.internalApplicationName = \"ai.internal.applicationName\";\r\n            this.internalInstrumentationKey = \"ai.internal.instrumentationKey\";\r\n            this.internalTelemetryItemId = \"ai.internal.telemetryItemId\";\r\n            this.internalApplicationType = \"ai.internal.applicationType\";\r\n            this.internalRequestSource = \"ai.internal.requestSource\";\r\n            this.internalFlowType = \"ai.internal.flowType\";\r\n            this.internalIsAudit = \"ai.internal.isAudit\";\r\n            this.internalTrackingSourceId = \"ai.internal.trackingSourceId\";\r\n            this.internalTrackingType = \"ai.internal.trackingType\";\r\n            this.internalIsDiagnosticExample = \"ai.internal.isDiagnosticExample\";\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../JavaScriptSDK.Interfaces/Context/IApplication.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export class Application implements IApplication {\r\n        /**\r\n         * The application version.\r\n         */\r\n        public ver: string;\r\n\r\n        /**\r\n         * The application build version.\r\n         */\r\n        public build: string;\r\n    }\r\n}","/// <reference path=\"../../JavaScriptSDK.Interfaces/Context/IDevice.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export class Device implements IDevice {\r\n\r\n        /**\r\n         * The type for the current device.\r\n         */\r\n        public type: string;\r\n\r\n        /**\r\n         * A device unique ID.\r\n         */\r\n        public id: string;\r\n\r\n        /**\r\n         * The device OEM for the current device.\r\n         */\r\n        public oemName: string;\r\n\r\n        /**\r\n         * The device model for the current device.\r\n         */\r\n        public model: string;\r\n\r\n        /**\r\n         * The IANA interface type for the internet connected network adapter.\r\n         */\r\n        public network: number;\r\n\r\n        /**\r\n         * The application screen resolution.\r\n         */\r\n        public resolution: string;\r\n\r\n        /**\r\n         * The current display language of the operating system.\r\n         */\r\n        public locale: string;\r\n        \r\n        /**\r\n         * The IP address.\r\n         */\r\n        public ip: string;\r\n\r\n        /**\r\n         * The device language.\r\n         */\r\n        public language: string;\r\n\r\n        /**\r\n         * The OS name.\r\n         */\r\n        public os: string;\r\n\r\n        /**\r\n         * The OS version.\r\n         */\r\n        public osversion: string;\r\n\r\n        /**\r\n         * Constructs a new instance of the Device class\r\n         */\r\n        constructor() {\r\n            // don't attempt to fingerprint browsers\r\n            this.id = \"browser\";\r\n\r\n            // Device type is a dimension in our data platform\r\n            // Setting it to 'Browser' allows to separate client and server dependencies/exceptions\r\n            this.type = \"Browser\";\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../JavaScriptSDK.Interfaces/Context/IInternal.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export class Internal implements IInternal {\r\n\r\n        /**\r\n         * The SDK version used to create this telemetry item.\r\n         */\r\n        public sdkVersion: string;\r\n\r\n        /**\r\n         * The SDK agent version.\r\n         */\r\n        public agentVersion: string;\r\n\r\n         /**\r\n         * Constructs a new instance of the internal telemetry data class.\r\n         */\r\n        constructor(config: ITelemetryConfig) {\r\n            this.sdkVersion = (config.sdkExtension() ? config.sdkExtension() + \"_\" : \"\") + \"javascript:\" + Version;\r\n        }\r\n    }\r\n}","/// <reference path=\"../../JavaScriptSDK.Interfaces/Context/ILocation.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export class Location implements ILocation {\r\n\r\n        /**\r\n         * Client IP address for reverse lookup\r\n         */\r\n        public ip: string;\r\n    }\r\n}","/// <reference path=\"../Util.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Context/IOperation.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export class Operation implements IOperation {\r\n\r\n        public id: string;\r\n        public name: string;\r\n        public parentId: string;\r\n        public rootId: string;\r\n        public syntheticSource: string;\r\n\r\n        constructor() {\r\n            this.id = Util.newId();\r\n            if (window && window.location && window.location.pathname) {\r\n                this.name = window.location.pathname;\r\n            }\r\n        }\r\n    }\r\n} ","module Microsoft.ApplicationInsights {\r\n    export class HashCodeScoreGenerator {\r\n        // We're using 32 bit math, hence max value is (2^31 - 1)\r\n        public static INT_MAX_VALUE: number = 2147483647;\r\n\r\n        // (Magic number) DJB algorithm can't work on shorter strings (results in poor distribution\r\n        private static MIN_INPUT_LENGTH: number = 8;\r\n\r\n        public getHashCodeScore(key: string): number {\r\n            var score = this.getHashCode(key) / HashCodeScoreGenerator.INT_MAX_VALUE;\r\n            return score * 100;\r\n        }\r\n\r\n        public getHashCode(input: string): number {\r\n            if (input == \"\") { return 0; }\r\n\r\n            while (input.length < HashCodeScoreGenerator.MIN_INPUT_LENGTH) {\r\n                input = input.concat(input);\r\n            }\r\n\r\n            // 5381 is a magic number: http://stackoverflow.com/questions/10696223/reason-for-5381-number-in-djb-hash-function\r\n            var hash: number = 5381;\r\n\r\n            for (var i: number = 0; i < input.length; ++i) {\r\n                hash = ((hash << 5) + hash) + input.charCodeAt(i);\r\n                // 'hash' is of number type which means 53 bit integer (http://www.ecma-international.org/ecma-262/6.0/#sec-ecmascript-language-types-number-type)\r\n                // 'hash & hash' will keep it 32 bit integer - just to make it clearer what the result is.\r\n                hash = hash & hash;\r\n            }\r\n\r\n            return Math.abs(hash);\r\n        }\r\n    }\r\n} ","/// <reference path=\"./HashCodeScoreGenerator.ts\" />\r\n/// <reference path=\"../JavaScriptSDK.Interfaces/Contracts/Generated/Envelope.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    export class SamplingScoreGenerator {\r\n        private hashCodeGeneragor: HashCodeScoreGenerator;\r\n\r\n        constructor() {\r\n            this.hashCodeGeneragor = new HashCodeScoreGenerator();\r\n        }\r\n\r\n        public getSamplingScore(envelope: Microsoft.ApplicationInsights.IEnvelope): number {\r\n            var tagKeys: AI.ContextTagKeys = new AI.ContextTagKeys();\r\n            var score: number = 0;\r\n            if (envelope.tags[tagKeys.userId]) {\r\n                score = this.hashCodeGeneragor.getHashCodeScore(envelope.tags[tagKeys.userId]);\r\n            } else if (envelope.tags[tagKeys.operationId]) {\r\n                score = this.hashCodeGeneragor.getHashCodeScore(envelope.tags[tagKeys.operationId]);\r\n            } else {\r\n                score = Math.random()\r\n            }\r\n\r\n            return score;\r\n        }\r\n    }\r\n} ","/// <reference path=\"../SamplingScoreGenerator.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/Envelope.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Context/ISample.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export class Sample implements ISample {\r\n        public sampleRate: number;\r\n        private samplingScoreGenerator: SamplingScoreGenerator;\r\n\r\n        // We're using 32 bit math, hence max value is (2^31 - 1)\r\n        public INT_MAX_VALUE: number = 2147483647;\r\n\r\n        constructor(sampleRate: number) {\r\n            if (sampleRate > 100 || sampleRate < 0) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.WARNING,\r\n                    _InternalMessageId.SampleRateOutOfRange,\r\n                    \"Sampling rate is out of range (0..100). Sampling will be disabled, you may be sending too much data which may affect your AI service level.\",\r\n                    { samplingRate: sampleRate }, true);\r\n                this.sampleRate = 100;\r\n            }\r\n\r\n            this.sampleRate = sampleRate;\r\n            this.samplingScoreGenerator = new SamplingScoreGenerator();\r\n        }\r\n\r\n        /**\r\n        * Determines if an envelope is sampled in (i.e. will be sent) or not (i.e. will be dropped).\r\n        */\r\n        public isSampledIn(envelope: Microsoft.ApplicationInsights.IEnvelope): boolean {\r\n            if (this.sampleRate == 100) return true;\r\n\r\n            var score = this.samplingScoreGenerator.getSamplingScore(envelope);\r\n\r\n            return score < this.sampleRate;\r\n        }\r\n    }\r\n}","// THIS TYPE WAS AUTOGENERATED\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export enum SessionState\r\n    {\r\n        Start = 0,\r\n        End = 1,\r\n    }\r\n}\r\n","/// <reference path=\"../Util.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/SessionState.ts\"/>\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Context/ISession.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export interface ISessionConfig {\r\n        sessionRenewalMs: () => number;\r\n        sessionExpirationMs: () => number;\r\n        cookieDomain: () => string;\r\n    }\r\n\r\n    export class Session implements ISession {\r\n        /**\r\n         * The session ID.\r\n         */\r\n        public id: string;\r\n\r\n        /**  \r\n         * The true if this is the first session  \r\n         */\r\n        public isFirst: boolean;\r\n\r\n        /**\r\n         * The date at which this guid was genereated.\r\n         * Per the spec the ID will be regenerated if more than acquisitionSpan milliseconds ellapse from this time.\r\n         */\r\n        public acquisitionDate: number;\r\n\r\n        /**\r\n         * The date at which this session ID was last reported.\r\n         * This value should be updated whenever telemetry is sent using this ID.\r\n         * Per the spec the ID will be regenerated if more than renewalSpan milliseconds elapse from this time with no activity.\r\n         */\r\n        public renewalDate: number;\r\n    }\r\n\r\n    export class _SessionManager {\r\n\r\n        public static acquisitionSpan = 86400000; // 24 hours in ms\r\n        public static renewalSpan = 1800000; // 30 minutes in ms\r\n        public static cookieUpdateInterval = 60000 // 1 minute in ms\r\n        public automaticSession: Session;\r\n        public config: ISessionConfig;\r\n\r\n        private cookieUpdatedTimestamp: number;\r\n\r\n        constructor(config: ISessionConfig) {\r\n\r\n            if (!config) {\r\n                config = <any>{};\r\n            }\r\n\r\n            if (!(typeof config.sessionExpirationMs === \"function\")) {\r\n                config.sessionExpirationMs = () => _SessionManager.acquisitionSpan;\r\n            }\r\n\r\n            if (!(typeof config.sessionRenewalMs === \"function\")) {\r\n                config.sessionRenewalMs = () => _SessionManager.renewalSpan;\r\n            }\r\n\r\n            this.config = config;\r\n\r\n            this.automaticSession = new Session();\r\n        }\r\n\r\n        public update() {\r\n            if (!this.automaticSession.id) {\r\n                this.initializeAutomaticSession();\r\n            }\r\n\r\n            var now = dateTime.Now();\r\n\r\n            var acquisitionExpired = now - this.automaticSession.acquisitionDate > this.config.sessionExpirationMs();\r\n            var renewalExpired = now - this.automaticSession.renewalDate > this.config.sessionRenewalMs();\r\n\r\n            // renew if acquisitionSpan or renewalSpan has ellapsed\r\n            if (acquisitionExpired || renewalExpired) {\r\n                // update automaticSession so session state has correct id                \r\n                this.automaticSession.isFirst = undefined;\r\n                this.renew();\r\n            } else {\r\n                // do not update the cookie more often than cookieUpdateInterval\r\n                if (!this.cookieUpdatedTimestamp || now - this.cookieUpdatedTimestamp > _SessionManager.cookieUpdateInterval) {\r\n                    this.automaticSession.renewalDate = now;\r\n                    this.setCookie(this.automaticSession.id, this.automaticSession.acquisitionDate, this.automaticSession.renewalDate);\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         *  Record the current state of the automatic session and store it in our cookie string format\r\n         *  into the browser's local storage. This is used to restore the session data when the cookie\r\n         *  expires.\r\n         */\r\n        public backup() {\r\n            this.setStorage(this.automaticSession.id, this.automaticSession.acquisitionDate, this.automaticSession.renewalDate);\r\n        }\r\n\r\n        /**\r\n         *  Use ai_session cookie data or local storage data (when the cookie is unavailable) to\r\n         *  initialize the automatic session.\r\n         */\r\n        private initializeAutomaticSession() {\r\n            var cookie = Util.getCookie('ai_session');\r\n            if (cookie && typeof cookie.split === \"function\") {\r\n                this.initializeAutomaticSessionWithData(cookie);\r\n            } else {\r\n                // There's no cookie, but we might have session data in local storage\r\n                // This can happen if the session expired or the user actively deleted the cookie\r\n                // We only want to recover data if the cookie is missing from expiry. We should respect the user's wishes if the cookie was deleted actively.\r\n                // The User class handles this for us and deletes our local storage object if the persistent user cookie was removed.\r\n                var storage = Util.getStorage('ai_session');\r\n                if (storage) {\r\n                    this.initializeAutomaticSessionWithData(storage);\r\n                }\r\n            }\r\n\r\n            if (!this.automaticSession.id) {\r\n                this.automaticSession.isFirst = true;\r\n                this.renew();\r\n            }\r\n        }\r\n\r\n        /**\r\n         *  Extract id, aquisitionDate, and renewalDate from an ai_session payload string and\r\n         *  use this data to initialize automaticSession.\r\n         *\r\n         *  @param {string} sessionData - The string stored in an ai_session cookie or local storage backup\r\n         */\r\n        private initializeAutomaticSessionWithData(sessionData: string) {\r\n            var params = sessionData.split(\"|\");\r\n\r\n            if (params.length > 0) {\r\n                this.automaticSession.id = params[0];\r\n            }\r\n\r\n            try {\r\n                if (params.length > 1) {\r\n                    var acq = +params[1];\r\n                    this.automaticSession.acquisitionDate = +new Date(acq);\r\n                    this.automaticSession.acquisitionDate = this.automaticSession.acquisitionDate > 0 ? this.automaticSession.acquisitionDate : 0;\r\n                }\r\n\r\n                if (params.length > 2) {\r\n                    var renewal = +params[2];\r\n                    this.automaticSession.renewalDate = +new Date(renewal);\r\n                    this.automaticSession.renewalDate = this.automaticSession.renewalDate > 0 ? this.automaticSession.renewalDate : 0;\r\n                }\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n\r\n                    _InternalMessageId.ErrorParsingAISessionCookie,\r\n                    \"Error parsing ai_session cookie, session will be reset: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n\r\n            if (this.automaticSession.renewalDate == 0) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.WARNING,\r\n                    _InternalMessageId.SessionRenewalDateIsZero,\r\n                    \"AI session renewal date is 0, session will be reset.\");\r\n            }\r\n        }\r\n\r\n        private renew() {\r\n            var now = dateTime.Now();\r\n\r\n            this.automaticSession.id = Util.newId();\r\n            this.automaticSession.acquisitionDate = now;\r\n            this.automaticSession.renewalDate = now;\r\n\r\n            this.setCookie(this.automaticSession.id, this.automaticSession.acquisitionDate, this.automaticSession.renewalDate);\r\n\r\n            // If this browser does not support local storage, fire an internal log to keep track of it at this point\r\n            if (!Util.canUseLocalStorage()) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.WARNING,\r\n                    _InternalMessageId.BrowserDoesNotSupportLocalStorage,\r\n                    \"Browser does not support local storage. Session durations will be inaccurate.\");\r\n            }\r\n        }\r\n\r\n        private setCookie(guid: string, acq: number, renewal: number) {\r\n            // Set cookie to expire after the session expiry time passes or the session renewal deadline, whichever is sooner\r\n            // Expiring the cookie will cause the session to expire even if the user isn't on the page\r\n            var acquisitionExpiry = acq + this.config.sessionExpirationMs();\r\n            var renewalExpiry = renewal + this.config.sessionRenewalMs();\r\n            var cookieExpiry = new Date();\r\n            var cookie = [guid, acq, renewal];\r\n\r\n            if (acquisitionExpiry < renewalExpiry) {\r\n                cookieExpiry.setTime(acquisitionExpiry);\r\n            } else {\r\n                cookieExpiry.setTime(renewalExpiry);\r\n            }\r\n\r\n            var cookieDomnain = this.config.cookieDomain ? this.config.cookieDomain() : null;\r\n\r\n            Util.setCookie('ai_session', cookie.join('|') + ';expires=' + cookieExpiry.toUTCString(), cookieDomnain);\r\n\r\n            this.cookieUpdatedTimestamp = dateTime.Now();\r\n        }\r\n\r\n        private setStorage(guid: string, acq: number, renewal: number) {\r\n            // Keep data in local storage to retain the last session id, allowing us to cleanly end the session when it expires\r\n            // Browsers that don't support local storage won't be able to end sessions cleanly from the client\r\n            // The server will notice this and end the sessions itself, with loss of accurate session duration\r\n            Util.setStorage('ai_session', [guid, acq, renewal].join('|'));\r\n        }\r\n    }\r\n} ","/// <reference path=\"../Util.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Context/IUser.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Context {\r\n\r\n    \"use strict\";\r\n\r\n    export class User implements IUser {\r\n\r\n        static cookieSeparator: string = '|';\r\n        static userCookieName: string = 'ai_user';\r\n        static authUserCookieName: string = 'ai_authUser';\r\n\r\n        /**\r\n         * The telemetry configuration.\r\n         */\r\n        public config: ITelemetryConfig;\r\n\r\n        /**\r\n         * The user ID.\r\n         */\r\n        public id: string;\r\n\r\n        /**\r\n         * Authenticated user id\r\n         */\r\n        public authenticatedId: string;\r\n\r\n        /**\r\n         * The account ID.\r\n         */\r\n        public accountId: string;\r\n\r\n        /**\r\n         * The account acquisition date.\r\n         */\r\n        public accountAcquisitionDate: string;\r\n\r\n        /**\r\n         * The user agent string.\r\n         */\r\n        public agent: string;\r\n\r\n        /**\r\n         * The store region.\r\n         */\r\n        public storeRegion: string;\r\n\r\n        /**\r\n        * Sets the autheticated user id and the account id in this session.\r\n        *   \r\n        * @param authenticatedUserId {string} - The authenticated user id. A unique and persistent string that represents each authenticated user in the service.\r\n        * @param accountId {string} - An optional string to represent the account associated with the authenticated user.\r\n        */\r\n        public setAuthenticatedUserContext(authenticatedUserId: string, accountId?: string) {\r\n\r\n            // Validate inputs to ensure no cookie control characters.\r\n            var isInvalidInput = !this.validateUserInput(authenticatedUserId) || (accountId && !this.validateUserInput(accountId));\r\n            if (isInvalidInput) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING,\r\n                    _InternalMessageId.SetAuthContextFailedAccountName,\r\n                    \"Setting auth user context failed. \" +\r\n                    \"User auth/account id should be of type string, and not contain commas, semi-colons, equal signs, spaces, or vertical-bars.\",\r\n                    true);\r\n                return;\r\n            }\r\n\r\n            // Create cookie string.\r\n            this.authenticatedId = authenticatedUserId;\r\n            var authCookie = this.authenticatedId;\r\n            if (accountId) {\r\n                this.accountId = accountId;\r\n                authCookie = [this.authenticatedId, this.accountId].join(User.cookieSeparator);\r\n            }\r\n\r\n            // Set the cookie. No expiration date because this is a session cookie (expires when browser closed).\r\n            // Encoding the cookie to handle unexpected unicode characters.\r\n            Util.setCookie(User.authUserCookieName, encodeURI(authCookie), this.config.cookieDomain());\r\n        }\r\n\r\n        /**\r\n         * Clears the authenticated user id and the account id from the user context.\r\n         * @returns {} \r\n         */\r\n        public clearAuthenticatedUserContext() {\r\n            this.authenticatedId = null;\r\n            this.accountId = null;\r\n            Util.deleteCookie(User.authUserCookieName);\r\n        }\r\n\r\n        constructor(config: ITelemetryConfig) {\r\n\r\n            //get userId or create new one if none exists\r\n            var cookie = Util.getCookie(User.userCookieName);\r\n            if (cookie) {\r\n                var params = cookie.split(User.cookieSeparator);\r\n                if (params.length > 0) {\r\n                    this.id = params[0];\r\n                }\r\n            }\r\n\r\n            this.config = config;\r\n\r\n            if (!this.id) {\r\n                this.id = Util.newId();\r\n                var date = new Date();\r\n                var acqStr = Util.toISOStringForIE8(date);\r\n                this.accountAcquisitionDate = acqStr;\r\n                // without expiration, cookies expire at the end of the session\r\n                // set it to 365 days from now\r\n                // 365 * 24 * 60 * 60 * 1000 = 31536000000 \r\n                date.setTime(date.getTime() + 31536000000);\r\n                var newCookie = [this.id, acqStr];\r\n                var cookieDomain = this.config.cookieDomain ? this.config.cookieDomain() : undefined;\r\n\r\n                Util.setCookie(User.userCookieName, newCookie.join(User.cookieSeparator) + ';expires=' + date.toUTCString(), cookieDomain);\r\n\r\n                // If we have an ai_session in local storage this means the user actively removed our cookies.\r\n                // We should respect their wishes and clear ourselves from local storage\r\n                Util.removeStorage('ai_session');\r\n            }\r\n\r\n            // We still take the account id from the ctor param for backward compatibility. \r\n            // But if the the customer set the accountId through the newer setAuthenticatedUserContext API, we will override it.\r\n            this.accountId = config.accountId ? config.accountId() : undefined;\r\n\r\n            // Get the auth user id and account id from the cookie if exists\r\n            // Cookie is in the pattern: <authenticatedId>|<accountId>\r\n            var authCookie = Util.getCookie(User.authUserCookieName);\r\n            if (authCookie) {\r\n                authCookie = decodeURI(authCookie);\r\n                var authCookieString = authCookie.split(User.cookieSeparator);\r\n                if (authCookieString[0]) {\r\n                    this.authenticatedId = authCookieString[0];\r\n                }\r\n                if (authCookieString.length > 1 && authCookieString[1]) {\r\n                    this.accountId = authCookieString[1];\r\n                }\r\n            }\r\n        }\r\n\r\n        private validateUserInput(id: string): boolean {\r\n            // Validate:\r\n            // 1. Id is a non-empty string.\r\n            // 2. It does not contain special characters for cookies.\r\n            if (typeof id !== 'string' ||\r\n                !id ||\r\n                id.match(/,|;|=| |\\|/)) {\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        }\r\n    }\r\n\r\n}","/// <reference path=\"../Logging.ts\" />\r\n/// <reference path=\"../Util.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    export class extensions {\r\n        public static IsNullOrUndefined(obj) {\r\n            return typeof (obj) === \"undefined\" || obj === null;\r\n        }\r\n    }\r\n\r\n    export class stringUtils {\r\n        public static GetLength(strObject) {\r\n            var res = 0;\r\n            if (!extensions.IsNullOrUndefined(strObject)) {\r\n                var stringified = \"\";\r\n                try {\r\n                    stringified = strObject.toString();\r\n                } catch (ex) {\r\n                    // some troubles with complex object\r\n                }\r\n\r\n                res = stringified.length;\r\n                res = isNaN(res) ? 0 : res;\r\n            }\r\n\r\n            return res;\r\n        }\r\n    }\r\n\r\n    export class dateTime {\r\n        ///<summary>Return the number of milliseconds since 1970/01/01 in local timezon</summary>\r\n        public static Now = (window.performance && window.performance.now && window.performance.timing) ?\r\n            function () {\r\n                return window.performance.now() + window.performance.timing.navigationStart;\r\n            }\r\n            :\r\n            function () {\r\n                return new Date().getTime();\r\n            }\r\n\r\n        ///<summary>Gets duration between two timestamps</summary>\r\n        public static GetDuration = function (start: number, end: number): number {\r\n            var result = null;\r\n            if (start !== 0 && end !== 0 && !extensions.IsNullOrUndefined(start) && !extensions.IsNullOrUndefined(end)) {\r\n                result = end - start;\r\n            }\r\n\r\n            return result;\r\n        }\r\n    }\r\n\r\n    export class EventHelper {\r\n        ///<summary>Binds the specified function to an event, so that the function gets called whenever the event fires on the object</summary>\r\n        ///<param name=\"obj\">Object to which </param>\r\n        ///<param name=\"eventNameWithoutOn\">String that specifies any of the standard DHTML Events without \"on\" prefix</param>\r\n        ///<param name=\"handlerRef\">Pointer that specifies the function to call when event fires</param>\r\n        ///<returns>True if the function was bound successfully to the event, otherwise false</returns>\r\n        public static AttachEvent(obj, eventNameWithoutOn, handlerRef) {\r\n            var result = false;\r\n            if (!extensions.IsNullOrUndefined(obj)) {\r\n                if (!extensions.IsNullOrUndefined(obj.attachEvent)) {\r\n                    // IE before version 9                    \r\n                    obj.attachEvent(\"on\" + eventNameWithoutOn, handlerRef);\r\n                    result = true;\r\n                }\r\n                else {\r\n                    if (!extensions.IsNullOrUndefined(obj.addEventListener)) {\r\n                        // all browsers except IE before version 9\r\n                        obj.addEventListener(eventNameWithoutOn, handlerRef, false);\r\n                        result = true;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        public static DetachEvent(obj, eventNameWithoutOn, handlerRef) {\r\n            if (!extensions.IsNullOrUndefined(obj)) {\r\n                if (!extensions.IsNullOrUndefined(obj.detachEvent)) {\r\n                    obj.detachEvent(\"on\" + eventNameWithoutOn, handlerRef);\r\n                }\r\n                else {\r\n                    if (!extensions.IsNullOrUndefined(obj.removeEventListener)) {\r\n                        obj.removeEventListener(eventNameWithoutOn, handlerRef, false);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","/// <reference path=\"../Logging.ts\" />\r\n/// <reference path=\"../Util.ts\" />\r\n/// <reference path=\"./ajaxUtils.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    export class XHRMonitoringState {\r\n        public openDone: boolean = false;\r\n        public setRequestHeaderDone: boolean = false;\r\n        public sendDone: boolean = false;\r\n        public abortDone: boolean = false;\r\n\r\n        //<summary>True, if onreadyStateChangeCallback function attached to xhr, otherwise false</summary>\r\n        public onreadystatechangeCallbackAttached = false;\r\n    }\r\n\r\n    export class ajaxRecord {\r\n        public completed = false;\r\n        public requestHeadersSize = null;\r\n        public ttfb = null;\r\n        public responseReceivingDuration = null;\r\n        public callbackDuration = null;\r\n        public ajaxTotalDuration = null;\r\n        public aborted = null;\r\n        public pageUrl = null;\r\n        public requestUrl = null;\r\n        public requestSize = 0;\r\n        public method = null;\r\n\r\n        ///<summary>Returns the HTTP status code.</summary>\r\n        public status = null;        \r\n        \r\n        //<summary>The timestamp when open method was invoked</summary>\r\n        public requestSentTime = null;\r\n\r\n        //<summary>The timestamps when first byte was received</summary>\r\n        public responseStartedTime = null;\r\n\r\n        //<summary>The timestamp when last byte was received</summary>\r\n        public responseFinishedTime = null;\r\n\r\n        //<summary>The timestamp when onreadystatechange callback in readyState 4 finished</summary>\r\n        public callbackFinishedTime = null;\r\n        \r\n        //<summary>The timestamp at which ajax was ended</summary>\r\n        public endTime = null;\r\n\r\n        //<summary>The original xhr onreadystatechange event</summary>\r\n        public originalOnreadystatechage = null;\r\n\r\n        public xhrMonitoringState: XHRMonitoringState = new XHRMonitoringState();\r\n\r\n        //<summary>Determines whether or not JavaScript exception occured in xhr.onreadystatechange code. 1 if occured, otherwise 0.</summary>\r\n        public clientFailure = 0;\r\n\r\n\r\n        public id: string;\r\n\r\n        constructor(id: string) {\r\n            this.id = id;\r\n        }\r\n\r\n\r\n        public getAbsoluteUrl() {\r\n            return this.requestUrl ? UrlHelper.getAbsoluteUrl(this.requestUrl) : null;\r\n        }\r\n\r\n        public getPathName() {\r\n            return this.requestUrl ? Telemetry.Common.DataSanitizer.sanitizeUrl(UrlHelper.getCompleteUrl(this.method, this.requestUrl)): null;\r\n        }\r\n\r\n        public CalculateMetrics = function () {\r\n            var self = this;\r\n            // round to 3 decimal points\r\n            self.ajaxTotalDuration = Math.round(dateTime.GetDuration(self.requestSentTime, self.responseFinishedTime)*1000)/1000;\r\n        }\r\n    };\r\n};           \r\n\r\n","/// <reference path=\"../Logging.ts\" />\r\n/// <reference path=\"../Util.ts\" />\r\n/// <reference path=\"./ajaxUtils.ts\" />\r\n/// <reference path=\"./ajaxRecord.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    export interface XMLHttpRequestInstrumented extends XMLHttpRequest {\r\n        ajaxData: ajaxRecord;\r\n    }\r\n\r\n    export class AjaxMonitor {\r\n        private appInsights: AppInsights;\r\n        private initialized: boolean;\r\n        private static instrumentedByAppInsightsName = \"InstrumentedByAppInsights\";\r\n        private currentWindowHost;\r\n\r\n        constructor(appInsights: Microsoft.ApplicationInsights.AppInsights) {\r\n            this.currentWindowHost = window.location.host;\r\n            this.appInsights = appInsights;\r\n            this.initialized = false;\r\n            this.Init();\r\n        }\r\n\r\n        ///<summary>The main function that needs to be called in order to start Ajax Monitoring</summary>\r\n        private Init() {\r\n            if (this.supportsMonitoring()) {\r\n                this.instrumentOpen();\r\n                this.instrumentSend();\r\n                this.instrumentAbort();\r\n                this.initialized = true;\r\n            }\r\n        }\r\n\r\n\r\n        ///<summary>Function that returns property name which will identify that monitoring for given instance of XmlHttpRequest is disabled</summary>\r\n        public static DisabledPropertyName: string = \"Microsoft_ApplicationInsights_BypassAjaxInstrumentation\";\r\n\r\n        ///<summary>Verifies that particalar instance of XMLHttpRequest needs to be monitored</summary>\r\n        ///<param name=\"excludeAjaxDataValidation\">Optional parameter. True if ajaxData must be excluded from verification</param>\r\n        ///<returns type=\"bool\">True if instance needs to be monitored, otherwise false</returns>\r\n        private isMonitoredInstance(xhr: XMLHttpRequestInstrumented, excludeAjaxDataValidation?: boolean): boolean {\r\n\r\n            // checking to see that all interested functions on xhr were instrumented\r\n            return this.initialized\r\n\r\n                // checking on ajaxData to see that it was not removed in user code\r\n                && (excludeAjaxDataValidation === true || !extensions.IsNullOrUndefined(xhr.ajaxData))\r\n\r\n                // check that this instance is not not used by ajax call performed inside client side monitoring to send data to collector\r\n                && xhr[AjaxMonitor.DisabledPropertyName] !== true;\r\n\r\n        }\r\n\r\n        ///<summary>Determines whether ajax monitoring can be enabled on this document</summary>\r\n        ///<returns>True if Ajax monitoring is supported on this page, otherwise false</returns>\r\n        private supportsMonitoring(): boolean {\r\n            var result = false;\r\n            if (!extensions.IsNullOrUndefined(XMLHttpRequest)) {\r\n                result = true;\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        private instrumentOpen() {\r\n            var originalOpen = XMLHttpRequest.prototype.open;\r\n            var ajaxMonitorInstance = this;\r\n            XMLHttpRequest.prototype.open = function (method, url, async) {\r\n                try {\r\n                    if (ajaxMonitorInstance.isMonitoredInstance(this, true) &&\r\n                        (\r\n                            !(<XMLHttpRequestInstrumented>this).ajaxData ||\r\n                            !(<XMLHttpRequestInstrumented>this).ajaxData.xhrMonitoringState.openDone\r\n                        )) {\r\n                        ajaxMonitorInstance.openHandler(this, method, url, async);\r\n                    }\r\n                } catch (e) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.CRITICAL,\r\n                        _InternalMessageId.FailedMonitorAjaxOpen,\r\n                        \"Failed to monitor XMLHttpRequest.open, monitoring data for this ajax call may be incorrect.\",\r\n                        {\r\n                            ajaxDiagnosticsMessage: AjaxMonitor.getFailedAjaxDiagnosticsMessage(this),\r\n                            exception: Microsoft.ApplicationInsights.Util.dump(e)\r\n                        });\r\n                }\r\n\r\n                return originalOpen.apply(this, arguments);\r\n            };\r\n        }\r\n\r\n        private openHandler(xhr: XMLHttpRequestInstrumented, method, url, async) {\r\n            var ajaxData = new ajaxRecord(Util.newId());\r\n            ajaxData.method = method;\r\n            ajaxData.requestUrl = url;\r\n            ajaxData.xhrMonitoringState.openDone = true\r\n            xhr.ajaxData = ajaxData;\r\n\r\n            this.attachToOnReadyStateChange(xhr);\r\n        }\r\n\r\n        private static getFailedAjaxDiagnosticsMessage(xhr: XMLHttpRequestInstrumented): string {\r\n            var result = \"\";\r\n            try {\r\n                if (!extensions.IsNullOrUndefined(xhr) &&\r\n                    !extensions.IsNullOrUndefined(xhr.ajaxData) &&\r\n                    !extensions.IsNullOrUndefined(xhr.ajaxData.requestUrl)) {\r\n                    result += \"(url: '\" + xhr.ajaxData.requestUrl + \"')\";\r\n                }\r\n            } catch (e) { }\r\n\r\n            return result;\r\n        }\r\n\r\n        private instrumentSend() {\r\n            var originalSend = XMLHttpRequest.prototype.send;\r\n            var ajaxMonitorInstance = this;\r\n            XMLHttpRequest.prototype.send = function (content) {\r\n                try {\r\n                    if (ajaxMonitorInstance.isMonitoredInstance(this) && !(<XMLHttpRequestInstrumented>this).ajaxData.xhrMonitoringState.sendDone) {\r\n                        ajaxMonitorInstance.sendHandler(this, content);\r\n                    }\r\n                } catch (e) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.CRITICAL,\r\n                        _InternalMessageId.FailedMonitorAjaxSend,\r\n                        \"Failed to monitor XMLHttpRequest, monitoring data for this ajax call may be incorrect.\",\r\n                        {\r\n                            ajaxDiagnosticsMessage: AjaxMonitor.getFailedAjaxDiagnosticsMessage(this),\r\n                            exception: Microsoft.ApplicationInsights.Util.dump(e)\r\n                        });\r\n                }\r\n\r\n                return originalSend.apply(this, arguments);\r\n            };\r\n        }\r\n\r\n        private sendHandler(xhr: XMLHttpRequestInstrumented, content) {\r\n            xhr.ajaxData.requestSentTime = dateTime.Now();\r\n\r\n            // Add correlation headers only for requests within the same host and port number\r\n            // For cross- origin requests we need to ensure that x- ms -* headers are present in `Access-Control-Allow-Headers` header (OPTIONS response)\r\n            if (!this.appInsights.config.disableCorrelationHeaders && (UrlHelper.parseUrl(xhr.ajaxData.getAbsoluteUrl()).host == this.currentWindowHost)) {\r\n                var rootId = this.appInsights.context.operation.id;\r\n                xhr.setRequestHeader(\"x-ms-request-root-id\", rootId);\r\n                xhr.setRequestHeader(\"x-ms-request-id\", xhr.ajaxData.id);\r\n            }\r\n            xhr.ajaxData.xhrMonitoringState.sendDone = true;\r\n        }\r\n\r\n        private instrumentAbort() {\r\n            var originalAbort = XMLHttpRequest.prototype.abort;\r\n            var ajaxMonitorInstance = this;\r\n            XMLHttpRequest.prototype.abort = function () {\r\n                try {\r\n                    if (ajaxMonitorInstance.isMonitoredInstance(this) && !(<XMLHttpRequestInstrumented>this).ajaxData.xhrMonitoringState.abortDone) {\r\n                        (<XMLHttpRequestInstrumented>this).ajaxData.aborted = 1;\r\n                        (<XMLHttpRequestInstrumented>this).ajaxData.xhrMonitoringState.abortDone = true;\r\n                    }\r\n                } catch (e) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.CRITICAL,\r\n                        _InternalMessageId.FailedMonitorAjaxAbort,\r\n                        \"Failed to monitor XMLHttpRequest.abort, monitoring data for this ajax call may be incorrect.\",\r\n                        {\r\n                            ajaxDiagnosticsMessage: AjaxMonitor.getFailedAjaxDiagnosticsMessage(this),\r\n                            exception: Microsoft.ApplicationInsights.Util.dump(e)\r\n                        });\r\n                }\r\n\r\n                return originalAbort.apply(this, arguments);\r\n            };\r\n        }\r\n\r\n        private attachToOnReadyStateChange(xhr: XMLHttpRequestInstrumented) {\r\n            var ajaxMonitorInstance = this;\r\n            xhr.ajaxData.xhrMonitoringState.onreadystatechangeCallbackAttached = EventHelper.AttachEvent(xhr, \"readystatechange\", () => {\r\n                try {\r\n                    if (ajaxMonitorInstance.isMonitoredInstance(xhr)) {\r\n                        if (xhr.readyState === 4) {\r\n                            ajaxMonitorInstance.onAjaxComplete(xhr);\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    var exceptionText = Microsoft.ApplicationInsights.Util.dump(e);\r\n\r\n                    // ignore messages with c00c023f, as this a known IE9 XHR abort issue\r\n                    if (!exceptionText || exceptionText.toLowerCase().indexOf(\"c00c023f\") == -1) {\r\n                        _InternalLogging.throwInternal(\r\n                            LoggingSeverity.CRITICAL,\r\n                            _InternalMessageId.FailedMonitorAjaxRSC,\r\n                            \"Failed to monitor XMLHttpRequest 'readystatechange' event handler, monitoring data for this ajax call may be incorrect.\",\r\n                            {\r\n                                ajaxDiagnosticsMessage: AjaxMonitor.getFailedAjaxDiagnosticsMessage(xhr),\r\n                                exception: Microsoft.ApplicationInsights.Util.dump(e)\r\n                            });\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        private onAjaxComplete(xhr: XMLHttpRequestInstrumented) {\r\n            xhr.ajaxData.responseFinishedTime = dateTime.Now();\r\n            xhr.ajaxData.status = xhr.status;\r\n            xhr.ajaxData.CalculateMetrics();\r\n\r\n            if (xhr.ajaxData.ajaxTotalDuration < 0) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING,\r\n                    _InternalMessageId.FailedMonitorAjaxDur,\r\n                    \"Failed to calculate the duration of the ajax call, monitoring data for this ajax call won't be sent.\",\r\n                    {\r\n                        ajaxDiagnosticsMessage: AjaxMonitor.getFailedAjaxDiagnosticsMessage(xhr),\r\n                        requestSentTime: xhr.ajaxData.requestSentTime,\r\n                        responseFinishedTime: xhr.ajaxData.responseFinishedTime\r\n                    });\r\n            }\r\n            else {\r\n                this.appInsights.trackDependency(\r\n                    xhr.ajaxData.id,\r\n                    xhr.ajaxData.method,\r\n                    xhr.ajaxData.getAbsoluteUrl(),\r\n                    xhr.ajaxData.getPathName(),\r\n                    xhr.ajaxData.ajaxTotalDuration,\r\n                    (+(xhr.ajaxData.status)) >= 200 && (+(xhr.ajaxData.status)) < 400,\r\n                    +xhr.ajaxData.status\r\n                );\r\n\r\n                xhr.ajaxData = null;\r\n            }\r\n        }\r\n\r\n    }\r\n}\r\n","/// <reference path=\"Serializer.ts\" />\r\n/// <reference path=\"Telemetry/Common/Envelope.ts\"/>\r\n/// <reference path=\"Telemetry/Common/Base.ts\" />\r\n/// <reference path=\"../JavaScriptSDK.Interfaces/Contracts/Generated/ContextTagKeys.ts\"/>\r\n/// <reference path=\"Context/Application.ts\"/>\r\n/// <reference path=\"Context/Device.ts\"/>\r\n/// <reference path=\"Context/Internal.ts\"/>\r\n/// <reference path=\"Context/Location.ts\"/>\r\n/// <reference path=\"Context/Operation.ts\"/>\r\n/// <reference path=\"Context/Sample.ts\"/>\r\n/// <reference path=\"Context/Session.ts\"/>\r\n/// <reference path=\"Context/User.ts\"/>\r\n/// <reference path=\"ajax/ajax.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    export interface ISendBuffer {\r\n        /**\r\n         * Enqueue the payload\r\n         */\r\n        enqueue: (payload: string) => void;\r\n\r\n        /**\r\n         * Returns the number of elements in the buffer\r\n         */\r\n        count: () => number;\r\n\r\n        /**\r\n         * Clears the buffer\r\n         */\r\n        clear: () => void;\r\n\r\n        /**\r\n         * Returns items stored in the buffer\r\n         */\r\n        getItems: () => string[];\r\n\r\n        /**\r\n         * Build a batch of all elements in the payload array\r\n         */\r\n        batchPayloads: (payload: string[]) => string;\r\n\r\n        /**\r\n         * Moves items to the SENT_BUFFER.\r\n         * The buffer holds items which were sent, but we haven't received any response from the backend yet. \r\n         */\r\n        markAsSent: (payload: string[]) => void;\r\n\r\n        /**\r\n         * Removes items from the SENT_BUFFER. Should be called on successful response from the backend. \r\n         */\r\n        clearSent: (payload: string[]) => void;\r\n    }\r\n\r\n    /*\r\n     * An array based send buffer. \r\n     */\r\n    export class ArraySendBuffer implements ISendBuffer {\r\n        private _config: ISenderConfig;\r\n        private _buffer: string[];\r\n\r\n        constructor(config: ISenderConfig) {\r\n            this._config = config;\r\n\r\n            this._buffer = [];\r\n        }\r\n\r\n        public enqueue(payload: string) {\r\n            this._buffer.push(payload);\r\n        }\r\n\r\n        public count(): number {\r\n            return this._buffer.length;\r\n        }\r\n\r\n        public clear() {\r\n            this._buffer.length = 0;\r\n        }\r\n\r\n        public getItems(): string[] {\r\n            return this._buffer.slice(0);\r\n        }\r\n\r\n        public batchPayloads(payload: string[]): string {\r\n            if (payload && payload.length > 0) {\r\n                var batch = this._config.emitLineDelimitedJson() ?\r\n                    payload.join(\"\\n\") :\r\n                    \"[\" + payload.join(\",\") + \"]\";\r\n\r\n                return batch;\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        public markAsSent(payload: string[]) {\r\n            this.clear();\r\n        }\r\n\r\n        public clearSent(payload: string[]) {\r\n            // not supported\r\n        }\r\n    }\r\n\r\n    /*\r\n     * Session storege buffer holds a copy of all unsent items in the browser session storage.\r\n     */\r\n    export class SessionStorageSendBuffer implements ISendBuffer {\r\n        static BUFFER_KEY = \"AI_buffer\";\r\n        static SENT_BUFFER_KEY = \"AI_sentBuffer\";\r\n\r\n        // Maximum number of payloads stored in the buffer. If the buffer is full, new elements will be dropped. \r\n        static MAX_BUFFER_SIZE = 2000;\r\n        private _bufferFullMessageSent = false;\r\n\r\n        // An in-memory copy of the buffer. A copy is saved to the session storage on enqueue() and clear(). \r\n        // The buffer is restored in a constructor and contains unsent events from a previous page.\r\n        private _buffer: string[];\r\n        private _config: ISenderConfig;\r\n\r\n        constructor(config: ISenderConfig) {\r\n            this._config = config;\r\n\r\n            var bufferItems = this.getBuffer(SessionStorageSendBuffer.BUFFER_KEY);\r\n            var notDeliveredItems = this.getBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY);\r\n\r\n            this._buffer = bufferItems.concat(notDeliveredItems);\r\n\r\n            // If the buffer has too many items, drop items from the end.\r\n            if (this._buffer.length > SessionStorageSendBuffer.MAX_BUFFER_SIZE) {\r\n                this._buffer.length = SessionStorageSendBuffer.MAX_BUFFER_SIZE;\r\n            }\r\n\r\n            // update DataLossAnalyzer with the number of recovered items\r\n            // Uncomment if you want to use DataLossanalyzer\r\n            // DataLossAnalyzer.itemsRestoredFromSessionBuffer = this._buffer.length;\r\n\r\n            this.setBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY, []);\r\n            this.setBuffer(SessionStorageSendBuffer.BUFFER_KEY, this._buffer);\r\n        }\r\n\r\n        public enqueue(payload: string) {\r\n            if (this._buffer.length >= SessionStorageSendBuffer.MAX_BUFFER_SIZE) {\r\n                // sent internal log only once per page view\r\n                if (!this._bufferFullMessageSent) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.SessionStorageBufferFull,\r\n                        \"Maximum buffer size reached: \" + this._buffer.length,\r\n                        true);\r\n                    this._bufferFullMessageSent = true;\r\n                }\r\n                return;\r\n            }\r\n\r\n            this._buffer.push(payload);\r\n            this.setBuffer(SessionStorageSendBuffer.BUFFER_KEY, this._buffer);\r\n        }\r\n\r\n        public count(): number {\r\n            return this._buffer.length;\r\n        }\r\n\r\n        public clear() {\r\n            this._buffer.length = 0;\r\n            this.setBuffer(SessionStorageSendBuffer.BUFFER_KEY, []);\r\n            this.setBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY, []);\r\n\r\n            this._bufferFullMessageSent = false;\r\n        }\r\n\r\n        public getItems(): string[] {\r\n            return this._buffer.slice(0)\r\n        }\r\n\r\n        public batchPayloads(payload: string[]): string {\r\n            if (payload && payload.length > 0) {\r\n                var batch = this._config.emitLineDelimitedJson() ?\r\n                    payload.join(\"\\n\") :\r\n                    \"[\" + payload.join(\",\") + \"]\";\r\n\r\n                return batch;\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        public markAsSent(payload: string[]) {\r\n            this._buffer = this.removePayloadsFromBuffer(payload, this._buffer);\r\n            this.setBuffer(SessionStorageSendBuffer.BUFFER_KEY, this._buffer);\r\n\r\n            var sentElements = this.getBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY);\r\n            if (sentElements instanceof Array && payload instanceof Array) {\r\n                sentElements = sentElements.concat(payload);\r\n\r\n                if (sentElements.length > SessionStorageSendBuffer.MAX_BUFFER_SIZE) {\r\n                    // We send telemetry normally. If the SENT_BUFFER is too big we don't add new elements\r\n                    // until we receive a response from the backend and the buffer has free space again (see clearSent method)\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.CRITICAL,\r\n                        _InternalMessageId.SessionStorageBufferFull,\r\n                        \"Sent buffer reached its maximum size: \" + sentElements.length,\r\n                        true);\r\n\r\n                    sentElements.length = SessionStorageSendBuffer.MAX_BUFFER_SIZE;\r\n                }\r\n\r\n                this.setBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY, sentElements);\r\n            }\r\n        }\r\n\r\n        public clearSent(payload: string[]) {\r\n            var sentElements = this.getBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY);\r\n            sentElements = this.removePayloadsFromBuffer(payload, sentElements);\r\n\r\n            this.setBuffer(SessionStorageSendBuffer.SENT_BUFFER_KEY, sentElements);\r\n        }\r\n\r\n        private removePayloadsFromBuffer(payloads: string[], buffer: string[]): string[] {\r\n            var remaining: string[] = [];\r\n\r\n            for (var i in buffer) {\r\n                var contains = false;\r\n                for (var j in payloads) {\r\n                    if (payloads[j] === buffer[i]) {\r\n                        contains = true;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (!contains) {\r\n                    remaining.push(buffer[i]);\r\n                }\r\n            };\r\n\r\n            return remaining;\r\n        }\r\n\r\n        private getBuffer(key: string): string[] {\r\n            try {\r\n                var bufferJson = Util.getSessionStorage(key);\r\n                if (bufferJson) {\r\n                    var buffer: string[] = JSON.parse(bufferJson);\r\n                    if (buffer) {\r\n                        return buffer;\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.FailedToRestoreStorageBuffer,\r\n                        \" storage key: \" + key + \", \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n            }\r\n\r\n            return [];\r\n        }\r\n\r\n        private setBuffer(key: string, buffer: string[]) {\r\n            try {\r\n                var bufferJson = JSON.stringify(buffer);\r\n                Util.setSessionStorage(key, bufferJson);\r\n            } catch (e) {\r\n                // if there was an error, clear the buffer\r\n                // telemetry is stored in the _buffer array so we won't loose any items\r\n                Util.setSessionStorage(key, JSON.stringify([]));\r\n\r\n                _InternalLogging.throwInternal(LoggingSeverity.WARNING,\r\n                    _InternalMessageId.FailedToSetStorageBuffer,\r\n                        \" storage key: \" + key + \", \" + Util.getExceptionName(e) + \". Buffer cleared\",\r\n                        { exception: Util.dump(e) });\r\n            }\r\n        }\r\n    }\r\n}","/// <reference path=\"Serializer.ts\" />\r\n/// <reference path=\"Telemetry/Common/Envelope.ts\"/>\r\n/// <reference path=\"Telemetry/Common/Base.ts\" />\r\n/// <reference path=\"../JavaScriptSDK.Interfaces/Contracts/Generated/ContextTagKeys.ts\"/>\r\n/// <reference path=\"../JavaScriptSDK.Interfaces/Contracts/Generated/Envelope.ts\" />\r\n/// <reference path=\"Context/Application.ts\"/>\r\n/// <reference path=\"Context/Device.ts\"/>\r\n/// <reference path=\"Context/Internal.ts\"/>\r\n/// <reference path=\"Context/Location.ts\"/>\r\n/// <reference path=\"Context/Operation.ts\"/>\r\n/// <reference path=\"Context/Sample.ts\"/>\r\n/// <reference path=\"Context/Session.ts\"/>\r\n/// <reference path=\"Context/User.ts\"/>\r\n/// <reference path=\"ajax/ajax.ts\"/>\r\n/// <reference path=\"SendBuffer.ts\"/>\r\n\r\ninterface XDomainRequest extends XMLHttpRequestEventTarget {\r\n    responseText: string;\r\n    send(payload: string);\r\n    open(method: string, url: string);\r\n};\r\n\r\ndeclare var XDomainRequest: {\r\n    prototype: XDomainRequest;\r\n    new (): XDomainRequest;\r\n};\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    export interface ISenderConfig {\r\n        /**\r\n         * The url to which payloads will be sent\r\n         */\r\n        endpointUrl: () => string;\r\n\r\n        /**\r\n        * The JSON format (normal vs line delimited). True means line delimited JSON.\r\n        */\r\n        emitLineDelimitedJson: () => boolean;\r\n\r\n        /**\r\n         * The maximum size of a batch in bytes\r\n         */\r\n        maxBatchSizeInBytes: () => number;\r\n\r\n        /**\r\n         * The maximum interval allowed between calls to batchInvoke\r\n         */\r\n        maxBatchInterval: () => number;\r\n\r\n        /**\r\n         * The master off switch.  Do not send any data if set to TRUE\r\n         */\r\n        disableTelemetry: () => boolean;\r\n\r\n        /**\r\n         * Store a copy of a send buffer in the session storage\r\n         */\r\n        enableSessionStorageBuffer: () => boolean;\r\n\r\n        /**\r\n         * Is retry handler disabled.\r\n         * If enabled, retry on 206 (partial success), 408 (timeout), 429 (too many requests), 500 (internal server error) and 503 (service unavailable).\r\n         */\r\n        isRetryDisabled: () => boolean;\r\n\r\n        isBeaconApiDisabled: () => boolean;\r\n    }\r\n\r\n    export interface IResponseError {\r\n        index: number;\r\n        statusCode: number;\r\n        message: string;\r\n    }\r\n\r\n    export interface IBackendResponse {\r\n        /**\r\n         * Number of items received by the backend\r\n         */\r\n        itemsReceived: number;\r\n\r\n        /**\r\n         * Number of items succesfuly accepted by the backend\r\n         */\r\n        itemsAccepted: number;\r\n\r\n        /**\r\n         * List of errors for items which were not accepted\r\n         */\r\n        errors: IResponseError[];\r\n    }\r\n\r\n    export class Sender {\r\n        /**\r\n         * How many times in a row a retryable error condition has occurred.\r\n         */\r\n        private _consecutiveErrors: number;\r\n\r\n        /**\r\n         * The time to retry at in milliseconds from 1970/01/01 (this makes the timer calculation easy).\r\n         */\r\n        private _retryAt: number;\r\n\r\n        /**\r\n         * The time of the last send operation.\r\n         */\r\n        private _lastSend: number;\r\n\r\n        /**\r\n         * Handle to the timer for delayed sending of batches of data.\r\n         */\r\n        private _timeoutHandle: any;\r\n\r\n        /**\r\n         * A send buffer object\r\n         */\r\n        public _buffer: ISendBuffer;\r\n\r\n        /**\r\n         * The configuration for this sender instance\r\n         */\r\n        public _config: ISenderConfig;\r\n\r\n        /**\r\n         * A method which will cause data to be send to the url\r\n         */\r\n\r\n        public _sender: (payload: string[], isAsync: boolean) => void;\r\n\r\n        /**\r\n         * Whether XMLHttpRequest object is supported. Older version of IE (8,9) do not support it.\r\n         */\r\n        public _XMLHttpRequestSupported: boolean = false;\r\n\r\n        /**\r\n         * The maximum Beacon API payload size.\r\n         * WC3 documentation allows browsers to set the limit. Chrome current has a limit of 64kb. \r\n         */\r\n        public static MaxBeaconPayloadSize = 65536; // 64kb\r\n\r\n        /**\r\n         * Constructs a new instance of the Sender class\r\n         */\r\n        constructor(config: ISenderConfig) {\r\n            this._consecutiveErrors = 0;\r\n            this._retryAt = null;\r\n            this._lastSend = 0;\r\n            this._config = config;\r\n            this._sender = null;\r\n            this._buffer = (Util.canUseSessionStorage() && this._config.enableSessionStorageBuffer())\r\n                ? new SessionStorageSendBuffer(config) : new ArraySendBuffer(config);\r\n\r\n            if (!this._config.isBeaconApiDisabled() && Util.IsBeaconApiSupported()) {\r\n                this._sender = this._beaconSender;\r\n            } else {\r\n                if (typeof XMLHttpRequest != \"undefined\") {\r\n                    var testXhr = new XMLHttpRequest();\r\n                    if (\"withCredentials\" in testXhr) {\r\n                        this._sender = this._xhrSender;\r\n                        this._XMLHttpRequestSupported = true;\r\n                    } else if (typeof XDomainRequest !== \"undefined\") {\r\n                        this._sender = this._xdrSender; //IE 8 and 9\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Add a telemetry item to the send buffer\r\n         */\r\n        public send(envelope: Microsoft.ApplicationInsights.IEnvelope) {\r\n            try {\r\n                // if master off switch is set, don't send any data\r\n                if (this._config.disableTelemetry()) {\r\n                    // Do not send/save data\r\n                    return;\r\n                }\r\n\r\n                // validate input\r\n                if (!envelope) {\r\n                    _InternalLogging.throwInternal(LoggingSeverity.CRITICAL, _InternalMessageId.CannotSendEmptyTelemetry, \"Cannot send empty telemetry\");\r\n                    return;\r\n                }\r\n\r\n                // ensure a sender was constructed\r\n                if (!this._sender) {\r\n                    _InternalLogging.throwInternal(LoggingSeverity.CRITICAL, _InternalMessageId.SenderNotInitialized, \"Sender was not initialized\");\r\n                    return;\r\n                }\r\n\r\n                // check if the incoming payload is too large, truncate if necessary\r\n                var payload: string = Serializer.serialize(envelope);\r\n\r\n                // flush if we would exceed the max-size limit by adding this item\r\n                var bufferPayload = this._buffer.getItems();\r\n                var batch = this._buffer.batchPayloads(bufferPayload);\r\n\r\n                if (batch && (batch.length + payload.length > this._config.maxBatchSizeInBytes())) {\r\n                    this.triggerSend();\r\n                }\r\n\r\n                // enqueue the payload\r\n                this._buffer.enqueue(payload);\r\n\r\n                // ensure an invocation timeout is set\r\n                this._setupTimer();\r\n\r\n                // Uncomment if you want to use DataLossanalyzer\r\n                // DataLossAnalyzer.incrementItemsQueued();\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING,\r\n                    _InternalMessageId.FailedAddingTelemetryToBuffer,\r\n                    \"Failed adding telemetry to the sender's buffer, some telemetry will be lost: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Sets up the timer which triggers actually sending the data.\r\n         */\r\n        private _setupTimer() {\r\n            if (!this._timeoutHandle) {\r\n                var retryInterval = this._retryAt ? Math.max(0, this._retryAt - Date.now()) : 0;\r\n                var timerValue = Math.max(this._config.maxBatchInterval(), retryInterval);\r\n\r\n                this._timeoutHandle = setTimeout(() => {\r\n                    this.triggerSend();\r\n                }, timerValue);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Gets the size of the list in bytes.\r\n         * @param list {string[]} - The list to get the size in bytes of.\r\n         */\r\n        private _getSizeInBytes(list: string[]) {\r\n            var size = 0;\r\n            if (list && list.length) {\r\n                for (var i = 0; i < list.length; i++) {\r\n                    var item = list[i];\r\n                    if (item && item.length) {\r\n                        size += item.length;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return size;\r\n        }\r\n\r\n        /**\r\n         * Immediately send buffered data\r\n         * @param async {boolean} - Indicates if the events should be sent asynchronously\r\n         */\r\n        public triggerSend(async = true) {\r\n            try {\r\n                // Send data only if disableTelemetry is false\r\n                if (!this._config.disableTelemetry()) {\r\n\r\n                    if (this._buffer.count() > 0) {\r\n                        var payload = this._buffer.getItems();\r\n\r\n                        // invoke send\r\n                        this._sender(payload, async);\r\n                    }\r\n\r\n                    // update lastSend time to enable throttling\r\n                    this._lastSend = +new Date;\r\n                } else {\r\n                    this._buffer.clear();\r\n                }\r\n\r\n                clearTimeout(this._timeoutHandle);\r\n                this._timeoutHandle = null;\r\n                this._retryAt = null;\r\n            } catch (e) {\r\n                /* Ignore this error for IE under v10 */\r\n                if (!Util.getIEVersion() || Util.getIEVersion() > 9) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.CRITICAL,\r\n                        _InternalMessageId.TransmissionFailed,\r\n                        \"Telemetry transmission failed, some telemetry will be lost: \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                }\r\n            }\r\n        }\r\n\r\n        /** Calculates the time to wait before retrying in case of an error based on\r\n         * http://en.wikipedia.org/wiki/Exponential_backoff\r\n         */\r\n        private _setRetryTime() {\r\n            const SlotDelayInSeconds = 10;\r\n            var delayInSeconds: number;\r\n\r\n            if (this._consecutiveErrors <= 1) {\r\n                delayInSeconds = SlotDelayInSeconds;\r\n            } else {\r\n                var backOffSlot = (Math.pow(2, this._consecutiveErrors) - 1) / 2;\r\n                var backOffDelay = Math.floor(Math.random() * backOffSlot * SlotDelayInSeconds) + 1;\r\n                delayInSeconds = Math.max(Math.min(backOffDelay, 3600), SlotDelayInSeconds);\r\n            }\r\n\r\n            // TODO: Log the backoff time like the C# version does.\r\n            var retryAfterTimeSpan = Date.now() + (delayInSeconds * 1000);\r\n\r\n            // TODO: Log the retry at time like the C# version does.\r\n            this._retryAt = retryAfterTimeSpan;\r\n        }\r\n\r\n        /**\r\n         * Parses the response from the backend. \r\n         * @param response - XMLHttpRequest or XDomainRequest response\r\n         */\r\n        private _parseResponse(response: any): IBackendResponse {\r\n            try {\r\n                var result = JSON.parse(response);\r\n\r\n                if (result && result.itemsReceived && result.itemsReceived >= result.itemsAccepted &&\r\n                    result.itemsReceived - result.itemsAccepted == result.errors.length) {\r\n                    return result;\r\n                }\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.InvalidBackendResponse,\r\n                    \"Cannot parse the response. \" + Util.getExceptionName(e));\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        /**\r\n         * Checks if the SDK should resend the payload after receiving this status code from the backend.\r\n         * @param statusCode\r\n         */\r\n        private _isRetriable(statusCode: number): boolean {\r\n            return statusCode == 408 // Timeout\r\n                || statusCode == 429 // Too many requests.\r\n                || statusCode == 500 // Internal server error.\r\n                || statusCode == 503; // Service unavailable.\r\n        }\r\n\r\n        /**\r\n         * Resend payload. Adds payload back to the send buffer and setup a send timer (with exponential backoff).\r\n         * @param payload\r\n         */\r\n        private _resendPayload(payload: string[]) {\r\n            if (!payload || payload.length === 0) {\r\n                return;\r\n            }\r\n\r\n            this._buffer.clearSent(payload);\r\n            this._consecutiveErrors++;\r\n\r\n            for (var item of payload) {\r\n                this._buffer.enqueue(item);\r\n            }\r\n\r\n            // setup timer\r\n            this._setRetryTime();\r\n            this._setupTimer();\r\n        }\r\n\r\n        private _formatErrorMessageXhr(xhr: XMLHttpRequest, message?: string): string {\r\n            if (xhr) {\r\n                return \"XMLHttpRequest,Status:\" + xhr.status + \",Response:\" + xhr.responseText || xhr.response || \"\";\r\n            }\r\n\r\n            return message;\r\n        }\r\n\r\n        private _formatErrorMessageXdr(xdr: XDomainRequest, message?: string): string {\r\n            if (xdr) {\r\n                return \"XDomainRequest,Response:\" + xdr.responseText || \"\";\r\n            }\r\n\r\n            return message;\r\n        }\r\n\r\n        /**\r\n         * Send XMLHttpRequest\r\n         * @param payload {string} - The data payload to be sent.\r\n         * @param isAsync {boolean} - Indicates if the request should be sent asynchronously\r\n         */\r\n        private _xhrSender(payload: string[], isAsync: boolean) {\r\n            var xhr = new XMLHttpRequest();\r\n            xhr[AjaxMonitor.DisabledPropertyName] = true;\r\n            xhr.open(\"POST\", this._config.endpointUrl(), isAsync);\r\n            xhr.setRequestHeader(\"Content-type\", \"application/json\");\r\n            xhr.onreadystatechange = () => this._xhrReadyStateChange(xhr, payload, payload.length);\r\n            xhr.onerror = (event: ErrorEvent) => this._onError(payload, this._formatErrorMessageXhr(xhr), event);\r\n\r\n            // compose an array of payloads\r\n            var batch = this._buffer.batchPayloads(payload);\r\n            xhr.send(batch);\r\n\r\n            this._buffer.markAsSent(payload);\r\n        }\r\n\r\n        /**\r\n         * Send XDomainRequest\r\n         * @param payload {string} - The data payload to be sent.\r\n         * @param isAsync {boolean} - Indicates if the request should be sent asynchronously\r\n         * \r\n         * Note: XDomainRequest does not support sync requests. This 'isAsync' parameter is added\r\n         * to maintain consistency with the xhrSender's contract\r\n         */\r\n        private _xdrSender(payload: string[], isAsync: boolean) {\r\n            var xdr = new XDomainRequest();\r\n            xdr.onload = () => this._xdrOnLoad(xdr, payload);\r\n            xdr.onerror = (event: ErrorEvent) => this._onError(payload, this._formatErrorMessageXdr(xdr), event);\r\n\r\n            // XDomainRequest requires the same protocol as the hosting page. \r\n            // If the protocol doesn't match, we can't send the telemetry :(. \r\n            var hostingProtocol = window.location.protocol\r\n            if (this._config.endpointUrl().lastIndexOf(hostingProtocol, 0) !== 0) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING,\r\n                    _InternalMessageId.TransmissionFailed, \". \" +\r\n                    \"Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol.\");\r\n\r\n                this._buffer.clear();\r\n                return;\r\n            }\r\n\r\n            var endpointUrl = this._config.endpointUrl().replace(/^(https?:)/, \"\");\r\n            xdr.open('POST', endpointUrl);\r\n\r\n            // compose an array of payloads\r\n            var batch = this._buffer.batchPayloads(payload);\r\n            xdr.send(batch);\r\n\r\n            this._buffer.markAsSent(payload);\r\n        }\r\n\r\n        /**\r\n         * Send Beacon API request\r\n         * @param payload {string} - The data payload to be sent.\r\n         * @param isAsync {boolean} - not used\r\n         */\r\n        private _beaconSender(payload: string[], isAsync: boolean) {\r\n            var url = this._config.endpointUrl();\r\n            var batch = this._buffer.batchPayloads(payload);\r\n\r\n            // The sendBeacon method returns true if the user agent is able to successfully queue the data for transfer. Otherwise it returns false.\r\n            var queued = (<any>navigator).sendBeacon(url, batch);\r\n\r\n            if (queued) {\r\n                this._buffer.markAsSent(payload);\r\n            } else {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL, _InternalMessageId.TransmissionFailed, \". \" + \"Failed to send telemetry with Beacon API.\");\r\n            }\r\n        }\r\n\r\n        /**\r\n         * xhr state changes\r\n         */\r\n        public _xhrReadyStateChange(xhr: XMLHttpRequest, payload: string[], countOfItemsInPayload: number) {\r\n            if (xhr.readyState === 4) {\r\n                if ((xhr.status < 200 || xhr.status >= 300) && xhr.status !== 0) {\r\n                    if (!this._config.isRetryDisabled() && this._isRetriable(xhr.status)) {\r\n                        this._resendPayload(payload);\r\n\r\n                        _InternalLogging.throwInternal(\r\n                            LoggingSeverity.WARNING,\r\n                            _InternalMessageId.TransmissionFailed, \". \" +\r\n                            \"Response code \" + xhr.status + \". Will retry to send \" + payload.length + \" items.\");\r\n                    } else {\r\n                        this._onError(payload, this._formatErrorMessageXhr(xhr));\r\n                    }\r\n                } else {\r\n                    if (xhr.status === 206) {\r\n                        var response = this._parseResponse(xhr.responseText || xhr.response);\r\n\r\n                        if (response && !this._config.isRetryDisabled()) {\r\n                            this._onPartialSuccess(payload, response);\r\n                        } else {\r\n                            this._onError(payload, this._formatErrorMessageXhr(xhr));\r\n                        }\r\n                    } else {\r\n                        this._consecutiveErrors = 0;\r\n                        this._onSuccess(payload, countOfItemsInPayload);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * xdr state changes\r\n         */\r\n        public _xdrOnLoad(xdr: XDomainRequest, payload: string[]) {\r\n            if (xdr && (xdr.responseText + \"\" === \"200\" || xdr.responseText === \"\")) {\r\n                this._consecutiveErrors = 0;\r\n                this._onSuccess(payload, 0);\r\n            } else {\r\n                var results = this._parseResponse(xdr.responseText);\r\n\r\n                if (results && results.itemsReceived && results.itemsReceived > results.itemsAccepted\r\n                    && !this._config.isRetryDisabled()) {\r\n                    this._onPartialSuccess(payload, results);\r\n                } else {\r\n                    this._onError(payload, this._formatErrorMessageXdr(xdr));\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * partial success handler\r\n         */\r\n        public _onPartialSuccess(payload: string[], results: IBackendResponse) {\r\n            var failed = [];\r\n            var retry = [];\r\n\r\n            // Iterate through the reversed array of errors so that splicing doesn't have invalid indexes after the first item.\r\n            var errors = results.errors.reverse();\r\n            for (var error of errors) {\r\n                var extracted = payload.splice(error.index, 1)[0];\r\n                if (this._isRetriable(error.statusCode)) {\r\n                    retry.push(extracted);\r\n                } else {\r\n                    // All other errors, including: 402 (Monthly quota exceeded) and 439 (Too many requests and refresh cache).\r\n                    failed.push(extracted);\r\n                }\r\n            }\r\n\r\n            if (payload.length > 0) {\r\n                this._onSuccess(payload, results.itemsAccepted);\r\n            }\r\n\r\n            if (failed.length > 0) {\r\n                this._onError(failed, this._formatErrorMessageXhr(null, ['partial success', results.itemsAccepted, 'of', results.itemsReceived].join(' ')));\r\n            }\r\n\r\n            if (retry.length > 0) {\r\n                this._resendPayload(retry);\r\n\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING,\r\n                    _InternalMessageId.TransmissionFailed, \"Partial success. \" +\r\n                    \"Delivered: \" + payload.length + \", Failed: \" + failed.length +\r\n                    \". Will retry to send \" + retry.length + \" our of \" + results.itemsReceived + \" items\");\r\n            }\r\n        }\r\n\r\n        /**\r\n         * error handler\r\n         */\r\n        public _onError(payload: string[], message: string, event?: ErrorEvent) {\r\n            _InternalLogging.throwInternal(\r\n                LoggingSeverity.WARNING,\r\n                _InternalMessageId.OnError,\r\n                \"Failed to send telemetry.\",\r\n                { message: message });\r\n\r\n            this._buffer.clearSent(payload);\r\n        }\r\n\r\n        /**\r\n         * success handler\r\n         */\r\n        public _onSuccess(payload: string[], countOfItemsInPayload: number) {\r\n            // Uncomment if you want to use DataLossanalyzer\r\n            // DataLossAnalyzer.decrementItemsQueued(countOfItemsInPayload);\r\n\r\n            this._buffer.clearSent(payload);\r\n        }\r\n    }\r\n\r\n    interface linkedListNode {\r\n        next: linkedListNode;\r\n        payload: string;\r\n    }\r\n}\r\n","// THIS TYPE WAS AUTOGENERATED\r\nmodule Microsoft.Telemetry\r\n{\r\n\"use strict\";\r\n    export class Domain\r\n    {\r\n        \r\n        constructor()\r\n        {\r\n        }\r\n    }\r\n}\r\n","// THIS TYPE WAS AUTOGENERATED\r\n/// <reference path=\"Domain.ts\" />\r\n/// <reference path=\"SeverityLevel.ts\" />\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export class MessageData extends Microsoft.Telemetry.Domain\r\n    {\r\n        public ver: number;\r\n        public message: string;\r\n        public severityLevel: AI.SeverityLevel;\r\n        public properties: any;\r\n        \r\n        constructor()\r\n        {\r\n            super();\r\n\r\n            this.ver = 2;\r\n            this.properties = {};\r\n            \r\n            super();\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../Logging.ts\" />\r\n/// <reference path=\"../../Util.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry.Common {\r\n    \"use strict\";\r\n\r\n    export class DataSanitizer {\r\n\r\n        /**\r\n        * Max length allowed for custom names.\r\n        */\r\n        private static MAX_NAME_LENGTH = 150;\r\n\r\n        /**\r\n         * Max length allowed for custom values.\r\n         */\r\n        private static MAX_STRING_LENGTH = 1024;\r\n\r\n        /**\r\n         * Max length allowed for url.\r\n         */\r\n        private static MAX_URL_LENGTH = 2048;\r\n\r\n        /**\r\n         * Max length allowed for messages.\r\n         */\r\n        private static MAX_MESSAGE_LENGTH = 32768;\r\n\r\n        /**\r\n         * Max length allowed for exceptions.\r\n         */\r\n        private static MAX_EXCEPTION_LENGTH = 32768;\r\n\r\n        public static sanitizeKeyAndAddUniqueness(key, map) {\r\n            var origLength = key.length;\r\n            var field = DataSanitizer.sanitizeKey(key);\r\n\r\n            // validation truncated the length.  We need to add uniqueness\r\n            if (field.length !== origLength) {\r\n                var i = 0;\r\n                var uniqueField = field;\r\n                while (map[uniqueField] !== undefined) {\r\n                    i++;\r\n                    uniqueField = field.substring(0, DataSanitizer.MAX_NAME_LENGTH - 3) + DataSanitizer.padNumber(i);\r\n                }\r\n                field = uniqueField;\r\n            }\r\n            return field;\r\n        }\r\n\r\n        public static sanitizeKey(name) {\r\n            if (name) {\r\n                // Remove any leading or trailing whitepace\r\n                name = Util.trim(name.toString());\r\n\r\n                // truncate the string to 150 chars\r\n                if (name.length > DataSanitizer.MAX_NAME_LENGTH) {\r\n                    name = name.substring(0, DataSanitizer.MAX_NAME_LENGTH);\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.NameTooLong,\r\n                        \"name is too long.  It has been truncated to \" + DataSanitizer.MAX_NAME_LENGTH + \" characters.\",\r\n                        { name: name }, true);\r\n                }\r\n            }\r\n\r\n            return name;\r\n        }\r\n\r\n        public static sanitizeString(value) {\r\n            if (value) {\r\n                value = Util.trim(value);\r\n                if (value.toString().length > DataSanitizer.MAX_STRING_LENGTH) {\r\n                    value = value.toString().substring(0, DataSanitizer.MAX_STRING_LENGTH);\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.StringValueTooLong,\r\n                        \"string value is too long. It has been truncated to \" + DataSanitizer.MAX_STRING_LENGTH + \" characters.\",\r\n                        { value: value }, true);\r\n                }\r\n            }\r\n\r\n            return value;\r\n        }\r\n\r\n        public static sanitizeUrl(url) {\r\n            if (url) {\r\n                url = Util.trim(url);\r\n                if (url.length > DataSanitizer.MAX_URL_LENGTH) {\r\n                    url = url.substring(0, DataSanitizer.MAX_URL_LENGTH);\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.UrlTooLong,\r\n                        \"url is too long, it has been truncated to \" + DataSanitizer.MAX_URL_LENGTH + \" characters.\",\r\n                        { url: url },\r\n                        true);\r\n                }\r\n            }\r\n\r\n            return url;\r\n        }\r\n\r\n        public static sanitizeMessage(message) {\r\n            if (message) {\r\n                if (message.length > DataSanitizer.MAX_MESSAGE_LENGTH) {\r\n                    message = message.substring(0, DataSanitizer.MAX_MESSAGE_LENGTH);\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING, _InternalMessageId.MessageTruncated,\r\n                        \"message is too long, it has been truncated to \" + DataSanitizer.MAX_MESSAGE_LENGTH + \" characters.\",\r\n                        { message: message },\r\n                        true);\r\n                }\r\n            }\r\n\r\n            return message;\r\n        }\r\n\r\n        public static sanitizeException(exception) {\r\n            if (exception) {\r\n                if (exception.length > DataSanitizer.MAX_EXCEPTION_LENGTH) {\r\n                    exception = exception.substring(0, DataSanitizer.MAX_EXCEPTION_LENGTH);\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING, _InternalMessageId.ExceptionTruncated, \"exception is too long, it has been truncated to \" + DataSanitizer.MAX_EXCEPTION_LENGTH + \" characters.\",\r\n                        { exception: exception }, true);\r\n                }\r\n            }\r\n\r\n            return exception;\r\n        }\r\n\r\n        public static sanitizeProperties(properties) {\r\n            if (properties) {\r\n                var tempProps = {};\r\n                for (var prop in properties) {\r\n                    var value = DataSanitizer.sanitizeString(properties[prop]);\r\n                    prop = DataSanitizer.sanitizeKeyAndAddUniqueness(prop, tempProps);\r\n                    tempProps[prop] = value;\r\n                }\r\n                properties = tempProps;\r\n            }\r\n\r\n            return properties;\r\n        }\r\n\r\n        public static sanitizeMeasurements(measurements) {\r\n            if (measurements) {\r\n                var tempMeasurements = {};\r\n                for (var measure in measurements) {\r\n                    var value = measurements[measure];\r\n                    measure = DataSanitizer.sanitizeKeyAndAddUniqueness(measure, tempMeasurements);\r\n                    tempMeasurements[measure] = value;\r\n                }\r\n                measurements = tempMeasurements;\r\n            }\r\n\r\n            return measurements;\r\n        }\r\n\r\n        public static padNumber(num) {\r\n            var s = \"00\" + num;\r\n            return s.substr(s.length - 3);\r\n        }\r\n    }\r\n}","/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/MessageData.ts\" />\r\n/// <reference path=\"./Common/DataSanitizer.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    export class Trace extends AI.MessageData implements ISerializable {\r\n\r\n        public static envelopeType = \"Microsoft.ApplicationInsights.{0}.Message\";\r\n        public static dataType = \"MessageData\";\r\n\r\n        public aiDataContract = {\r\n            ver: FieldType.Required,\r\n            message: FieldType.Required,\r\n            severityLevel: FieldType.Default,\r\n            properties: FieldType.Default\r\n        };\r\n\r\n        /**\r\n         * Constructs a new instance of the TraceTelemetry object\r\n         */\r\n        constructor(message: string, properties?: any, severityLevel?: AI.SeverityLevel) {\r\n            super();\r\n            message = message || Util.NotSpecified;\r\n            this.message = Common.DataSanitizer.sanitizeMessage(message);\r\n            this.properties = Common.DataSanitizer.sanitizeProperties(properties);\r\n\r\n            if (severityLevel) {\r\n                this.severityLevel = severityLevel;\r\n            }\r\n        }\r\n    }\r\n}","// THIS TYPE WAS AUTOGENERATED\r\n/// <reference path=\"Domain.ts\" />\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export class EventData extends Microsoft.Telemetry.Domain\r\n    {\r\n        public ver: number;\r\n        public name: string;\r\n        public properties: any;\r\n        public measurements: any;\r\n        \r\n        constructor()\r\n        {\r\n            super();\r\n\r\n            this.ver = 2;\r\n            this.properties = {};\r\n            this.measurements = {};\r\n            \r\n            super();\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/EventData.ts\" />\r\n/// <reference path=\"./Common/DataSanitizer.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    export class Event extends AI.EventData implements ISerializable {\r\n\r\n        public static envelopeType = \"Microsoft.ApplicationInsights.{0}.Event\";\r\n        public static dataType = \"EventData\";\r\n\r\n        public aiDataContract = {\r\n            ver: FieldType.Required,\r\n            name: FieldType.Required,\r\n            properties: FieldType.Default,\r\n            measurements: FieldType.Default\r\n        }\r\n\r\n        /**\r\n         * Constructs a new instance of the EventTelemetry object\r\n         */\r\n        constructor(name: string, properties?: any, measurements?: any) {\r\n            \r\n            super();\r\n\r\n            this.name = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeString(name) || Util.NotSpecified;\r\n            this.properties = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeProperties(properties);\r\n            this.measurements = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeMeasurements(measurements);\r\n        }\r\n    }\r\n}","// THIS TYPE WAS AUTOGENERATED\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export class ExceptionDetails\r\n    {\r\n        public id: number;\r\n        public outerId: number;\r\n        public typeName: string;\r\n        public message: string;\r\n        public hasFullStack: boolean;\r\n        public stack: string;\r\n        public parsedStack: StackFrame[];\r\n        \r\n        constructor()\r\n        {\r\n            this.hasFullStack = true;\r\n            this.parsedStack = [];\r\n        }\r\n    }\r\n}\r\n","// THIS TYPE WAS AUTOGENERATED\r\n/// <reference path=\"Domain.ts\" />\r\n/// <reference path=\"SeverityLevel.ts\" />\r\n/// <reference path=\"ExceptionDetails.ts\"/>\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export class ExceptionData extends Microsoft.Telemetry.Domain\r\n    {\r\n        public ver: number;\r\n        public handledAt: string;\r\n        public exceptions: ExceptionDetails[];\r\n        public severityLevel: AI.SeverityLevel;\r\n        public problemId: string;\r\n        public crashThreadId: number;\r\n        public properties: any;\r\n        public measurements: any;\r\n        \r\n        constructor()\r\n        {\r\n            super();\r\n\r\n            this.ver = 2;\r\n            this.exceptions = [];\r\n            this.properties = {};\r\n            this.measurements = {};\r\n            \r\n            super();\r\n        }\r\n    }\r\n}\r\n","// THIS TYPE WAS AUTOGENERATED\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export class StackFrame\r\n    {\r\n        public level: number;\r\n        public method: string;\r\n        public assembly: string;\r\n        public fileName: string;\r\n        public line: number;\r\n        \r\n        constructor()\r\n        {\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/ExceptionData.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/StackFrame.ts\" />\r\n/// <reference path=\"./Common/DataSanitizer.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    export class Exception extends AI.ExceptionData implements ISerializable {\r\n\r\n        public static envelopeType = \"Microsoft.ApplicationInsights.{0}.Exception\";\r\n        public static dataType = \"ExceptionData\";\r\n\r\n\r\n        public aiDataContract = {\r\n            ver: FieldType.Required,\r\n            handledAt: FieldType.Required,\r\n            exceptions: FieldType.Required,\r\n            severityLevel: FieldType.Default,\r\n            properties: FieldType.Default,\r\n            measurements: FieldType.Default\r\n        }\r\n\r\n        /**\r\n        * Constructs a new isntance of the ExceptionTelemetry object\r\n        */\r\n        constructor(exception: Error, handledAt?: string, properties?: any, measurements?: any, severityLevel?: AI.SeverityLevel) {\r\n            super();\r\n\r\n            this.properties = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeProperties(properties);\r\n            this.measurements = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeMeasurements(measurements);\r\n\r\n            this.handledAt = handledAt || \"unhandled\";\r\n            this.exceptions = [new _ExceptionDetails(exception)];\r\n\r\n            if (severityLevel) {\r\n                this.severityLevel = severityLevel;\r\n            }\r\n        }\r\n        \r\n\r\n        /**\r\n        * Creates a simple exception with 1 stack frame. Useful for manual constracting of exception.\r\n        */\r\n        public static CreateSimpleException(message: string, typeName: string, assembly: string, fileName: string,\r\n            details: string, line: number, handledAt?: string): Telemetry.Exception {\r\n\r\n            return <Telemetry.Exception> {\r\n                handledAt: handledAt || \"unhandled\",\r\n                exceptions: [\r\n                    <AI.ExceptionDetails> {\r\n                        hasFullStack: true,\r\n                        message: message,\r\n                        stack: details,\r\n                        typeName: typeName\r\n                    }\r\n                ]\r\n            };\r\n        }\r\n    }\r\n\r\n    class _ExceptionDetails extends AI.ExceptionDetails implements ISerializable {\r\n\r\n        public aiDataContract = {\r\n            id: FieldType.Default,\r\n            outerId: FieldType.Default,\r\n            typeName: FieldType.Required,\r\n            message: FieldType.Required,\r\n            hasFullStack: FieldType.Default,\r\n            stack: FieldType.Default,\r\n            parsedStack: FieldType.Array\r\n        };\r\n\r\n        constructor(exception: Error) {\r\n            super();\r\n            this.typeName = Common.DataSanitizer.sanitizeString(exception.name) || Util.NotSpecified;\r\n            this.message = Common.DataSanitizer.sanitizeMessage(exception.message) || Util.NotSpecified;\r\n            var stack = exception[\"stack\"];\r\n            this.parsedStack = this.parseStack(stack);\r\n            this.stack = Common.DataSanitizer.sanitizeException(stack);\r\n            this.hasFullStack = Util.isArray(this.parsedStack) && this.parsedStack.length > 0;\r\n        }\r\n\r\n        private parseStack(stack): _StackFrame[] {\r\n            var parsedStack: _StackFrame[] = undefined;\r\n            if (typeof stack === \"string\") {\r\n                var frames = stack.split('\\n');\r\n                parsedStack = [];\r\n                var level = 0;\r\n\r\n                var totalSizeInBytes = 0;\r\n                for (var i = 0; i <= frames.length; i++) {\r\n                    var frame = frames[i];\r\n                    if (_StackFrame.regex.test(frame)) {\r\n                        var parsedFrame = new _StackFrame(frames[i], level++);\r\n                        totalSizeInBytes += parsedFrame.sizeInBytes;\r\n                        parsedStack.push(parsedFrame);\r\n                    }\r\n                }\r\n\r\n                // DP Constraint - exception parsed stack must be < 32KB\r\n                // remove frames from the middle to meet the threshold\r\n                var exceptionParsedStackThreshold = 32 * 1024;\r\n                if (totalSizeInBytes > exceptionParsedStackThreshold) {\r\n                    var left = 0;\r\n                    var right = parsedStack.length - 1;\r\n                    var size = 0;\r\n                    var acceptedLeft = left;\r\n                    var acceptedRight = right;\r\n\r\n                    while (left < right) {\r\n                        // check size\r\n                        var lSize = parsedStack[left].sizeInBytes;\r\n                        var rSize = parsedStack[right].sizeInBytes;\r\n                        size += lSize + rSize;\r\n\r\n                        if (size > exceptionParsedStackThreshold) {\r\n\r\n                            // remove extra frames from the middle\r\n                            var howMany = acceptedRight - acceptedLeft + 1;\r\n                            parsedStack.splice(acceptedLeft, howMany);\r\n                            break;\r\n                        }\r\n\r\n                        // update pointers\r\n                        acceptedLeft = left;\r\n                        acceptedRight = right;\r\n\r\n                        left++;\r\n                        right--;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return parsedStack;\r\n        }\r\n    }\r\n\r\n    export class _StackFrame extends AI.StackFrame implements ISerializable {\r\n        \r\n        // regex to match stack frames from ie/chrome/ff\r\n        // methodName=$2, fileName=$4, lineNo=$5, column=$6\r\n        public static regex = /^([\\s]+at)?(.*?)(\\@|\\s\\(|\\s)([^\\(\\@\\n]+):([0-9]+):([0-9]+)(\\)?)$/;\r\n        public static baseSize = 58; //'{\"method\":\"\",\"level\":,\"assembly\":\"\",\"fileName\":\"\",\"line\":}'.length\r\n        public sizeInBytes = 0;\r\n\r\n        public aiDataContract = {\r\n            level: FieldType.Required,\r\n            method: FieldType.Required,\r\n            assembly: FieldType.Default,\r\n            fileName: FieldType.Default,\r\n            line: FieldType.Default\r\n        };\r\n\r\n        constructor(frame: string, level: number) {\r\n            super();\r\n            this.level = level;\r\n            this.method = \"<no_method>\";\r\n            this.assembly = Util.trim(frame);\r\n            var matches = frame.match(_StackFrame.regex);\r\n            if (matches && matches.length >= 5) {\r\n                this.method = Util.trim(matches[2]) || this.method;\r\n                this.fileName = Util.trim(matches[4]);\r\n                this.line = parseInt(matches[5]) || 0;\r\n            }\r\n\r\n            this.sizeInBytes += this.method.length;\r\n            this.sizeInBytes += this.fileName.length;\r\n            this.sizeInBytes += this.assembly.length;\r\n\r\n            // todo: these might need to be removed depending on how the back-end settles on their size calculation\r\n            this.sizeInBytes += _StackFrame.baseSize;\r\n            this.sizeInBytes += this.level.toString().length;\r\n            this.sizeInBytes += this.line.toString().length;\r\n        }\r\n    }\r\n}","// THIS TYPE WAS AUTOGENERATED\r\n/// <reference path=\"Domain.ts\" />\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export class MetricData extends Microsoft.Telemetry.Domain\r\n    {\r\n        public ver: number;\r\n        public metrics: DataPoint[];\r\n        public properties: any;\r\n        \r\n        constructor()\r\n        {\r\n            super();\r\n\r\n            this.ver = 2;\r\n            this.metrics = [];\r\n            this.properties = {};\r\n            \r\n            super();\r\n        }\r\n    }\r\n}\r\n","// THIS TYPE WAS AUTOGENERATED\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export enum DataPointType\r\n    {\r\n        Measurement = 0,\r\n        Aggregation = 1,\r\n    }\r\n}\r\n","// THIS TYPE WAS AUTOGENERATED\r\n/// <reference path=\"DataPointType.ts\" />\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export class DataPoint\r\n    {\r\n        public name: string;\r\n        public kind: AI.DataPointType;\r\n        public value: number;\r\n        public count: number;\r\n        public min: number;\r\n        public max: number;\r\n        public stdDev: number;\r\n        \r\n        constructor()\r\n        {\r\n            this.kind = AI.DataPointType.Measurement;\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../../JavaScriptSDK.Interfaces/Contracts/Generated/DataPoint.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry.Common {\r\n    \"use strict\";\r\n    export class DataPoint extends AI.DataPoint implements ISerializable {\r\n\r\n        /**\r\n         * The data contract for serializing this object.\r\n         */\r\n        public aiDataContract = {\r\n            name: FieldType.Required,\r\n            kind: FieldType.Default,\r\n            value: FieldType.Required,\r\n            count: FieldType.Default,\r\n            min: FieldType.Default,\r\n            max: FieldType.Default,\r\n            stdDev: FieldType.Default\r\n        }\r\n    }\r\n}","/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/MetricData.ts\" />\r\n/// <reference path=\"./Common/DataSanitizer.ts\" />\r\n/// <reference path=\"./Common/DataPoint.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    export class Metric extends AI.MetricData implements ISerializable {\r\n\r\n        public static envelopeType = \"Microsoft.ApplicationInsights.{0}.Metric\";\r\n        public static dataType = \"MetricData\";\r\n\r\n        public aiDataContract = {\r\n            ver: FieldType.Required,\r\n            metrics: FieldType.Required,\r\n            properties: FieldType.Default\r\n        }\r\n\r\n        /**\r\n         * Constructs a new instance of the MetricTelemetry object\r\n         */\r\n        constructor(name: string, value: number, count?: number, min?: number, max?: number, properties?: any) {\r\n            super();\r\n\r\n            var dataPoint = new Microsoft.ApplicationInsights.Telemetry.Common.DataPoint();\r\n            dataPoint.count = count > 0 ? count : undefined;\r\n            dataPoint.max = isNaN(max) || max === null ? undefined : max;\r\n            dataPoint.min = isNaN(min) || min === null ? undefined : min;\r\n            dataPoint.name = Common.DataSanitizer.sanitizeString(name) || Util.NotSpecified;\r\n            dataPoint.value = value;\r\n\r\n            this.metrics = [dataPoint];\r\n            this.properties = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeProperties(properties);\r\n        }\r\n    }\r\n}","// THIS TYPE WAS AUTOGENERATED\r\n/// <reference path=\"EventData.ts\" />\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export class PageViewData extends AI.EventData\r\n    {\r\n        public ver: number;\r\n        public url: string;\r\n        public name: string;\r\n        public duration: string;\r\n        public referrer: string;\r\n        public referrerData: string;\r\n        public properties: any;\r\n        public measurements: any;\r\n        \r\n        constructor()\r\n        {\r\n            super();\r\n\r\n            this.ver = 2;\r\n            this.properties = {};\r\n            this.measurements = {};\r\n            \r\n            super();\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/PageViewData.ts\" />\r\n/// <reference path=\"./Common/DataSanitizer.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    export class PageView extends AI.PageViewData implements ISerializable {\r\n\r\n        public static envelopeType = \"Microsoft.ApplicationInsights.{0}.Pageview\";\r\n        public static dataType = \"PageviewData\";\r\n\r\n        public aiDataContract = {\r\n            ver: FieldType.Required,\r\n            name: FieldType.Default,\r\n            url: FieldType.Default,\r\n            duration: FieldType.Default,\r\n            properties: FieldType.Default,\r\n            measurements: FieldType.Default\r\n        }\r\n\r\n        /**\r\n         * Constructs a new instance of the PageEventTelemetry object\r\n         */\r\n        constructor(name?: string, url?: string, durationMs?: number, properties?: any, measurements?: any) {\r\n            super();\r\n\r\n            this.url = Common.DataSanitizer.sanitizeUrl(url);\r\n            this.name = Common.DataSanitizer.sanitizeString(name) || Util.NotSpecified;\r\n            if (!isNaN(durationMs)) {\r\n                this.duration = Util.msToTimeSpan(durationMs);\r\n            }\r\n            this.properties = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeProperties(properties);\r\n            this.measurements = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeMeasurements(measurements);\r\n        }\r\n    }\r\n}","// THIS TYPE WAS AUTOGENERATED\r\n/// <reference path=\"PageViewData.ts\" />\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export class PageViewPerfData extends AI.PageViewData\r\n    {\r\n        public ver: number;\r\n        public url: string;\r\n        public perfTotal: string;\r\n        public name: string;\r\n        public duration: string;\r\n        public networkConnect: string;\r\n        public referrer: string;\r\n        public sentRequest: string;\r\n        public referrerData: string;\r\n        public receivedResponse: string;\r\n        public domProcessing: string;\r\n        public properties: any;\r\n        public measurements: any;\r\n        \r\n        constructor()\r\n        {\r\n            super();\r\n\r\n            this.ver = 2;\r\n            this.properties = {};\r\n            this.measurements = {};\r\n            \r\n            super();\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/PageViewPerfData.ts\"/>\r\n/// <reference path=\"./Common/DataSanitizer.ts\"/>\r\n/// <reference path=\"../Util.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    export class PageViewPerformance extends AI.PageViewPerfData implements ISerializable {\r\n\r\n        public static envelopeType = \"Microsoft.ApplicationInsights.{0}.PageviewPerformance\";\r\n        public static dataType = \"PageviewPerformanceData\";\r\n\r\n        private static MAX_DURATION_ALLOWED = 3600000; // 1h\r\n\r\n        public aiDataContract = {\r\n            ver: FieldType.Required,\r\n            name: FieldType.Default,\r\n            url: FieldType.Default,\r\n            duration: FieldType.Default,\r\n            perfTotal: FieldType.Default,\r\n            networkConnect: FieldType.Default,\r\n            sentRequest: FieldType.Default,\r\n            receivedResponse: FieldType.Default,\r\n            domProcessing: FieldType.Default,\r\n            properties: FieldType.Default,\r\n            measurements: FieldType.Default\r\n        };\r\n\r\n        /**\r\n         * Field indicating whether this instance of PageViewPerformance is valid and should be sent\r\n         */\r\n        private isValid: boolean;\r\n\r\n        /**\r\n         * Indicates whether this instance of PageViewPerformance is valid and should be sent\r\n         */\r\n        public getIsValid() {\r\n            return this.isValid;\r\n        }\r\n\r\n        private durationMs: number;\r\n\r\n        /**\r\n        * Gets the total duration (PLT) in milliseconds. Check getIsValid() before using this method.\r\n        */\r\n        public getDurationMs() {\r\n            return this.durationMs;\r\n        }\r\n\r\n        /**\r\n         * Constructs a new instance of the PageEventTelemetry object\r\n         */\r\n        constructor(name: string, url: string, unused: number, properties?: any, measurements?: any) {\r\n            super();\r\n\r\n            this.isValid = false;\r\n\r\n            /*\r\n             * http://www.w3.org/TR/navigation-timing/#processing-model\r\n             *  |-navigationStart\r\n             *  |             |-connectEnd\r\n             *  |             ||-requestStart\r\n             *  |             ||             |-responseStart\r\n             *  |             ||             |              |-responseEnd\r\n             *  |             ||             |              |\r\n             *  |             ||             |              |         |-loadEventEnd\r\n             *  |---network---||---request---|---response---|---dom---|\r\n             *  |--------------------------total----------------------|\r\n             */\r\n            var timing = PageViewPerformance.getPerformanceTiming();\r\n            if (timing) {\r\n                var total = PageViewPerformance.getDuration(timing.navigationStart, timing.loadEventEnd);\r\n                var network = PageViewPerformance.getDuration(timing.navigationStart, timing.connectEnd);\r\n                var request = PageViewPerformance.getDuration(timing.requestStart, timing.responseStart);\r\n                var response = PageViewPerformance.getDuration(timing.responseStart, timing.responseEnd);\r\n                var dom = PageViewPerformance.getDuration(timing.responseEnd, timing.loadEventEnd);\r\n\r\n                if (total == 0) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.ErrorPVCalc,\r\n                        \"error calculating page view performance.\",\r\n                        { total: total, network: network, request: request, response: response, dom: dom });\r\n\r\n                } else if (!PageViewPerformance.shouldCollectDuration(total, network, request, response, dom)) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.InvalidDurationValue,\r\n                        \"Invalid page load duration value. Browser perf data won't be sent.\",\r\n                        { total: total, network: network, request: request, response: response, dom: dom });\r\n\r\n                } else if (total < Math.floor(network) + Math.floor(request) + Math.floor(response) + Math.floor(dom)) {\r\n                    // some browsers may report individual components incorrectly so that the sum of the parts will be bigger than total PLT\r\n                    // in this case, don't report client performance from this page\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.WARNING,\r\n                        _InternalMessageId.ClientPerformanceMathError,\r\n                        \"client performance math error.\",\r\n                        { total: total, network: network, request: request, response: response, dom: dom });\r\n\r\n                } else {\r\n                    this.durationMs = total;\r\n\r\n                    // convert to timespans\r\n                    this.perfTotal = this.duration = Util.msToTimeSpan(total);\r\n                    this.networkConnect = Util.msToTimeSpan(network);\r\n                    this.sentRequest = Util.msToTimeSpan(request);\r\n                    this.receivedResponse = Util.msToTimeSpan(response);\r\n                    this.domProcessing = Util.msToTimeSpan(dom);\r\n\r\n                    this.isValid = true;\r\n                }\r\n            }\r\n\r\n            this.url = Common.DataSanitizer.sanitizeUrl(url);\r\n            this.name = Common.DataSanitizer.sanitizeString(name) || Util.NotSpecified;\r\n\r\n            this.properties = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeProperties(properties);\r\n            this.measurements = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeMeasurements(measurements);\r\n        }\r\n\r\n        public static getPerformanceTiming(): PerformanceTiming {\r\n            if (PageViewPerformance.isPerformanceTimingSupported()) {\r\n                return window.performance.timing;\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        /**\r\n        * Returns true is window performance timing API is supported, false otherwise.\r\n        */\r\n        public static isPerformanceTimingSupported() {\r\n            return typeof window != \"undefined\" && window.performance && window.performance.timing;\r\n        }\r\n\r\n        /**\r\n         * As page loads different parts of performance timing numbers get set. When all of them are set we can report it.\r\n         * Returns true if ready, false otherwise.\r\n         */\r\n        public static isPerformanceTimingDataReady() {\r\n            var timing = window.performance.timing;\r\n\r\n            return timing.domainLookupStart > 0\r\n                && timing.navigationStart > 0\r\n                && timing.responseStart > 0\r\n                && timing.requestStart > 0\r\n                && timing.loadEventEnd > 0\r\n                && timing.responseEnd > 0\r\n                && timing.connectEnd > 0\r\n                && timing.domLoading > 0;\r\n        }\r\n\r\n        public static getDuration(start: any, end: any): number {\r\n            var duration = undefined;\r\n            if (!(isNaN(start) || isNaN(end))) {\r\n                duration = Math.max(end - start, 0);\r\n            }\r\n\r\n            return duration;\r\n        }\r\n\r\n        /**\r\n         * This method tells if given durations should be excluded from collection.\r\n         */\r\n        public static shouldCollectDuration(...durations: number[]): boolean {\r\n            let userAgent = navigator.userAgent;\r\n            let isGoogleBot = userAgent ? userAgent.toLowerCase().indexOf(\"googlebot\") !== -1 : false;\r\n\r\n            if (isGoogleBot) {\r\n                // Don't report durations for GoogleBot, it is returning invalid values in performance.timing API. \r\n                return false;\r\n            } else {\r\n                // for other page views, don't report if it's outside of a reasonable range\r\n                for (var i = 0; i < durations.length; i++) {\r\n                    if (durations[i] >= PageViewPerformance.MAX_DURATION_ALLOWED) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return true;\r\n        }\r\n    }\r\n}","/// <reference path=\"Sender.ts\"/>\r\n/// <reference path=\"Telemetry/Trace.ts\" />\r\n/// <reference path=\"Telemetry/Event.ts\" />\r\n/// <reference path=\"Telemetry/Exception.ts\" />\r\n/// <reference path=\"Telemetry/Metric.ts\" />\r\n/// <reference path=\"Telemetry/PageView.ts\" />\r\n/// <reference path=\"Telemetry/PageViewPerformance.ts\" />\r\n/// <reference path=\"./Util.ts\"/>\r\n/// <reference path=\"../JavaScriptSDK.Interfaces/Contracts/Generated/SessionState.ts\"/>\r\n/// <reference path=\"../JavaScriptSDK.Interfaces/ITelemetryContext.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    export interface ITelemetryConfig extends ISenderConfig {\r\n        instrumentationKey: () => string;\r\n        accountId: () => string;\r\n        sessionRenewalMs: () => number;\r\n        sessionExpirationMs: () => number;\r\n        sampleRate: () => number;\r\n        cookieDomain: () => string;\r\n        sdkExtension: () => string;\r\n        isBrowserLinkTrackingEnabled: () => boolean;\r\n    }\r\n\r\n    export class TelemetryContext implements ITelemetryContext {\r\n        /**\r\n         * The configuration for this telemetry context\r\n         */\r\n        public _config: ITelemetryConfig;\r\n\r\n        /**\r\n         * The sender instance for this context\r\n         */\r\n        public _sender: Sender;\r\n\r\n        /**\r\n         * The object describing a component tracked by this object.\r\n         */\r\n        public application: Context.Application;\r\n\r\n        /**\r\n         * The object describing a device tracked by this object.\r\n         */\r\n        public device: Context.Device;\r\n\r\n        public internal: Context.Internal;\r\n\r\n        /**\r\n         * The object describing a location tracked by this object.\r\n         */\r\n        public location: Context.Location;\r\n\r\n        /**\r\n         * The object describing a operation tracked by this object.\r\n         */\r\n        public operation: Context.Operation;\r\n\r\n        public sample: Context.Sample;\r\n\r\n        /**\r\n         * The object describing a user tracked by this object.\r\n         */\r\n        public user: Context.User;\r\n\r\n        /**\r\n         * The object describing a session tracked by this object.\r\n         */\r\n        public session: Context.Session;\r\n\r\n        /**\r\n        * The array of telemetry initializers to call before sending each telemetry item.\r\n        */\r\n        private telemetryInitializers: { (envelope: Microsoft.ApplicationInsights.IEnvelope): boolean | void; }[];\r\n\r\n        /**\r\n         * The session manager that manages session on the base of cookies.\r\n         */\r\n        public _sessionManager: Microsoft.ApplicationInsights.Context._SessionManager;\r\n\r\n        constructor(config: ITelemetryConfig) {\r\n            this._config = config;\r\n            this._sender = new Sender(config);\r\n            this.telemetryInitializers = [];\r\n\r\n            // window will be undefined in node.js where we do not want to initialize contexts\r\n            if (typeof window !== 'undefined') {\r\n                this._sessionManager = new ApplicationInsights.Context._SessionManager(config);\r\n                this.application = new Context.Application();\r\n                this.device = new Context.Device();\r\n                this.internal = new Context.Internal(config);\r\n                this.location = new Context.Location();\r\n                this.user = new Context.User(config);\r\n                this.operation = new Context.Operation();\r\n                this.session = new Context.Session();\r\n                this.sample = new Context.Sample(config.sampleRate());\r\n            }\r\n\r\n            this._addDefaultTelemetryInitializers();\r\n        }\r\n\r\n        /**\r\n        * Adds telemetry initializer to the collection. Telemetry initializers will be called one by one\r\n        * before telemetry item is pushed for sending and in the order they were added.\r\n        */\r\n        public addTelemetryInitializer(telemetryInitializer: (envelope: Microsoft.ApplicationInsights.IEnvelope) => boolean | void) {\r\n            this.telemetryInitializers.push(telemetryInitializer);\r\n        }\r\n\r\n        /**\r\n         * Use Sender.ts to send telemetry object to the endpoint\r\n         */\r\n        public track(envelope: Microsoft.ApplicationInsights.IEnvelope) {\r\n            if (!envelope) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.TrackArgumentsNotSpecified,\r\n                    \"cannot call .track() with a null or undefined argument\", null, true);\r\n            } else {\r\n                // If the envelope is PageView, reset the internal message count so that we can send internal telemetry for the new page.\r\n                if (envelope.name === Telemetry.PageView.envelopeType) {\r\n                    _InternalLogging.resetInternalMessageCount();\r\n                }\r\n\r\n                if (this.session) {\r\n                    // If customer did not provide custom session id update sessionmanager\r\n                    if (typeof this.session.id !== \"string\") {\r\n                        this._sessionManager.update();\r\n                    }\r\n                }\r\n\r\n                this._track(envelope);\r\n            }\r\n\r\n            return envelope;\r\n        }\r\n\r\n        private _addDefaultTelemetryInitializers() {\r\n            if (!this._config.isBrowserLinkTrackingEnabled()) {\r\n                const browserLinkPaths = ['/browserLinkSignalR/', '/__browserLink/'];\r\n                let dropBrowserLinkRequests = (envelope: Microsoft.ApplicationInsights.IEnvelope) => {\r\n                    if (envelope.name === Microsoft.ApplicationInsights.Telemetry.RemoteDependencyData.envelopeType) {\r\n                        let remoteData = envelope.data as Telemetry.Common.Data<Microsoft.ApplicationInsights.Telemetry.RemoteDependencyData>;\r\n                        if (remoteData && remoteData.baseData) {\r\n                            for (let i = 0; i < browserLinkPaths.length; i++) {\r\n                                if (remoteData.baseData.name.indexOf(browserLinkPaths[i]) >= 0) {\r\n                                    return false;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    return true;\r\n                }\r\n\r\n                this.addTelemetryInitializer(dropBrowserLinkRequests)\r\n            }\r\n        }\r\n\r\n        private _track(envelope: Microsoft.ApplicationInsights.IEnvelope) {\r\n\r\n            if (this.session) {\r\n                // If customer set id, apply his context; otherwise apply context generated from cookies \r\n                if (typeof this.session.id === \"string\") {\r\n                    this._applySessionContext(envelope, this.session);\r\n                } else {\r\n                    this._applySessionContext(envelope, this._sessionManager.automaticSession);\r\n                }\r\n            }\r\n\r\n            this._applyApplicationContext(envelope, this.application);\r\n            this._applyDeviceContext(envelope, this.device);\r\n            this._applyInternalContext(envelope, this.internal);\r\n            this._applyLocationContext(envelope, this.location);\r\n            this._applySampleContext(envelope, this.sample);\r\n            this._applyUserContext(envelope, this.user);\r\n            this._applyOperationContext(envelope, this.operation);\r\n\r\n            envelope.iKey = this._config.instrumentationKey();\r\n\r\n            var doNotSendItem = false;\r\n            try {\r\n                var telemetryInitializersCount = this.telemetryInitializers.length;\r\n                for (var i = 0; i < telemetryInitializersCount; ++i) {\r\n                    var telemetryInitializer = this.telemetryInitializers[i];\r\n                    if (telemetryInitializer) {\r\n                        if (telemetryInitializer.apply(null, [envelope]) === false) {\r\n                            doNotSendItem = true;\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                doNotSendItem = true;\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.CRITICAL, _InternalMessageId.TelemetryInitializerFailed, \"One of telemetry initializers failed, telemetry item will not be sent: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) }, true);\r\n            }\r\n\r\n            if (!doNotSendItem) {\r\n                this._fixDepricatedValues(envelope);\r\n\r\n                if (envelope.name === Telemetry.Metric.envelopeType ||\r\n                    this.sample.isSampledIn(envelope)) {\r\n                    var iKeyNoDashes = this._config.instrumentationKey().replace(/-/g, \"\");\r\n                    envelope.name = envelope.name.replace(\"{0}\", iKeyNoDashes);\r\n                    this._sender.send(envelope);\r\n                } else {\r\n                    _InternalLogging.throwInternal(LoggingSeverity.WARNING, _InternalMessageId.TelemetrySampledAndNotSent,\r\n                        \"Telemetry is sampled and not sent to the AI service.\", { SampleRate: this.sample.sampleRate }, true);\r\n                }\r\n            }\r\n\r\n            return envelope;\r\n        }\r\n\r\n        private _applyApplicationContext(envelope: Microsoft.ApplicationInsights.IEnvelope, appContext: Microsoft.ApplicationInsights.Context.Application) {\r\n            if (appContext) {\r\n                var tagKeys: AI.ContextTagKeys = new AI.ContextTagKeys();\r\n\r\n                if (typeof appContext.ver === \"string\") {\r\n                    envelope.tags[tagKeys.applicationVersion] = appContext.ver;\r\n                }\r\n                if (typeof appContext.build === \"string\") {\r\n                    envelope.tags[tagKeys.applicationBuild] = appContext.build;\r\n                }\r\n            }\r\n        }\r\n\r\n        private _applyDeviceContext(envelope: Microsoft.ApplicationInsights.IEnvelope, deviceContext: Microsoft.ApplicationInsights.Context.Device) {\r\n            var tagKeys: AI.ContextTagKeys = new AI.ContextTagKeys();\r\n\r\n            if (deviceContext) {\r\n                if (typeof deviceContext.id === \"string\") {\r\n                    envelope.tags[tagKeys.deviceId] = deviceContext.id;\r\n                }\r\n                if (typeof deviceContext.ip === \"string\") {\r\n                    envelope.tags[tagKeys.deviceIp] = deviceContext.ip;\r\n                }\r\n                if (typeof deviceContext.language === \"string\") {\r\n                    envelope.tags[tagKeys.deviceLanguage] = deviceContext.language;\r\n                }\r\n                if (typeof deviceContext.locale === \"string\") {\r\n                    envelope.tags[tagKeys.deviceLocale] = deviceContext.locale;\r\n                }\r\n                if (typeof deviceContext.model === \"string\") {\r\n                    envelope.tags[tagKeys.deviceModel] = deviceContext.model;\r\n                }\r\n                if (typeof deviceContext.network !== \"undefined\") {\r\n                    envelope.tags[tagKeys.deviceNetwork] = deviceContext.network;\r\n                }\r\n                if (typeof deviceContext.oemName === \"string\") {\r\n                    envelope.tags[tagKeys.deviceOEMName] = deviceContext.oemName;\r\n                }\r\n                if (typeof deviceContext.os === \"string\") {\r\n                    envelope.tags[tagKeys.deviceOS] = deviceContext.os;\r\n                }\r\n                if (typeof deviceContext.osversion === \"string\") {\r\n                    envelope.tags[tagKeys.deviceOSVersion] = deviceContext.osversion;\r\n                }\r\n                if (typeof deviceContext.resolution === \"string\") {\r\n                    envelope.tags[tagKeys.deviceScreenResolution] = deviceContext.resolution;\r\n                }\r\n                if (typeof deviceContext.type === \"string\") {\r\n                    envelope.tags[tagKeys.deviceType] = deviceContext.type;\r\n                }\r\n            }\r\n        }\r\n\r\n        private _applyInternalContext(envelope: Microsoft.ApplicationInsights.IEnvelope, internalContext: Microsoft.ApplicationInsights.Context.Internal) {\r\n            if (internalContext) {\r\n                var tagKeys: AI.ContextTagKeys = new AI.ContextTagKeys();\r\n                if (typeof internalContext.agentVersion === \"string\") {\r\n                    envelope.tags[tagKeys.internalAgentVersion] = internalContext.agentVersion;\r\n                }\r\n                if (typeof internalContext.sdkVersion === \"string\") {\r\n                    envelope.tags[tagKeys.internalSdkVersion] = internalContext.sdkVersion;\r\n                }\r\n            }\r\n        }\r\n\r\n        private _applyLocationContext(envelope: Microsoft.ApplicationInsights.IEnvelope, locationContext: Microsoft.ApplicationInsights.Context.Location) {\r\n            if (locationContext) {\r\n                var tagKeys: AI.ContextTagKeys = new AI.ContextTagKeys();\r\n                if (typeof locationContext.ip === \"string\") {\r\n                    envelope.tags[tagKeys.locationIp] = locationContext.ip;\r\n                }\r\n            }\r\n        }\r\n\r\n        private _applyOperationContext(envelope: Microsoft.ApplicationInsights.IEnvelope, operationContext: Microsoft.ApplicationInsights.Context.Operation) {\r\n            if (operationContext) {\r\n                var tagKeys: AI.ContextTagKeys = new AI.ContextTagKeys();\r\n                if (typeof operationContext.id === \"string\") {\r\n                    envelope.tags[tagKeys.operationId] = operationContext.id;\r\n                }\r\n                if (typeof operationContext.name === \"string\") {\r\n                    envelope.tags[tagKeys.operationName] = operationContext.name;\r\n                }\r\n                if (typeof operationContext.parentId === \"string\") {\r\n                    envelope.tags[tagKeys.operationParentId] = operationContext.parentId;\r\n                }\r\n                if (typeof operationContext.rootId === \"string\") {\r\n                    envelope.tags[tagKeys.operationRootId] = operationContext.rootId;\r\n                }\r\n                if (typeof operationContext.syntheticSource === \"string\") {\r\n                    envelope.tags[tagKeys.operationSyntheticSource] = operationContext.syntheticSource;\r\n                }\r\n            }\r\n        }\r\n\r\n        private _applySampleContext(envelope: Microsoft.ApplicationInsights.IEnvelope, sampleContext: Microsoft.ApplicationInsights.Context.Sample) {\r\n            if (sampleContext) {\r\n                envelope.sampleRate = sampleContext.sampleRate;\r\n            }\r\n        }\r\n\r\n        private _applySessionContext(envelope: Microsoft.ApplicationInsights.IEnvelope, sessionContext: Microsoft.ApplicationInsights.Context.Session) {\r\n            if (sessionContext) {\r\n                var tagKeys: AI.ContextTagKeys = new AI.ContextTagKeys();\r\n                if (typeof sessionContext.id === \"string\") {\r\n                    envelope.tags[tagKeys.sessionId] = sessionContext.id;\r\n                }\r\n                if (typeof sessionContext.isFirst !== \"undefined\") {\r\n                    envelope.tags[tagKeys.sessionIsFirst] = sessionContext.isFirst;\r\n                }\r\n            }\r\n        }\r\n\r\n        private _applyUserContext(envelope: Microsoft.ApplicationInsights.IEnvelope, userContext: Microsoft.ApplicationInsights.Context.User) {\r\n            if (userContext) {\r\n                var tagKeys: AI.ContextTagKeys = new AI.ContextTagKeys();\r\n                if (typeof userContext.accountId === \"string\") {\r\n                    envelope.tags[tagKeys.userAccountId] = userContext.accountId;\r\n                }\r\n                if (typeof userContext.agent === \"string\") {\r\n                    envelope.tags[tagKeys.userAgent] = userContext.agent;\r\n                }\r\n                if (typeof userContext.id === \"string\") {\r\n                    envelope.tags[tagKeys.userId] = userContext.id;\r\n                }\r\n                if (typeof userContext.authenticatedId === \"string\") {\r\n                    envelope.tags[tagKeys.userAuthUserId] = userContext.authenticatedId;\r\n                }\r\n                if (typeof userContext.storeRegion === \"string\") {\r\n                    envelope.tags[tagKeys.userStoreRegion] = userContext.storeRegion;\r\n                }\r\n            }\r\n        }\r\n\r\n        private _fixDepricatedValues(envelope: Microsoft.ApplicationInsights.IEnvelope) {\r\n            try {\r\n                var data = (<any>envelope).data;\r\n                if (data && data.baseType === Microsoft.ApplicationInsights.Telemetry.RemoteDependencyData.dataType) {\r\n                    var rddData = <Microsoft.ApplicationInsights.Telemetry.RemoteDependencyData>(<any>data.baseData);\r\n                    if (rddData) {\r\n                        this._fixRDDDepricatedValues(rddData);\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING,\r\n                    _InternalMessageId.FailedToFixDepricatedValues,\r\n                    \"Failed to parse the base data object, to fix the depricated values \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        private _fixRDDDepricatedValues(rddData: Microsoft.ApplicationInsights.Telemetry.RemoteDependencyData) {\r\n            if (rddData.commandName) {\r\n                rddData.data = rddData.commandName;\r\n                rddData.commandName = undefined;\r\n            }\r\n\r\n            if (rddData.dependencyTypeName) {\r\n                rddData.type = rddData.dependencyTypeName;\r\n                rddData.dependencyTypeName = undefined;\r\n            }\r\n\r\n            if (rddData.value && rddData.value !== 0) {\r\n                rddData.duration = Util.msToTimeSpan(rddData.value);\r\n                rddData.value = undefined;\r\n            }\r\n\r\n            if (rddData.kind) {\r\n                rddData.kind = undefined;\r\n            }\r\n\r\n            if (rddData.dependencySource) {\r\n                rddData.dependencySource = undefined;\r\n            }\r\n\r\n            if (rddData.async) {\r\n                rddData.async = undefined;\r\n            }\r\n\r\n            if (rddData.count) {\r\n                rddData.count = undefined;\r\n            }\r\n\r\n            if (rddData.min) {\r\n                rddData.min = undefined;\r\n            }\r\n\r\n            if (rddData.max) {\r\n                rddData.max = undefined;\r\n            }\r\n\r\n            if (rddData.stdDev) {\r\n                rddData.stdDev = undefined;\r\n            }\r\n\r\n            if (rddData.dependencyKind) {\r\n                rddData.dependencyKind = undefined;\r\n            }\r\n        }\r\n    }\r\n}","// THIS TYPE WAS AUTOGENERATED\r\n/// <reference path=\"Base.ts\" />\r\nmodule Microsoft.Telemetry\r\n{\r\n\"use strict\";\r\n    export class Data<TDomain> extends Microsoft.Telemetry.Base\r\n    {\r\n        public baseType: string;\r\n        public baseData: TDomain;\r\n        \r\n        constructor()\r\n        {\r\n            \r\n            super();\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../../JavaScriptSDK.Interfaces/Contracts/Generated/Data.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry.Common {\r\n    \"use strict\";\r\n    export class Data<TDomain> extends Microsoft.Telemetry.Data<TDomain> implements ISerializable {\r\n\r\n        /**\r\n         * The data contract for serializing this object.\r\n         */\r\n        public aiDataContract = {\r\n            baseType: FieldType.Required,\r\n            baseData: FieldType.Required\r\n        }\r\n\r\n        /**\r\n         * Constructs a new instance of telemetry data.\r\n         */\r\n        constructor(type: string, data: TDomain) {\r\n            super();\r\n\r\n            this.baseType = type;\r\n            this.baseData = data;\r\n        }\r\n    }\r\n}","/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/PageViewData.ts\" />\r\n/// <reference path=\"./Common/DataSanitizer.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    /**\r\n    * Class encapsulates sending page views and page view performance telemetry.\r\n    */\r\n    export class PageViewManager {\r\n        private pageViewPerformanceSent: boolean = false;\r\n\r\n        private overridePageViewDuration: boolean = false;\r\n\r\n        private appInsights: IAppInsightsInternal;\r\n\r\n        constructor(\r\n            appInsights: IAppInsightsInternal,\r\n            overridePageViewDuration: boolean) {\r\n            this.overridePageViewDuration = overridePageViewDuration;\r\n            this.appInsights = appInsights;\r\n        }\r\n\r\n        /**\r\n        * Currently supported cases:\r\n        * 1) (default case) track page view called with default parameters, overridePageViewDuration = false. Page view is sent with page view performance when navigation timing data is available.\r\n        *    If navigation timing is not supported then page view is sent right away with undefined duration. Page view performance is not sent.\r\n        * 2) overridePageViewDuration = true, custom duration provided. Custom duration is used, page view sends right away.\r\n        * 3) overridePageViewDuration = true. Page view is sent right away, duration is time spent from page load till now (or undefined if navigation timing is not supported). \r\n        * 4) overridePageViewDuration = false, custom duration is provided. Page view is sent right away with custom duration. \r\n        *\r\n        * In all cases page view performance is sent once (only for the 1st call of trackPageView), or not sent if navigation timing is not supported.\r\n        */\r\n        public trackPageView(name?: string, url?: string, properties?: Object, measurements?: Object, duration?: number) {\r\n            // ensure we have valid values for the required fields\r\n            if (typeof name !== \"string\") {\r\n                name = window.document && window.document.title || \"\";\r\n            }\r\n\r\n            if (typeof url !== \"string\") {\r\n                url = window.location && window.location.href || \"\";\r\n            }\r\n\r\n            var pageViewSent = false;\r\n            var customDuration = undefined;\r\n\r\n            if (Telemetry.PageViewPerformance.isPerformanceTimingSupported()) {\r\n                var start = Telemetry.PageViewPerformance.getPerformanceTiming().navigationStart;\r\n                customDuration = Telemetry.PageViewPerformance.getDuration(start, +new Date);\r\n\r\n                if (!Telemetry.PageViewPerformance.shouldCollectDuration(customDuration)) {\r\n                    customDuration = undefined;\r\n                }\r\n            } else {\r\n                this.appInsights.sendPageViewInternal(\r\n                    name,\r\n                    url,\r\n                    !isNaN(duration) ? duration : undefined,\r\n                    properties,\r\n                    measurements);\r\n                this.appInsights.flush();\r\n                pageViewSent = true;\r\n            }\r\n\r\n            if (!pageViewSent && (this.overridePageViewDuration || !isNaN(duration))) {\r\n                // 1, 2, 4 cases\r\n                this.appInsights.sendPageViewInternal(\r\n                    name,\r\n                    url,\r\n                    !isNaN(duration) ? duration : customDuration,\r\n                    properties,\r\n                    measurements);\r\n                this.appInsights.flush();\r\n                pageViewSent = true;\r\n            }\r\n\r\n            var maxDurationLimit = 60000;\r\n\r\n            if (!Telemetry.PageViewPerformance.isPerformanceTimingSupported()) {\r\n                // no navigation timing (IE 8, iOS Safari 8.4, Opera Mini 8 - see http://caniuse.com/#feat=nav-timing)\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING,\r\n                    _InternalMessageId.NavigationTimingNotSupported,\r\n                    \"trackPageView: navigation timing API used for calculation of page duration is not supported in this browser. This page view will be collected without duration and timing info.\");\r\n                return;\r\n            }\r\n\r\n            var handle = setInterval(() => {\r\n                try {\r\n                    if (Telemetry.PageViewPerformance.isPerformanceTimingDataReady()) {\r\n                        clearInterval(handle);\r\n                        var pageViewPerformance = new Telemetry.PageViewPerformance(name, url, null, properties, measurements);\r\n\r\n                        if (!pageViewPerformance.getIsValid() && !pageViewSent) {\r\n                            // If navigation timing gives invalid numbers, then go back to \"override page view duration\" mode.\r\n                            // That's the best value we can get that makes sense.\r\n                            this.appInsights.sendPageViewInternal(name, url, customDuration, properties, measurements);\r\n                            this.appInsights.flush();\r\n                        } else {\r\n                            if (!pageViewSent) {\r\n                                this.appInsights.sendPageViewInternal(name, url, pageViewPerformance.getDurationMs(), properties, measurements);\r\n                            }\r\n\r\n                            if (!this.pageViewPerformanceSent) {\r\n                                this.appInsights.sendPageViewPerformanceInternal(pageViewPerformance);\r\n                                this.pageViewPerformanceSent = true;\r\n                            }\r\n                            this.appInsights.flush();\r\n                        }\r\n                    }\r\n                    else if (Telemetry.PageViewPerformance.getDuration(start, +new Date) > maxDurationLimit) {\r\n                        clearInterval(handle);\r\n                        if (!pageViewSent) {\r\n                            this.appInsights.sendPageViewInternal(name, url, maxDurationLimit, properties, measurements);\r\n                            this.appInsights.flush();\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    _InternalLogging.throwInternal(\r\n                        LoggingSeverity.CRITICAL,\r\n                        _InternalMessageId.TrackPVFailedCalc,\r\n                        \"trackPageView failed on page load calculation: \" + Util.getExceptionName(e),\r\n                        { exception: Util.dump(e) });\r\n                }\r\n            }, 100);\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../AppInsights.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Used to track page visit durations\r\n     */\r\n    export class PageVisitTimeManager {\r\n\r\n        private prevPageVisitDataKeyName: string = \"prevPageVisitData\";\r\n        private pageVisitTimeTrackingHandler: (pageName: string, pageUrl: string, pageVisitTime: number) => void;\r\n\r\n        /**\r\n         * Creates a new instance of PageVisitTimeManager\r\n         * @param pageVisitTimeTrackingHandler Delegate that will be called to send telemetry data to AI (when trackPreviousPageVisit is called)\r\n         * @returns {} \r\n         */\r\n        constructor(pageVisitTimeTrackingHandler: (pageName: string, pageUrl: string, pageVisitTime: number) => void) {\r\n            this.pageVisitTimeTrackingHandler = pageVisitTimeTrackingHandler;\r\n        }\r\n\r\n         /**\r\n         * Tracks the previous page visit time telemetry (if exists) and starts timing of new page visit time\r\n         * @param currentPageName Name of page to begin timing for visit duration\r\n         * @param currentPageUrl Url of page to begin timing for visit duration\r\n         */\r\n        public trackPreviousPageVisit(currentPageName: string, currentPageUrl: string) {\r\n            \r\n            try {\r\n                // Restart timer for new page view\r\n                var prevPageVisitTimeData = this.restartPageVisitTimer(currentPageName, currentPageUrl);\r\n                \r\n                // If there was a page already being timed, track the visit time for it now.\r\n                if (prevPageVisitTimeData) {\r\n                    this.pageVisitTimeTrackingHandler(prevPageVisitTimeData.pageName, prevPageVisitTimeData.pageUrl, prevPageVisitTimeData.pageVisitTime);\r\n                }\r\n            } catch (e) {\r\n                _InternalLogging.warnToConsole(\"Auto track page visit time failed, metric will not be collected: \" + Util.dump(e));\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Stops timing of current page (if exists) and starts timing for duration of visit to pageName\r\n         * @param pageName Name of page to begin timing visit duration\r\n         * @returns {PageVisitData} Page visit data (including duration) of pageName from last call to start or restart, if exists. Null if not. \r\n         */\r\n        public restartPageVisitTimer(pageName: string, pageUrl: string) {\r\n            try {\r\n                var prevPageVisitData = this.stopPageVisitTimer();\r\n                this.startPageVisitTimer(pageName, pageUrl);\r\n\r\n                return prevPageVisitData;\r\n            } catch (e) {\r\n                _InternalLogging.warnToConsole(\"Call to restart failed: \" + Util.dump(e));\r\n                return null;\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Starts timing visit duration of pageName\r\n         * @param pageName \r\n         * @returns {} \r\n         */\r\n        public startPageVisitTimer(pageName: string, pageUrl: string) {\r\n            try {\r\n                if (Util.canUseSessionStorage()) {\r\n                    if (Util.getSessionStorage(this.prevPageVisitDataKeyName) != null) {\r\n                        throw new Error(\"Cannot call startPageVisit consecutively without first calling stopPageVisit\");\r\n                    }\r\n\r\n                    var currPageVisitData = new PageVisitData(pageName, pageUrl);\r\n                    var currPageVisitDataStr = JSON.stringify(currPageVisitData);\r\n                    Util.setSessionStorage(this.prevPageVisitDataKeyName, currPageVisitDataStr);\r\n                }\r\n            } catch (e) {\r\n                //TODO: Remove this catch in next phase, since if start is called twice in a row the exception needs to be propagated out\r\n                _InternalLogging.warnToConsole(\"Call to start failed: \" + Util.dump(e));\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Stops timing of current page, if exists.\r\n         * @returns {PageVisitData} Page visit data (including duration) of pageName from call to start, if exists. Null if not.  \r\n         */\r\n        public stopPageVisitTimer() {\r\n            try {\r\n                if (Util.canUseSessionStorage()) {\r\n\r\n                    // Define end time of page's visit\r\n                    var pageVisitEndTime = Date.now();\r\n\r\n                    // Try to retrieve  page name and start time from session storage\r\n                    var pageVisitDataJsonStr = Util.getSessionStorage(this.prevPageVisitDataKeyName);\r\n                    if (pageVisitDataJsonStr) {\r\n\r\n                        // if previous page data exists, set end time of visit\r\n                        var prevPageVisitData: PageVisitData = JSON.parse(pageVisitDataJsonStr);\r\n                        prevPageVisitData.pageVisitTime = pageVisitEndTime - prevPageVisitData.pageVisitStartTime;\r\n\r\n                        // Remove data from storage since we already used it\r\n                        Util.removeSessionStorage(this.prevPageVisitDataKeyName);\r\n\r\n                        // Return page visit data\r\n                        return prevPageVisitData;\r\n                    } else {\r\n                        return null;\r\n                    }\r\n\r\n                }\r\n                return null;\r\n            } catch (e) {\r\n                _InternalLogging.warnToConsole(\"Stop page visit timer failed: \" + Util.dump(e));\r\n                return null\r\n            }\r\n        }\r\n    }\r\n\r\n    export class PageVisitData {\r\n\r\n        public pageName: string;\r\n        public pageUrl: string;\r\n        public pageVisitStartTime: number;\r\n        public pageVisitTime: number;\r\n\r\n        constructor(pageName, pageUrl) {\r\n            this.pageVisitStartTime = Date.now();\r\n            this.pageName = pageName;\r\n            this.pageUrl = pageUrl;\r\n        }\r\n    }\r\n}","// THIS TYPE WAS AUTOGENERATED\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export enum DependencyKind\r\n    {\r\n        SQL = 0,\r\n        Http = 1,\r\n        Other = 2,\r\n    }\r\n}\r\n","// THIS TYPE WAS AUTOGENERATED\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export enum DependencySourceType\r\n    {\r\n        Undefined = 0,\r\n        Aic = 1,\r\n        Apmc = 2,\r\n    }\r\n}\r\n","// THIS TYPE WAS AUTOGENERATED\r\n/// <reference path=\"Domain.ts\" />\r\n/// <reference path=\"DataPointType.ts\" />\r\n/// <reference path=\"DependencyKind.ts\" />\r\n/// <reference path=\"DependencySourceType.ts\" />\r\nmodule AI\r\n{\r\n\"use strict\";\r\n    export class RemoteDependencyData extends Microsoft.Telemetry.Domain\r\n    {\r\n        public ver: number;\r\n        public name: string;\r\n        public id: string;\r\n        public resultCode: string;\r\n        public duration: string;\r\n        public success: boolean;\r\n        public data: string;\r\n        public target: string;\r\n        public type: string;\r\n        public properties: any;\r\n        public measurements: any;\r\n\r\n        /* Following fields should be marked as depricated in the next release, and must be removed in the subsequent breaking release */\r\n        public kind: AI.DataPointType;\r\n        public value: number;\r\n        public count: number;\r\n        public min: number;\r\n        public max: number;\r\n        public stdDev: number;\r\n        public dependencyKind: AI.DependencyKind;\r\n        public async: boolean;\r\n        public dependencySource: AI.DependencySourceType;\r\n        public commandName: string;\r\n        public dependencyTypeName: string;\r\n\r\n        constructor()\r\n        {\r\n            super();\r\n\r\n            this.ver = 2;\r\n            this.kind = AI.DataPointType.Aggregation;\r\n            this.dependencyKind = AI.DependencyKind.Other;\r\n            this.success = true;\r\n            this.dependencySource = AI.DependencySourceType.Apmc;\r\n            this.properties = {};\r\n            this.measurements = {};\r\n            \r\n            super();\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"../../JavaScriptSDK.Interfaces/Telemetry/ISerializable.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/PageViewData.ts\" />\r\n/// <reference path=\"../../JavaScriptSDK.Interfaces/Contracts/Generated/RemoteDependencyData.ts\"/>\r\n/// <reference path=\"./Common/DataSanitizer.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights.Telemetry {\r\n    \"use strict\";\r\n\r\n    export class RemoteDependencyData extends AI.RemoteDependencyData implements ISerializable {\r\n\r\n        public static envelopeType = \"Microsoft.ApplicationInsights.{0}.RemoteDependency\";\r\n        public static dataType = \"RemoteDependencyData\";\r\n\r\n        public aiDataContract = {\r\n            id: FieldType.Required,\r\n            ver: FieldType.Required,\r\n            name: FieldType.Default,\r\n            resultCode: FieldType.Default,\r\n            duration: FieldType.Default,\r\n            success: FieldType.Default,\r\n            data: FieldType.Default,\r\n            target: FieldType.Default,\r\n            type: FieldType.Default,\r\n            properties: FieldType.Default,\r\n            measurements: FieldType.Default,\r\n\r\n            kind: FieldType.Default,\r\n            value: FieldType.Default,\r\n            count: FieldType.Default,\r\n            min: FieldType.Default,\r\n            max: FieldType.Default,\r\n            stdDev: FieldType.Default,\r\n            dependencyKind: FieldType.Default,\r\n            async: FieldType.Default,\r\n            dependencySource: FieldType.Default,\r\n            commandName: FieldType.Default,\r\n            dependencyTypeName: FieldType.Default,\r\n        }\r\n\r\n        /**\r\n         * Constructs a new instance of the RemoteDependencyData object\r\n         */\r\n        constructor(id: string, absoluteUrl: string, commandName: string, value: number, success: boolean, resultCode: number, method?: string, properties?: Object, measurements?: Object) {\r\n            super();\r\n\r\n            this.id = id;\r\n\r\n            this.duration = Util.msToTimeSpan(value);\r\n            this.success = success;  \r\n            this.resultCode = resultCode + \"\";\r\n            this.dependencyKind = AI.DependencyKind.Http;\r\n\r\n            this.type = \"Ajax\";\r\n            this.data = Common.DataSanitizer.sanitizeUrl(commandName);\r\n\r\n            if (absoluteUrl && absoluteUrl.length > 0) {\r\n                var parsedUrl: HTMLAnchorElement = UrlHelper.parseUrl(absoluteUrl)\r\n                this.target = parsedUrl.host;\r\n                if (parsedUrl.pathname != null) {\r\n                    var pathName: string = (parsedUrl.pathname.length === 0) ? \"/\" : parsedUrl.pathname;\r\n                    if (pathName.charAt(0) !== '/') {\r\n                        pathName = \"/\" + pathName;\r\n                    }\r\n\r\n                    this.name = Common.DataSanitizer.sanitizeString(method ? method + \" \" + pathName : pathName);\r\n                } else {\r\n                    this.name = Common.DataSanitizer.sanitizeString(absoluteUrl);\r\n                }\r\n            } else {\r\n                this.target = commandName;\r\n                this.name = commandName;\r\n            }\r\n\r\n            this.properties = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeProperties(properties);\r\n            this.measurements = ApplicationInsights.Telemetry.Common.DataSanitizer.sanitizeMeasurements(measurements);\r\n        }\r\n    }\r\n}","/// <reference path=\"./HashCodeScoreGenerator.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n \r\n    // Class allows to perform split testing (aka 'a/b testing' aka 'flights')\r\n    // Works similarly to sampling, using the same hashing algorithm under the hood.\r\n    // Suggested use:\r\n    //\r\n    //   newShinyFeature.enabled = false;\r\n    //   if (new SplitTest.isEnabled(<user id>, <percent of users to enable feature for>)){\r\n    //     newShinyFeature.enabled = true;\r\n    //   }\r\n    //\r\n    export class SplitTest {\r\n        private hashCodeGeneragor: HashCodeScoreGenerator = new HashCodeScoreGenerator();\r\n\r\n        public isEnabled(key: string, percentEnabled: number) {\r\n            return this.hashCodeGeneragor.getHashCodeScore(key) < percentEnabled;\r\n        }\r\n    }\r\n}","/// <reference path=\"TelemetryContext.ts\" />\r\n/// <reference path=\"./Telemetry/Common/Data.ts\"/>\r\n/// <reference path=\"./Util.ts\"/>\r\n/// <reference path=\"../JavaScriptSDK.Interfaces/Contracts/Generated/SessionState.ts\"/>\r\n/// <reference path=\"./Telemetry/PageViewManager.ts\"/>\r\n/// <reference path=\"./Telemetry/PageVisitTimeManager.ts\"/>\r\n/// <reference path=\"./Telemetry/RemoteDependencyData.ts\"/>\r\n/// <reference path=\"./ajax/ajax.ts\"/>\r\n/// <reference path=\"./SplitTest.ts\"/>\r\n/// <reference path=\"../JavaScriptSDK.Interfaces/IAppInsights.ts\"/>\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n\r\n    \"use strict\";\r\n\r\n    export var Version = \"1.0.12\";\r\n\r\n    /**\r\n    * Internal interface to pass appInsights object to subcomponents without coupling \r\n    */\r\n    export interface IAppInsightsInternal {\r\n        sendPageViewInternal(name?: string, url?: string, duration?: number, properties?: Object, measurements?: Object);\r\n        sendPageViewPerformanceInternal(pageViewPerformance: ApplicationInsights.Telemetry.PageViewPerformance);\r\n        flush();\r\n    }\r\n\r\n    /**\r\n     * The main API that sends telemetry to Application Insights.\r\n     * Learn more: http://go.microsoft.com/fwlink/?LinkID=401493\r\n     */\r\n    export class AppInsights implements IAppInsightsInternal, IAppInsights {\r\n\r\n        // Counts number of trackAjax invokations.\r\n        // By default we only monitor X ajax call per view to avoid too much load.\r\n        // Default value is set in config.\r\n        // This counter keeps increasing even after the limit is reached.\r\n        private _trackAjaxAttempts: number = 0;\r\n\r\n        private _eventTracking: Timing;\r\n        private _pageTracking: Timing;\r\n        private _pageViewManager: Microsoft.ApplicationInsights.Telemetry.PageViewManager;\r\n        private _pageVisitTimeManager: Microsoft.ApplicationInsights.Telemetry.PageVisitTimeManager;\r\n        private _ajaxMonitor: Microsoft.ApplicationInsights.AjaxMonitor;\r\n\r\n        public config: IConfig;\r\n        public context: TelemetryContext;\r\n        public queue: (() => void)[];\r\n        public static defaultConfig: IConfig;\r\n\r\n        constructor(config: IConfig) {\r\n            this.config = config || <IConfig>{};\r\n\r\n            // load default values if specified\r\n            var defaults: IConfig = AppInsights.defaultConfig;\r\n            if (defaults !== undefined) {\r\n                for (var field in defaults) {\r\n                    // for each unspecified field, set the default value\r\n                    if (this.config[field] === undefined) {\r\n                        this.config[field] = defaults[field];\r\n                    }\r\n                }\r\n            }\r\n\r\n            _InternalLogging.verboseLogging = () => this.config.verboseLogging;\r\n            _InternalLogging.enableDebugExceptions = () => this.config.enableDebug;\r\n            var configGetters: ApplicationInsights.ITelemetryConfig = {\r\n                instrumentationKey: () => this.config.instrumentationKey,\r\n                accountId: () => this.config.accountId,\r\n                sessionRenewalMs: () => this.config.sessionRenewalMs,\r\n                sessionExpirationMs: () => this.config.sessionExpirationMs,\r\n                endpointUrl: () => this.config.endpointUrl,\r\n                emitLineDelimitedJson: () => this.config.emitLineDelimitedJson,\r\n                maxBatchSizeInBytes: () => {\r\n                    return (!this.config.isBeaconApiDisabled && Util.IsBeaconApiSupported()) ?\r\n                        Math.min(this.config.maxBatchSizeInBytes, Sender.MaxBeaconPayloadSize) :\r\n                        this.config.maxBatchSizeInBytes;\r\n                },\r\n                maxBatchInterval: () => this.config.maxBatchInterval,\r\n                disableTelemetry: () => this.config.disableTelemetry,\r\n                sampleRate: () => this.config.samplingPercentage,\r\n                cookieDomain: () => this.config.cookieDomain,\r\n                enableSessionStorageBuffer: () => {\r\n                    // Disable Session Storage buffer if telemetry is sent using Beacon API\r\n                    return ((this.config.isBeaconApiDisabled || !Util.IsBeaconApiSupported()) && this.config.enableSessionStorageBuffer);\r\n                },\r\n                isRetryDisabled: () => this.config.isRetryDisabled,\r\n                isBeaconApiDisabled: () => this.config.isBeaconApiDisabled,\r\n                sdkExtension: () => this.config.sdkExtension,\r\n                isBrowserLinkTrackingEnabled: () => this.config.isBrowserLinkTrackingEnabled\r\n            }\r\n\r\n            if (this.config.isCookieUseDisabled) {\r\n                Util.disableCookies();\r\n            }\r\n\r\n            if (this.config.isStorageUseDisabled) {\r\n                Util.disableStorage();\r\n            }\r\n\r\n            this.context = new ApplicationInsights.TelemetryContext(configGetters);\r\n\r\n            this._pageViewManager = new Microsoft.ApplicationInsights.Telemetry.PageViewManager(this, this.config.overridePageViewDuration);\r\n\r\n            // initialize event timing\r\n            this._eventTracking = new Timing(\"trackEvent\");\r\n            this._eventTracking.action = (name?: string, url?: string, duration?: number, properties?: Object, measurements?: Object) => {\r\n                if (!measurements) {\r\n                    measurements = { duration: duration };\r\n                }\r\n                else {\r\n                    // do not override existing duration value\r\n                    if (isNaN(measurements[\"duration\"])) {\r\n                        measurements[\"duration\"] = duration;\r\n                    }\r\n                }\r\n                var event = new Telemetry.Event(name, properties, measurements);\r\n                var data = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.Event>(Telemetry.Event.dataType, event);\r\n                var envelope = new Telemetry.Common.Envelope(data, Telemetry.Event.envelopeType);\r\n\r\n                this.context.track(envelope);\r\n            }\r\n\r\n            // initialize page view timing\r\n            this._pageTracking = new Timing(\"trackPageView\");\r\n            this._pageTracking.action = (name, url, duration, properties, measurements) => {\r\n                this.sendPageViewInternal(name, url, duration, properties, measurements);\r\n            }\r\n\r\n            this._pageVisitTimeManager = new ApplicationInsights.Telemetry.PageVisitTimeManager(\r\n                (pageName, pageUrl, pageVisitTime) => this.trackPageVisitTime(pageName, pageUrl, pageVisitTime));\r\n\r\n            if (!this.config.disableAjaxTracking) {\r\n                this._ajaxMonitor = new Microsoft.ApplicationInsights.AjaxMonitor(this);\r\n            }\r\n        }\r\n\r\n        public sendPageViewInternal(name?: string, url?: string, duration?: number, properties?: Object, measurements?: Object) {\r\n            var pageView = new Telemetry.PageView(name, url, duration, properties, measurements);\r\n            var data = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.PageView>(Telemetry.PageView.dataType, pageView);\r\n            var envelope = new Telemetry.Common.Envelope(data, Telemetry.PageView.envelopeType);\r\n\r\n            this.context.track(envelope);\r\n\r\n            // reset ajaxes counter\r\n            this._trackAjaxAttempts = 0;\r\n        }\r\n\r\n        public sendPageViewPerformanceInternal(pageViewPerformance: ApplicationInsights.Telemetry.PageViewPerformance) {\r\n            var pageViewPerformanceData = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.PageViewPerformance>(\r\n                Telemetry.PageViewPerformance.dataType, pageViewPerformance);\r\n            var pageViewPerformanceEnvelope = new Telemetry.Common.Envelope(pageViewPerformanceData, Telemetry.PageViewPerformance.envelopeType);\r\n            this.context.track(pageViewPerformanceEnvelope);\r\n        }\r\n\r\n        /**\r\n         * Starts timing how long the user views a page or other item. Call this when the page opens. \r\n         * This method doesn't send any telemetry. Call {@link stopTrackTelemetry} to log the page when it closes.\r\n         * @param   name  A string that idenfities this item, unique within this HTML document. Defaults to the document title.\r\n         */\r\n        public startTrackPage(name?: string) {\r\n            try {\r\n                if (typeof name !== \"string\") {\r\n                    name = window.document && window.document.title || \"\";\r\n                }\r\n\r\n                this._pageTracking.start(name);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.StartTrackFailed,\r\n                    \"startTrackPage failed, page view may not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Logs how long a page or other item was visible, after {@link startTrackPage}. Call this when the page closes. \r\n         * @param   name  The string you used as the name in startTrackPage. Defaults to the document title.\r\n         * @param   url   String - a relative or absolute URL that identifies the page or other item. Defaults to the window location.\r\n         * @param   properties  map[string, string] - additional data used to filter pages and metrics in the portal. Defaults to empty.\r\n         * @param   measurements    map[string, number] - metrics associated with this page, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         */\r\n        public stopTrackPage(name?: string, url?: string, properties?: Object, measurements?: Object) {\r\n            try {\r\n                if (typeof name !== \"string\") {\r\n                    name = window.document && window.document.title || \"\";\r\n                }\r\n\r\n                if (typeof url !== \"string\") {\r\n                    url = window.location && window.location.href || \"\";\r\n                }\r\n\r\n                this._pageTracking.stop(name, url, properties, measurements);\r\n\r\n                if (this.config.autoTrackPageVisitTime) {\r\n                    this._pageVisitTimeManager.trackPreviousPageVisit(name, url);\r\n                }\r\n\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.StopTrackFailed,\r\n                    \"stopTrackPage failed, page view will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Logs that a page or other item was viewed. \r\n         * @param   name  The string you used as the name in startTrackPage. Defaults to the document title.\r\n         * @param   url   String - a relative or absolute URL that identifies the page or other item. Defaults to the window location.\r\n         * @param   properties  map[string, string] - additional data used to filter pages and metrics in the portal. Defaults to empty.\r\n         * @param   measurements    map[string, number] - metrics associated with this page, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         * @param   duration    number - the number of milliseconds it took to load the page. Defaults to undefined. If set to default value, page load time is calculated internally.\r\n         */\r\n        public trackPageView(name?: string, url?: string, properties?: Object, measurements?: Object, duration?: number) {\r\n            try {\r\n                this._pageViewManager.trackPageView(name, url, properties, measurements, duration);\r\n\r\n                if (this.config.autoTrackPageVisitTime) {\r\n                    this._pageVisitTimeManager.trackPreviousPageVisit(name, url);\r\n                }\r\n\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.TrackPVFailed,\r\n                    \"trackPageView failed, page view will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Start timing an extended event. Call {@link stopTrackEvent} to log the event when it ends.\r\n         * @param   name    A string that identifies this event uniquely within the document.\r\n         */\r\n        public startTrackEvent(name: string) {\r\n            try {\r\n                this._eventTracking.start(name);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.StartTrackEventFailed,\r\n                    \"startTrackEvent failed, event will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /** \r\n         * Log an extended event that you started timing with {@link startTrackEvent}.\r\n         * @param   name    The string you used to identify this event in startTrackEvent.\r\n         * @param   properties  map[string, string] - additional data used to filter events and metrics in the portal. Defaults to empty.\r\n         * @param   measurements    map[string, number] - metrics associated with this event, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         */\r\n        public stopTrackEvent(name: string, properties?: Object, measurements?: Object) {\r\n            try {\r\n                this._eventTracking.stop(name, undefined, properties, measurements);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.StopTrackEventFailed,\r\n                    \"stopTrackEvent failed, event will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /** \r\n         * Log a user action or other occurrence.\r\n         * @param   name    A string to identify this event in the portal.\r\n         * @param   properties  map[string, string] - additional data used to filter events and metrics in the portal. Defaults to empty.\r\n         * @param   measurements    map[string, number] - metrics associated with this event, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         */\r\n        public trackEvent(name: string, properties?: Object, measurements?: Object) {\r\n            try {\r\n                var eventTelemetry = new Telemetry.Event(name, properties, measurements);\r\n                var data = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.Event>(Telemetry.Event.dataType, eventTelemetry);\r\n                var envelope = new Telemetry.Common.Envelope(data, Telemetry.Event.envelopeType);\r\n                this.context.track(envelope);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.TrackEventFailed,\r\n                    \"trackEvent failed, event will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Log a dependency call\r\n         * @param id    unique id, this is used by the backend o correlate server requests. Use Util.newId() to generate a unique Id.\r\n         * @param method    represents request verb (GET, POST, etc.)\r\n         * @param absoluteUrl   absolute url used to make the dependency request\r\n         * @param pathName  the path part of the absolute url\r\n         * @param totalTime total request time\r\n         * @param success   indicates if the request was sessessful\r\n         * @param resultCode    response code returned by the dependency request\r\n         * @param properties    map[string, string] - additional data used to filter events and metrics in the portal. Defaults to empty.\r\n         * @param measurements  map[string, number] - metrics associated with this event, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         */\r\n        public trackDependency(id: string, method: string, absoluteUrl: string, pathName: string, totalTime: number, success: boolean, resultCode: number, properties?: Object, measurements?: Object) {\r\n            if (this.config.maxAjaxCallsPerView === -1 ||\r\n                this._trackAjaxAttempts < this.config.maxAjaxCallsPerView) {\r\n                var dependency = new Telemetry.RemoteDependencyData(id, absoluteUrl, pathName, totalTime, success, resultCode, method, properties, measurements);\r\n                var dependencyData = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.RemoteDependencyData>(\r\n                    Telemetry.RemoteDependencyData.dataType, dependency);\r\n                var envelope = new Telemetry.Common.Envelope(dependencyData, ApplicationInsights.Telemetry.RemoteDependencyData.envelopeType);\r\n                this.context.track(envelope);\r\n            } else if (this._trackAjaxAttempts === this.config.maxAjaxCallsPerView) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.MaxAjaxPerPVExceeded,\r\n                    \"Maximum ajax per page view limit reached, ajax monitoring is paused until the next trackPageView(). In order to increase the limit set the maxAjaxCallsPerView configuration parameter.\",\r\n                    true);\r\n            }\r\n\r\n            ++this._trackAjaxAttempts;\r\n        }\r\n\r\n        /**\r\n         * trackAjax method is obsolete, use trackDependency instead\r\n         */\r\n        public trackAjax(id: string, absoluteUrl: string, pathName: string, totalTime: number, success: boolean, resultCode: number, method?: string) {\r\n            this.trackDependency(id, null, absoluteUrl, pathName, totalTime, success, resultCode);\r\n        }\r\n\r\n        /**\r\n         * Log an exception you have caught.\r\n         * @param   exception   An Error from a catch clause, or the string error message.\r\n         * @param   properties  map[string, string] - additional data used to filter events and metrics in the portal. Defaults to empty.\r\n         * @param   measurements    map[string, number] - metrics associated with this event, displayed in Metrics Explorer on the portal. Defaults to empty.\r\n         * @param   severityLevel   AI.SeverityLevel - severity level\r\n         */\r\n        public trackException(exception: Error, handledAt?: string, properties?: Object, measurements?: Object, severityLevel?: AI.SeverityLevel) {\r\n            try {\r\n                if (!Util.isError(exception)) {\r\n                    // ensure that we have an error object (user could pass a string/message)\r\n                    try {\r\n                        throw new Error(<any>exception);\r\n                    } catch (error) {\r\n                        exception = error;\r\n                    }\r\n                }\r\n\r\n                var exceptionTelemetry = new Telemetry.Exception(exception, handledAt, properties, measurements, severityLevel);\r\n                var data = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.Exception>(Telemetry.Exception.dataType, exceptionTelemetry);\r\n                var envelope = new Telemetry.Common.Envelope(data, Telemetry.Exception.envelopeType);\r\n                this.context.track(envelope);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.TrackExceptionFailed,\r\n                    \"trackException failed, exception will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Log a numeric value that is not associated with a specific event. Typically used to send regular reports of performance indicators.\r\n         * To send a single measurement, use just the first two parameters. If you take measurements very frequently, you can reduce the \r\n         * telemetry bandwidth by aggregating multiple measurements and sending the resulting average at intervals.\r\n         * @param   name    A string that identifies the metric.\r\n         * @param   average Number representing either a single measurement, or the average of several measurements.\r\n         * @param   sampleCount The number of measurements represented by the average. Defaults to 1.\r\n         * @param   min The smallest measurement in the sample. Defaults to the average.\r\n         * @param   max The largest measurement in the sample. Defaults to the average.\r\n         */\r\n        public trackMetric(name: string, average: number, sampleCount?: number, min?: number, max?: number, properties?: Object) {\r\n            try {\r\n                var telemetry = new Telemetry.Metric(name, average, sampleCount, min, max, properties);\r\n                var data = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.Metric>(Telemetry.Metric.dataType, telemetry);\r\n                var envelope = new Telemetry.Common.Envelope(data, Telemetry.Metric.envelopeType);\r\n\r\n                this.context.track(envelope);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.TrackMetricFailed,\r\n                    \"trackMetric failed, metric will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n        * Log a diagnostic message. \r\n        * @param   message A message string \r\n        * @param   properties  map[string, string] - additional data used to filter traces in the portal. Defaults to empty.\r\n        * @param   severityLevel   AI.SeverityLevel - severity level\r\n        */\r\n        public trackTrace(message: string, properties?: Object, severityLevel?: AI.SeverityLevel) {\r\n            try {\r\n                var telemetry = new Telemetry.Trace(message, properties, severityLevel);\r\n                var data = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.Trace>(Telemetry.Trace.dataType, telemetry);\r\n                var envelope = new Telemetry.Common.Envelope(data, Telemetry.Trace.envelopeType);\r\n\r\n                this.context.track(envelope);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.WARNING,\r\n                    _InternalMessageId.TrackTraceFailed,\r\n                    \"trackTrace failed, trace will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n       * Log a page visit time\r\n       * @param    pageName    Name of page\r\n       * @param    pageVisitDuration Duration of visit to the page in milleseconds\r\n       */\r\n        private trackPageVisitTime(pageName: string, pageUrl: string, pageVisitTime: number) {\r\n            var properties = { PageName: pageName, PageUrl: pageUrl };\r\n            this.trackMetric(\"PageVisitTime\", pageVisitTime, 1, pageVisitTime, pageVisitTime, properties);\r\n        }\r\n\r\n        /**\r\n         * Immediately send all queued telemetry.\r\n         * @param {boolean} async - If flush should be call asynchronously\r\n         */\r\n        public flush(async = true) {\r\n            try {\r\n                this.context._sender.triggerSend(async);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.FlushFailed,\r\n                    \"flush failed, telemetry will not be collected: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Sets the autheticated user id and the account id in this session.\r\n         * User auth id and account id should be of type string. They should not contain commas, semi-colons, equal signs, spaces, or vertical-bars.\r\n         *   \r\n         * @param authenticatedUserId {string} - The authenticated user id. A unique and persistent string that represents each authenticated user in the service.\r\n         * @param accountId {string} - An optional string to represent the account associated with the authenticated user.\r\n         */\r\n        public setAuthenticatedUserContext(authenticatedUserId: string, accountId?: string) {\r\n            try {\r\n                this.context.user.setAuthenticatedUserContext(authenticatedUserId, accountId);\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.WARNING,\r\n                    _InternalMessageId.SetAuthContextFailed,\r\n                    \"Setting auth user context failed. \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) },\r\n                    true);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Clears the authenticated user id and the account id from the user context.\r\n         */\r\n        public clearAuthenticatedUserContext() {\r\n            try {\r\n                this.context.user.clearAuthenticatedUserContext();\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(LoggingSeverity.WARNING,\r\n                    _InternalMessageId.SetAuthContextFailed,\r\n                    \"Clearing auth user context failed. \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) },\r\n                    true);\r\n            }\r\n        }\r\n\r\n        /**\r\n        * In case of CORS exceptions - construct an exception manually.\r\n        * See this for more info: http://stackoverflow.com/questions/5913978/cryptic-script-error-reported-in-javascript-in-chrome-and-firefox\r\n        */\r\n        private SendCORSException(properties: any) {\r\n            var exceptionData = Microsoft.ApplicationInsights.Telemetry.Exception.CreateSimpleException(\r\n                \"Script error.\",\r\n                \"Error\", \"unknown\", \"unknown\",\r\n                \"The browser's same-origin policy prevents us from getting the details of this exception. Consider using 'crossorigin' attribute.\",\r\n                0, null);\r\n            exceptionData.properties = properties;\r\n\r\n            var data = new ApplicationInsights.Telemetry.Common.Data<ApplicationInsights.Telemetry.Exception>(Telemetry.Exception.dataType, exceptionData);\r\n            var envelope = new Telemetry.Common.Envelope(data, Telemetry.Exception.envelopeType);\r\n            this.context.track(envelope);\r\n        }\r\n\r\n        /**\r\n         * The custom error handler for Application Insights\r\n         * @param {string} message - The error message\r\n         * @param {string} url - The url where the error was raised\r\n         * @param {number} lineNumber - The line number where the error was raised\r\n         * @param {number} columnNumber - The column number for the line where the error was raised\r\n         * @param {Error}  error - The Error object\r\n         */\r\n        public _onerror(message: string, url: string, lineNumber: number, columnNumber: number, error: Error) {\r\n            try {\r\n                var properties = { url: url ? url : document.URL };\r\n\r\n                if (Util.isCrossOriginError(message, url, lineNumber, columnNumber, error)) {\r\n                    this.SendCORSException(properties);\r\n                } else {\r\n                    if (!Util.isError(error)) {\r\n                        var stack = \"window.onerror@\" + properties.url + \":\" + lineNumber + \":\" + (columnNumber || 0);\r\n                        error = new Error(message);\r\n                        error[\"stack\"] = stack;\r\n                    }\r\n                    this.trackException(error, null, properties);\r\n                }\r\n            } catch (exception) {\r\n                var errorString =\r\n                    error ? (error.name + \", \" + error.message) : \"null\";\r\n\r\n                var exceptionDump: string = Util.dump(exception);\r\n\r\n                _InternalLogging.throwInternal(LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.ExceptionWhileLoggingError,\r\n                    \"_onerror threw exception while logging error, error will not be collected: \" + Util.getExceptionName(exception),\r\n                    { exception: exceptionDump, errorString: errorString });\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * Used to record timed events and page views.\r\n     */\r\n    class Timing {\r\n        private _name;\r\n        private _action: (ITimingDetail, number) => void;\r\n        private _events: {\r\n            [key: string]: number;\r\n        };\r\n\r\n        constructor(name: string) {\r\n            this._name = name;\r\n            this._events = {};\r\n        }\r\n\r\n        public start(name: string) {\r\n            if (typeof this._events[name] !== \"undefined\") {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING, _InternalMessageId.StartCalledMoreThanOnce, \"start was called more than once for this event without calling stop.\",\r\n                    { name: this._name, key: name }, true);\r\n            }\r\n\r\n            this._events[name] = +new Date;\r\n        }\r\n\r\n        public stop(name: string, url: string, properties?: Object, measurements?: Object) {\r\n            var start = this._events[name];\r\n            if (isNaN(start)) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING, _InternalMessageId.StopCalledWithoutStart, \"stop was called without a corresponding start.\",\r\n                    { name: this._name, key: name }, true);\r\n            } else {\r\n                var end = +new Date;\r\n                var duration = Telemetry.PageViewPerformance.getDuration(start, end);\r\n                this.action(name, url, duration, properties, measurements);\r\n            }\r\n\r\n            delete this._events[name];\r\n            this._events[name] = undefined;\r\n        }\r\n\r\n        public action: (name?: string, url?: string, duration?: number, properties?: Object, measurements?: Object) => void;\r\n    }\r\n}\r\n","module Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    /* Data loss analyzer is disabled by default.\r\n     * Uncomment code in Sender, SendBuffer and unit tests if you want to enable it\r\n     */\r\n    export class DataLossAnalyzer {\r\n        static enabled = false;\r\n        static appInsights: Microsoft.ApplicationInsights.AppInsights;\r\n        static issuesReportedForThisSession;\r\n        static itemsRestoredFromSessionBuffer: number = 0;\r\n        static LIMIT_PER_SESSION = 10;\r\n        static ITEMS_QUEUED_KEY = \"AI_itemsQueued\";\r\n        static ISSUES_REPORTED_KEY = \"AI_lossIssuesReported\";\r\n\r\n        static reset() {\r\n            if (DataLossAnalyzer.isEnabled()) {\r\n                Util.setSessionStorage(DataLossAnalyzer.ITEMS_QUEUED_KEY, \"0\");\r\n                Util.setSessionStorage(DataLossAnalyzer.ISSUES_REPORTED_KEY, \"0\");\r\n                DataLossAnalyzer.itemsRestoredFromSessionBuffer = 0;\r\n            }\r\n        }\r\n\r\n        private static isEnabled(): boolean {\r\n            return DataLossAnalyzer.enabled &&\r\n                DataLossAnalyzer.appInsights != null &&\r\n                DataLossAnalyzer.appInsights.context._sender._XMLHttpRequestSupported &&\r\n                Util.canUseSessionStorage()\r\n        }\r\n\r\n        static getIssuesReported(): number {\r\n            var result =\r\n                (!DataLossAnalyzer.isEnabled() || isNaN(+Util.getSessionStorage(DataLossAnalyzer.ISSUES_REPORTED_KEY))) ?\r\n                    0 :\r\n                    +Util.getSessionStorage(DataLossAnalyzer.ISSUES_REPORTED_KEY);\r\n\r\n            return result;\r\n        }\r\n\r\n        static incrementItemsQueued() {\r\n            try {\r\n                if (DataLossAnalyzer.isEnabled()) {\r\n                    var itemsQueued: number = DataLossAnalyzer.getNumberOfLostItems();\r\n                    ++itemsQueued;\r\n                    Util.setSessionStorage(DataLossAnalyzer.ITEMS_QUEUED_KEY, itemsQueued.toString());\r\n                }\r\n            } catch (e) { }\r\n        }\r\n\r\n        static decrementItemsQueued(countOfItemsSentSuccessfully: number) {\r\n            try {\r\n                if (DataLossAnalyzer.isEnabled()) {\r\n                    var itemsQueued: number = DataLossAnalyzer.getNumberOfLostItems();\r\n                    itemsQueued -= countOfItemsSentSuccessfully;\r\n                    if (itemsQueued < 0) itemsQueued = 0;\r\n                    Util.setSessionStorage(DataLossAnalyzer.ITEMS_QUEUED_KEY, itemsQueued.toString());\r\n                }\r\n            } catch (e) { }\r\n        }\r\n\r\n        static getNumberOfLostItems(): number {\r\n            var result: number = 0;\r\n            try {\r\n                if (DataLossAnalyzer.isEnabled()) {\r\n                    result = isNaN(+Util.getSessionStorage(DataLossAnalyzer.ITEMS_QUEUED_KEY)) ?\r\n                        0 :\r\n                        +Util.getSessionStorage(DataLossAnalyzer.ITEMS_QUEUED_KEY);\r\n                }\r\n            } catch (e) {\r\n                result = 0;\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        static reportLostItems() {\r\n            try {\r\n                if (DataLossAnalyzer.isEnabled() &&\r\n                    DataLossAnalyzer.getIssuesReported() < DataLossAnalyzer.LIMIT_PER_SESSION &&\r\n                    DataLossAnalyzer.getNumberOfLostItems() > 0) {\r\n\r\n                    var lostItems = DataLossAnalyzer.getNumberOfLostItems() - DataLossAnalyzer.itemsRestoredFromSessionBuffer;\r\n\r\n                    DataLossAnalyzer.appInsights.trackTrace(\r\n                        \"AI (Internal): Internal report DATALOSS:\\\"\" + lostItems + \"\\\"\",\r\n                        null);\r\n                    DataLossAnalyzer.appInsights.flush();\r\n\r\n                    var issuesReported: number = DataLossAnalyzer.getIssuesReported();\r\n                    ++issuesReported;\r\n                    Util.setSessionStorage(DataLossAnalyzer.ISSUES_REPORTED_KEY, issuesReported.toString());\r\n                }\r\n            } catch (e) {\r\n                _InternalLogging.throwInternal(\r\n                    LoggingSeverity.CRITICAL,\r\n                    _InternalMessageId.FailedToReportDataLoss,\r\n                    \"Failed to report data loss: \" + Util.getExceptionName(e),\r\n                    { exception: Util.dump(e) });\r\n            }\r\n            finally {\r\n                try {\r\n                    DataLossAnalyzer.reset();\r\n                } catch (e) { }\r\n            }\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"AppInsights.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    export interface Snippet {\r\n        queue: Array<() => void>;\r\n        config: IConfig;\r\n    }\r\n\r\n    export class Initialization {\r\n        public snippet: Snippet;\r\n        public config: IConfig;\r\n\r\n        constructor(snippet: Snippet) {\r\n            // initialize the queue and config in case they are undefined\r\n            snippet.queue = snippet.queue || [];\r\n            var config: IConfig = snippet.config || <any>{};\r\n\r\n            // ensure instrumentationKey is specified\r\n            if (config && !config.instrumentationKey) {\r\n                config = <any>snippet;\r\n\r\n                // check for legacy instrumentation key\r\n                if (config[\"iKey\"]) {\r\n                    Microsoft.ApplicationInsights.Version = \"0.10.0.0\";\r\n                    config.instrumentationKey = config[\"iKey\"];\r\n                } else if (config[\"applicationInsightsId\"]) {\r\n                    Microsoft.ApplicationInsights.Version = \"0.7.2.0\";\r\n                    config.instrumentationKey = config[\"applicationInsightsId\"];\r\n                } else {\r\n                    throw new Error(\"Cannot load Application Insights SDK, no instrumentationKey was provided.\");\r\n                }\r\n            }\r\n\r\n            // set default values\r\n            config = Initialization.getDefaultConfig(config);\r\n\r\n            this.snippet = snippet;\r\n            this.config = config;\r\n        }\r\n\r\n        // note: these are split into methods to enable unit tests\r\n        public loadAppInsights() {\r\n\r\n            // initialize global instance of appInsights\r\n            var appInsights = new Microsoft.ApplicationInsights.AppInsights(this.config);\r\n\r\n            // implement legacy version of trackPageView for 0.10<\r\n            if (this.config[\"iKey\"]) {\r\n                var originalTrackPageView = appInsights.trackPageView;\r\n                appInsights.trackPageView = (pagePath?: string, properties?: Object, measurements?: Object) => {\r\n                    originalTrackPageView.apply(appInsights, [null, pagePath, properties, measurements]);\r\n                }\r\n            }\r\n\r\n            // implement legacy pageView interface if it is present in the snippet\r\n            var legacyPageView = \"logPageView\";\r\n            if (typeof this.snippet[legacyPageView] === \"function\") {\r\n                appInsights[legacyPageView] = (pagePath?: string, properties?: Object, measurements?: Object) => {\r\n                    appInsights.trackPageView(null, pagePath, properties, measurements);\r\n                }\r\n            }\r\n\r\n            // implement legacy event interface if it is present in the snippet\r\n            var legacyEvent = \"logEvent\";\r\n            if (typeof this.snippet[legacyEvent] === \"function\") {\r\n                appInsights[legacyEvent] = (name: string, properties?: Object, measurements?: Object) => {\r\n                    appInsights.trackEvent(name, properties, measurements);\r\n                }\r\n            }\r\n\r\n            return appInsights;\r\n        }\r\n\r\n        public emptyQueue() {\r\n\r\n            // call functions that were queued before the main script was loaded\r\n            try {\r\n                if (Microsoft.ApplicationInsights.Util.isArray(this.snippet.queue)) {\r\n                    // note: do not check length in the for-loop conditional in case something goes wrong and the stub methods are not overridden.\r\n                    var length = this.snippet.queue.length;\r\n                    for (var i = 0; i < length; i++) {\r\n                        var call = this.snippet.queue[i];\r\n                        call();\r\n                    }\r\n\r\n                    this.snippet.queue = undefined;\r\n                    delete this.snippet.queue;\r\n                }\r\n            } catch (exception) {\r\n                var properties: any = {};\r\n                if (exception && typeof exception.toString === \"function\") {\r\n                    properties.exception = exception.toString();\r\n                }\r\n                Microsoft.ApplicationInsights._InternalLogging.throwInternal(\r\n                    LoggingSeverity.WARNING,\r\n                    _InternalMessageId.FailedToSendQueuedTelemetry,\r\n                    \"Failed to send queued telemetry\",\r\n                    properties);\r\n            }\r\n        }\r\n\r\n        public pollInteralLogs(appInsightsInstance: AppInsights) {\r\n            return setInterval(() => {\r\n                var queue: Array<_InternalLogMessage> = Microsoft.ApplicationInsights._InternalLogging.queue;\r\n                var length = queue.length;\r\n                for (var i = 0; i < length; i++) {\r\n                    appInsightsInstance.trackTrace(queue[i].message);\r\n                }\r\n                queue.length = 0;\r\n            }, this.config.diagnosticLogInterval);\r\n        }\r\n\r\n        public addHousekeepingBeforeUnload(appInsightsInstance: AppInsights): void {\r\n            // Add callback to push events when the user navigates away\r\n\r\n            if (!appInsightsInstance.config.disableFlushOnBeforeUnload && ('onbeforeunload' in window)) {\r\n                var performHousekeeping = function () {\r\n                    // Adds the ability to flush all data before the page unloads.\r\n                    // Note: This approach tries to push an async request with all the pending events onbeforeunload.\r\n                    // Firefox does not respect this.Other browsers DO push out the call with < 100% hit rate.\r\n                    // Telemetry here will help us analyze how effective this approach is.\r\n                    // Another approach would be to make this call sync with a acceptable timeout to reduce the \r\n                    // impact on user experience.\r\n                    appInsightsInstance.context._sender.triggerSend();\r\n\r\n                    // Back up the current session to local storage\r\n                    // This lets us close expired sessions after the cookies themselves expire\r\n                    appInsightsInstance.context._sessionManager.backup();\r\n                };\r\n\r\n                if (!Microsoft.ApplicationInsights.Util.addEventHandler('beforeunload', performHousekeeping)) {\r\n                    Microsoft.ApplicationInsights._InternalLogging.throwInternal(\r\n                        Microsoft.ApplicationInsights.LoggingSeverity.CRITICAL,\r\n                        Microsoft.ApplicationInsights._InternalMessageId.FailedToAddHandlerForOnBeforeUnload,\r\n                        'Could not add handler for beforeunload');\r\n                }\r\n            }\r\n        }\r\n\r\n        public static getDefaultConfig(config?: IConfig): IConfig {\r\n            if (!config) {\r\n                config = <IConfig>{};\r\n            }\r\n\r\n            // set default values\r\n            config.endpointUrl = config.endpointUrl || \"https://dc.services.visualstudio.com/v2/track\";\r\n            config.sessionRenewalMs = 30 * 60 * 1000;\r\n            config.sessionExpirationMs = 24 * 60 * 60 * 1000;\r\n            config.maxBatchSizeInBytes = config.maxBatchSizeInBytes > 0 ? config.maxBatchSizeInBytes : 102400; // 100kb\r\n            config.maxBatchInterval = !isNaN(config.maxBatchInterval) ? config.maxBatchInterval : 15000;\r\n            config.enableDebug = Util.stringToBoolOrDefault(config.enableDebug);\r\n            config.disableExceptionTracking = Util.stringToBoolOrDefault(config.disableExceptionTracking);\r\n            config.disableTelemetry = Util.stringToBoolOrDefault(config.disableTelemetry);\r\n            config.verboseLogging = Util.stringToBoolOrDefault(config.verboseLogging);\r\n            config.emitLineDelimitedJson = Util.stringToBoolOrDefault(config.emitLineDelimitedJson);\r\n            config.diagnosticLogInterval = config.diagnosticLogInterval || 10000;\r\n            config.autoTrackPageVisitTime = Util.stringToBoolOrDefault(config.autoTrackPageVisitTime);\r\n\r\n            if (isNaN(config.samplingPercentage) || config.samplingPercentage <= 0 || config.samplingPercentage >= 100) {\r\n                config.samplingPercentage = 100;\r\n            }\r\n\r\n            config.disableAjaxTracking = Util.stringToBoolOrDefault(config.disableAjaxTracking)\r\n            config.maxAjaxCallsPerView = !isNaN(config.maxAjaxCallsPerView) ? config.maxAjaxCallsPerView : 500;\r\n          \r\n            config.isBeaconApiDisabled = Util.stringToBoolOrDefault(config.isBeaconApiDisabled, true);\r\n            config.disableCorrelationHeaders = Util.stringToBoolOrDefault(config.disableCorrelationHeaders);\r\n            config.disableFlushOnBeforeUnload = Util.stringToBoolOrDefault(config.disableFlushOnBeforeUnload);\r\n            config.enableSessionStorageBuffer = Util.stringToBoolOrDefault(config.enableSessionStorageBuffer, true);\r\n            config.isRetryDisabled = Util.stringToBoolOrDefault(config.isRetryDisabled);\r\n            config.isCookieUseDisabled = Util.stringToBoolOrDefault(config.isCookieUseDisabled);\r\n            config.isStorageUseDisabled = Util.stringToBoolOrDefault(config.isStorageUseDisabled);\r\n            config.isBrowserLinkTrackingEnabled = Util.stringToBoolOrDefault(config.isBrowserLinkTrackingEnabled);\r\n \r\n            return config;\r\n        }\r\n    }\r\n}\r\n","/// <reference path=\"Initialization.ts\" />\r\n\r\nmodule Microsoft.ApplicationInsights {\r\n    \"use strict\";\r\n\r\n    try {\r\n        // only initialize if we are running in a browser that supports JSON serialization (ie7<, node.js, cordova)\r\n        if (typeof window !== \"undefined\" && typeof JSON !== \"undefined\") {\r\n            // get snippet or initialize to an empty object\r\n            var aiName = \"appInsights\";\r\n    \r\n            if (window[aiName] === undefined) {\r\n                // if no snippet is present, initialize default values\r\n                Microsoft.ApplicationInsights.AppInsights.defaultConfig = Microsoft.ApplicationInsights.Initialization.getDefaultConfig();\r\n            } else {\r\n                // this is the typical case for browser+snippet\r\n                var snippet: Microsoft.ApplicationInsights.Snippet = window[aiName] || <any>{};\r\n    \r\n                // overwrite snippet with full appInsights\r\n                var init = new Microsoft.ApplicationInsights.Initialization(snippet);\r\n                var appInsightsLocal = init.loadAppInsights();\r\n\r\n                // apply full appInsights to the global instance that was initialized in the snippet\r\n                for (var field in appInsightsLocal) {\r\n                    snippet[field] = appInsightsLocal[field];\r\n                }\r\n    \r\n                init.emptyQueue();\r\n    \r\n                init.pollInteralLogs(appInsightsLocal);\r\n    \r\n                init.addHousekeepingBeforeUnload(appInsightsLocal);\r\n            }\r\n        }\r\n    } catch (e) {\r\n        Microsoft.ApplicationInsights._InternalLogging.warnToConsole('Failed to initialize AppInsights JS SDK: ' + e.message);\r\n    }\r\n}\r\n"]}